This directory {\ttfamily cmake/std/atdm/} contains a set of {\ttfamily $\ast$.sh} shell scripts and {\ttfamily $\ast$.cmake} files that define a standard A\+T\+D\+M-\/focused build of Trilinos on a number of different A\+T\+DM platforms.

This is used to define a set of automated builds of Trilinos that are run with Jenkins and post to the main Trilinos C\+Dash site using build names that start with {\ttfamily Trilinos-\/atdm}. The C\+Test driver scripts and Jenkins driver scripts that use this A\+T\+DM configuration are defined in the Trilinos directory {\ttfamily cmake/ctest/drivers/atdm/} (see the {\ttfamily R\+E\+A\+D\+M\+E.\+md} file in that directory for details) but these details are not necessary in order to just reproduce a build locally as described below.

{\bfseries{Outline\+:}}
\begin{DoxyItemize}
\item \href{\#quick-start}{\texttt{ Quick-\/start}}
\item \href{\#installation-and-usage}{\texttt{ Installation and usage}}
\item \href{\#checkin-test-atdmsh}{\texttt{ checkin-\/test-\/atdm.\+sh}}
\item \href{\#specific-instructions-for-each-system}{\texttt{ Specific instructions for each system}}
\item \href{\#troubleshooting-configuration-problems}{\texttt{ Troubleshooting configuration problems}}
\item \href{\#directory-structure-and-contents}{\texttt{ Directory structure and contents}}
\item \href{\#disabling-failing-tests}{\texttt{ Disabling failing tests}}
\item \href{\#specific-systems-supported}{\texttt{ Specific systems supported}}
\end{DoxyItemize}

\doxysection*{Quick-\/start}

After \href{https://github.com/trilinos/Trilinos/wiki/VC-\%7C-Initial-Git-Setup}{\texttt{ cloning the Trilinos git repo}} on one of the supported A\+T\+DM machines, a local configure of Trilinos enabling a few packages is performed as\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ cd <some\_build\_dir>/}
\DoxyCodeLine{}
\DoxyCodeLine{\$ source \$TRILINOS\_DIR/cmake/std/atdm/load-\/env.sh <job-\/name>}
\DoxyCodeLine{}
\DoxyCodeLine{\$ cmake \(\backslash\)}
\DoxyCodeLine{  -\/GNinja \(\backslash\)}
\DoxyCodeLine{  -\/DTrilinos\_CONFIGURE\_OPTIONS\_FILE:STRING=cmake/std/atdm/ATDMDevEnv.cmake \(\backslash\)}
\DoxyCodeLine{  -\/DTrilinos\_ENABLE\_TESTS=ON -\/DTrilinos\_ENABLE\_<Package1>=ON \(\backslash\)}
\DoxyCodeLine{  \$TRILINOS\_DIR}
\DoxyCodeLine{}
\DoxyCodeLine{\$ make NP=16  \# Uses ninja -\/j16}
\DoxyCodeLine{}
\DoxyCodeLine{\$ ctest -\/j16  \# Might need to be run with srun or some other command, see below}
\end{DoxyCode}


The command\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ source \$TRILINOS\_DIR/cmake/std/atdm/load-\/env.sh <job-\/name>}
\end{DoxyCode}


determines what machine you are on (using {\ttfamily hostname}) and then loads the correct environment automatically for that machine and for the build options passed through in {\ttfamily $<$job-\/name$>$} (or errors out if the current machine is not one of the supported machines).

The {\ttfamily $<$job-\/name$>$} argument is a single string of the form {\ttfamily X\+X\+X-\/$<$keyword0$>$-\/$<$keyword1$>$-\/...}. The standard order and format of this string is\+: \begin{DoxyVerb}<system-name>-<compiler>-<release_or_debug>-<kokkos_threading>-<kokkos_arch>
\end{DoxyVerb}


Each of these keywords are described below.

$\ast$$\ast${\ttfamily $<$system-\/name$>$}$\ast$$\ast$\+: Typically, the system name is determined automatically by examining the {\ttfamily hostname} on the system and matching it to known hosts. Therefore, it is typically not necessary to specify {\ttfamily $<$system-\/name$>$} in the {\ttfamily $<$job-\/name$>$} keys. But there are some cases where more then one {\ttfamily $<$system-\/name$>$} env are supported on the same machine. For example, on C\+EE L\+AN R\+H\+E\+L6 machines, both the \href{\#sems-rhel6-environment}{\texttt{ S\+E\+MS R\+H\+E\+L6 env}} and \href{\#cee-rhel6-environment}{\texttt{ C\+EE R\+H\+E\+L6 env}} are supported. On these C\+EE L\+AN R\+H\+E\+L6 machines, when {\ttfamily cee-\/rhel6} is included in the build job name, then the {\ttfamily cee-\/rhel6} env will be selected. But if {\ttfamily sems-\/rhel6} is included in the job name or non system name is given, then the {\ttfamily sems-\/rhel6} env will be selected by default.

$\ast$$\ast${\ttfamily $<$compiler$>$}\+:$\ast$$\ast$ The following {\bfseries{lower case}} {\ttfamily $<$job-\/name$>$} keywords specify the {\ttfamily $<$C\+O\+M\+P\+I\+L\+ER$>$} variable include\+:


\begin{DoxyItemize}
\item {\ttfamily gnu}\+: Use the G\+CC compilers ({\ttfamily $<$C\+O\+M\+P\+I\+L\+ER$>$=G\+NU})
\item {\ttfamily intel}\+: Use the Intel compilers ({\ttfamily $<$C\+O\+M\+P\+I\+L\+ER$>$=I\+N\+T\+EL})
\item {\ttfamily clang}\+: Use the L\+L\+VM Clang compilers ({\ttfamily $<$C\+O\+M\+P\+I\+L\+ER$>$=C\+L\+A\+NG})
\item {\ttfamily cuda}\+: Do a C\+U\+DA build ({\ttfamily $<$C\+O\+M\+P\+I\+L\+ER$>$=C\+U\+DA}, {\ttfamily N\+O\+D\+E\+\_\+\+T\+Y\+PE=C\+U\+DA})
\begin{DoxyItemize}
\item {\ttfamily cuda-\/8.\+0}\+: Use C\+U\+DA 8.\+0
\item {\ttfamily cuda-\/9.\+0}\+: Use C\+U\+DA 9.\+0
\end{DoxyItemize}
\end{DoxyItemize}

When using {\ttfamily gnu}, {\ttfamily intel}, {\ttfamily clang}, and {\ttfamily cuda} without specifying a version (e.\+g. {\ttfamily cuda-\/9.\+0}), then a default version of the compilers for that system will be chosen (see the loaded env for the default chosen version). Each system may only support a subset of these compilers; see the {\ttfamily cmake/std/atdm/$<$system-\/name$>$/environment.sh} file for details on which compilers and which versions are supported. If you choose a compiler that is not supported, an error message will be provided. If {\ttfamily default} is used, then the default compiler for the system will be selected.

$\ast$$\ast${\ttfamily $<$release\+\_\+or\+\_\+debug$>$}\+:$\ast$$\ast$ The following {\ttfamily $<$job-\/name$>$} keywords specify debug or optimized build and the {\ttfamily $<$B\+U\+I\+L\+D\+\_\+\+T\+Y\+PE$>$ variable}(used to set the C\+Make cache var {\ttfamily C\+M\+A\+K\+E\+\_\+\+B\+U\+I\+L\+D\+\_\+\+T\+Y\+PE=\mbox{[}D\+E\+B\+U\+G$\vert$\+R\+E\+L\+E\+A\+SE\mbox{]}} and turn on or off runtime debug checking (e.\+g. array bounds checking, pointer checking etc.))\+:


\begin{DoxyItemize}
\item {\ttfamily release-\/debug}\+: ({\ttfamily $<$B\+U\+I\+L\+D\+\_\+\+T\+Y\+PE$>$=R\+E\+L\+E\+A\+S\+E\+\_\+\+R\+E\+L\+E\+A\+SE})
\begin{DoxyItemize}
\item Set {\ttfamily C\+M\+A\+K\+E\+\_\+\+B\+U\+L\+D\+\_\+\+T\+Y\+PE=R\+E\+L\+E\+A\+SE} (i.\+e. {\ttfamily -\/O3} compiler options)
\item Turn {\bfseries{ON}} runtime debug checking
\item N\+O\+TE\+: This build runs runtime checks to catch developer and user mistakes but still runs fairly fast.
\end{DoxyItemize}
\item {\ttfamily debug}\+: ({\ttfamily $<$B\+U\+I\+L\+D\+\_\+\+T\+Y\+PE$>$=D\+E\+B\+UG}, D\+E\+F\+A\+U\+LT)
\begin{DoxyItemize}
\item Set {\ttfamily C\+M\+A\+K\+E\+\_\+\+B\+U\+L\+D\+\_\+\+T\+Y\+PE=D\+E\+B\+UG} (i.\+e. {\ttfamily -\/O0 -\/g} compiler options)
\item Turn {\bfseries{ON}} runtime debug checking
\item N\+O\+TE\+: This build supports running in a debugger.
\end{DoxyItemize}
\item {\ttfamily release} or {\ttfamily opt}\+: ({\ttfamily $<$B\+U\+I\+L\+D\+\_\+\+T\+Y\+PE$>$=R\+E\+L\+E\+A\+SE})
\begin{DoxyItemize}
\item Set {\ttfamily C\+M\+A\+K\+E\+\_\+\+B\+U\+L\+D\+\_\+\+T\+Y\+PE=R\+E\+L\+E\+A\+SE} (i.\+e. {\ttfamily -\/O3} compiler options)
\item Turn {\bfseries{O\+FF}} runtime debug checking
\item N\+O\+TE\+: This build runs fast with minimal checks (i.\+e. production).
\end{DoxyItemize}
\end{DoxyItemize}

$\ast$$\ast${\ttfamily $<$kokkos\+\_\+threading$>$}\+:$\ast$$\ast$ The following {\ttfamily $<$job-\/name$>$} keywords determine the Kokkos threading model variable {\ttfamily $<$N\+O\+D\+E\+\_\+\+T\+Y\+PE$>$} (default is {\ttfamily $<$N\+O\+D\+E\+\_\+\+T\+Y\+PE$>$=S\+E\+R\+I\+AL} unless {\ttfamily $<$C\+O\+M\+P\+I\+L\+ER$>$=C\+U\+DA})\+:


\begin{DoxyItemize}
\item {\ttfamily openmp}\+: Use Open\+MP for host threading ({\ttfamily N\+O\+D\+E\+\_\+\+T\+Y\+PE=O\+P\+E\+N\+MP})
\item {\ttfamily pthread}\+: Use Pthreads for host threading ({\ttfamily N\+O\+D\+E\+\_\+\+T\+Y\+PE=T\+H\+R\+E\+AD})
\item {\ttfamily serial}\+: Use no host threading ({\ttfamily N\+O\+D\+E\+\_\+\+T\+Y\+PE=S\+E\+R\+I\+AL}, D\+E\+F\+A\+U\+LT)
\end{DoxyItemize}

If {\ttfamily cuda} (or {\ttfamily cuda-\/8.\+0}, {\ttfamily cuda-\/9.\+0}, etc.) is given, then {\ttfamily $<$N\+O\+D\+E\+\_\+\+T\+Y\+PE$>$} is automatically set to {\ttfamily C\+U\+DA}.

$\ast$$\ast${\ttfamily $<$kokkos\+\_\+arch$>$}\+:$\ast$$\ast$ The {\ttfamily $<$job-\/name$>$} string can also contain keywords to determine the {\ttfamily K\+O\+K\+K\+O\+S\+\_\+\+A\+R\+CH} option of the build. This is the case-\/sensitive architecture name that is recognized by the C\+Make \href{https://trilinos.org/docs/files/TrilinosBuildReference.html\#configuring-with-kokkos-and-advanced-back-ends}{\texttt{ K\+O\+K\+K\+O\+S\+\_\+\+A\+R\+CH}} configure option for Trilinos and Kokkos. Some common supported Kokkos architectures for the host node include {\ttfamily B\+DW}, {\ttfamily H\+SW}, {\ttfamily Power8}, {\ttfamily Power9}, and {\ttfamily K\+NL}. When a G\+PU is present, some common Kokkos architecture options include {\ttfamily Kepler37} and {\ttfamily Pascal60}. If one selects a {\ttfamily K\+O\+K\+K\+O\+S\+\_\+\+A\+R\+CH} value that is not supported by the current system or selected compiler, then the {\ttfamily load-\/env.\+sh} script will return an error message listing the value choices for {\ttfamily K\+O\+K\+K\+O\+S\+\_\+\+A\+R\+CH} for each supported compiler.

Note that currently only a single {\ttfamily K\+O\+K\+K\+O\+S\+\_\+\+A\+R\+CH} value is recognized in the {\ttfamily $<$job-\/name$>$} string and it must be proceeded a dash \textquotesingle{}-\/\textquotesingle{} such as with {\ttfamily intel-\/\+K\+NL} or {\ttfamily cuda-\/\+Kepler37}. This setup does not currently support specifying multiple {\ttfamily K\+O\+K\+K\+O\+S\+\_\+\+A\+R\+CH} values (since there is no example yet where that would be needed or useful) but such functionality could be supported in the future if needed.

All other strings in {\ttfamily $<$job-\/name$>$} are ignored but are allowed for informational purposes. The reason that a {\ttfamily $<$job-\/name$>$} string is defined in this form is that this can be used as the Jenkins job name and the Trilinos build name that shows up on C\+Dash. This makes it very easy to define the configuration options and maintain the Jenkins build jobs. The combination {\ttfamily $<$C\+O\+M\+P\+I\+L\+ER$>$-\/$<$B\+U\+I\+L\+D\+\_\+\+T\+Y\+PE$>$-\/$<$N\+O\+D\+E\+\_\+\+T\+Y\+PE$>$-\/$<$K\+O\+K\+K\+O\+S\+\_\+\+A\+C\+R\+CH$>$} is used to define the C\+Make variable {\ttfamily A\+T\+D\+M\+\_\+\+J\+O\+B\+\_\+\+N\+A\+M\+E\+\_\+\+K\+E\+Y\+S\+\_\+\+S\+TR} that is used to uniquely define a build on a particular system and to manage a system of tweaks for each of the supported builds (see below).

Some examples of {\ttfamily $<$job-\/name$>$} keyword sets used on various platforms include\+:
\begin{DoxyItemize}
\item {\ttfamily gnu-\/debug-\/openmp}
\item {\ttfamily gnu-\/opt-\/openmp}
\item {\ttfamily intel-\/debug-\/openmp}
\item {\ttfamily intel-\/opt-\/openmp}
\item {\ttfamily sems-\/rhel6-\/gnu-\/debug-\/openmp}
\item {\ttfamily cee-\/rhel6-\/gnu-\/debug-\/openmp}
\item {\ttfamily sems-\/rhel6-\/intel-\/opt-\/openmp}
\item {\ttfamily cee-\/rhel6-\/intel-\/opt-\/openmp}
\item {\ttfamily intel-\/debug-\/openmp-\/\+K\+NL}
\item {\ttfamily intel-\/opt-\/openmp-\/\+H\+SW}
\item {\ttfamily cuda-\/debug} ({\ttfamily $<$N\+O\+D\+E\+\_\+\+T\+Y\+PE$>$} is implicitly {\ttfamily C\+U\+DA})
\item {\ttfamily cuda-\/opt} ({\ttfamily $<$N\+O\+D\+E\+\_\+\+T\+Y\+PE$>$} is implicitly {\ttfamily C\+U\+DA})
\item {\ttfamily cuda-\/8.\+0-\/debug} ({\ttfamily $<$N\+O\+D\+E\+\_\+\+T\+Y\+PE$>$} is implicitly {\ttfamily C\+U\+DA})
\item {\ttfamily cuda-\/9.\+0-\/opt-\/\+Kepler37} ({\ttfamily $<$N\+O\+D\+E\+\_\+\+T\+Y\+PE$>$} is implicitly {\ttfamily C\+U\+DA})
\end{DoxyItemize}

The script {\ttfamily cmake/std/atdm/load-\/env.\+sh} when sourced sets some bash environment variables that are prefixed with {\ttfamily A\+T\+D\+M\+\_\+\+C\+O\+N\+F\+I\+G\+\_\+} and other standard variables. This includes setting the var {\ttfamily A\+T\+D\+M\+\_\+\+C\+O\+N\+F\+I\+G\+\_\+\+J\+O\+B\+\_\+\+N\+A\+ME} which stores the input {\ttfamily $<$job-\/name$>$} which is used in other parts of the system.

The file {\ttfamily A\+T\+D\+M\+Dev\+Env.\+cmake} pulls bash environment variables set by the sourced {\ttfamily atdm/load-\/env.\+sh} script and sets up a number of C\+Make cache variables such as the compilers, compiler options, and sets up a number of Trilinos configuration variables (many of which are echoed to the S\+T\+D\+O\+UT when running {\ttfamily cmake}). This also enables by default all of the standard T\+P\+Ls used by A\+T\+DM Application codes through Trilinos and sets up locations for the include directories and libraries for each of these T\+P\+Ls.

When included, the file {\ttfamily A\+T\+D\+M\+Dev\+Env.\+cmake} also disables many packages and subpackages not used for the A\+T\+DM configuration of Trilinos. This uses a so-\/called back-\/listing approach which allows one to only directly enable the packages you want to use with {\ttfamily Trilinos\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+A\+L\+L\+\_\+\+O\+P\+T\+I\+O\+N\+A\+L\+\_\+\+P\+A\+C\+K\+A\+G\+ES=ON} and then disable the ones you don\textquotesingle{}t want. This is a much more flexible way to define a standard configuration of Trilinos that allows different sets of actual packages to be enabled based on the needs of the different A\+T\+DM application customers and Trilinos developers just needing to enable a subset of packages. But if package X does get enabled, then it will always have the same configuration options independent of any other packages that are enabled.

When {\ttfamily A\+T\+D\+M\+Dev\+Env.\+cmake} is being processed, if there is a \char`\"{}tweaks\char`\"{} file defined for a build, then it will be picked up in the C\+Make cache var \href{\#ATDM_TWEAKS_FILES}{\texttt{ A\+T\+D\+M\+\_\+\+T\+W\+E\+A\+K\+S\+\_\+\+F\+I\+L\+ES}} and that file will be read in using {\ttfamily I\+N\+C\+L\+U\+D\+E()} to process the extra options contained within it.

\doxysection*{Installation and usage}

When including the {\ttfamily A\+T\+D\+M\+Dev\+Env.\+cmake} file (or {\ttfamily A\+T\+D\+M\+Dev\+Env\+Settings.\+cmake}) at configure time as described above, the cmake configure automatically sets up to install an environment script\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{<install-\/prefix>/<load-\/matching-\/env-\/sh>}
\end{DoxyCode}


where {\ttfamily $<$install-\/prefix$>$} and {\ttfamily $<$load-\/matching-\/env-\/sh$>$} are set at configure-\/time using\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{-\/D CMAKE\_INSTALL\_PREFIX=<install-\/prefix> \(\backslash\)}
\DoxyCodeLine{-\/D ATDM\_INSTALLED\_ENV\_LOAD\_SCRIPT\_NAME=<load-\/matching-\/env-\/sh> \(\backslash\)}
\DoxyCodeLine{-\/D ATDM\_TRILINOS\_INSTALL\_PREFIX\_ENV\_VAR\_NAME=<trilinos-\/install-\/prefix-\/var-\/name> \(\backslash\)}
\end{DoxyCode}



\begin{DoxyItemize}
\item If {\ttfamily A\+T\+D\+M\+\_\+\+I\+N\+S\+T\+A\+L\+L\+E\+D\+\_\+\+E\+N\+V\+\_\+\+L\+O\+A\+D\+\_\+\+S\+C\+R\+I\+P\+T\+\_\+\+N\+A\+ME} is not specified then it is given the name {\ttfamily load\+\_\+matching\+\_\+env.\+sh} by default.
\item If {\ttfamily A\+T\+D\+M\+\_\+\+T\+R\+I\+L\+I\+N\+O\+S\+\_\+\+I\+N\+S\+T\+A\+L\+L\+\_\+\+P\+R\+E\+F\+I\+X\+\_\+\+E\+N\+V\+\_\+\+V\+A\+R\+\_\+\+N\+A\+ME} is not specified then it is given the name {\ttfamily A\+T\+D\+M\+\_\+\+T\+R\+I\+L\+I\+N\+O\+S\+\_\+\+I\+N\+S\+T\+A\+L\+L\+\_\+\+P\+R\+E\+F\+IX} by default.
\end{DoxyItemize}

After installation with {\ttfamily make install}, a client can load the environment to use this A\+T\+DM configuration of Trilinos by running\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ source <install-\/prefix>/<load-\/matching-\/env-\/sh>}
\end{DoxyCode}


Sourcing this file sets all of the various {\ttfamily A\+T\+D\+M\+\_\+\+C\+O\+N\+G\+\_\+} environment variables described above and also sets the environment variable {\ttfamily $<$trilinos-\/install-\/prefix-\/var-\/name$>$} to {\ttfamily $<$install-\/prefix$>$}.

\doxysection*{checkin-\/test-\/atdm.\+sh}

For those Trilinos developers comfortable with using the {\ttfamily Trilinos/checkin-\/test.\+py} script, multiple local builds and testing on a system can also be driven with the provided {\ttfamily checkin-\/test-\/atdm.\+sh} wrapper script. This can be used to drive a number of builds on system as\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ cd <some\_build\_dir>/}
\DoxyCodeLine{}
\DoxyCodeLine{\$ ln -\/s \$TRILINOS\_DIR/cmake/std/atdm/checkin-\/test-\/atdm.sh .}
\DoxyCodeLine{}
\DoxyCodeLine{\$ ./checkin-\/test-\/atdm.sh <job-\/name-\/0> <job-\/name-\/1> ... \(\backslash\)}
\DoxyCodeLine{  -\/-\/enable-\/packages=<Package> -\/-\/local-\/do-\/all}
\end{DoxyCode}


That will configure, build, and run tests for each specified build {\ttfamily $<$job-\/name-\/0$>$} and send a summary email when complete. All of the supported builds on the local system can be run by using {\ttfamily all} instead of {\ttfamily $<$job-\/name-\/0$>$ $<$job-\/name-\/1$>$ ...}. See comments at the top of the script {\ttfamily checkin-\/test-\/atdm.\+sh} for more details.

The parallel level for building and running tests are determined by the env vars {\ttfamily A\+T\+D\+M\+\_\+\+C\+O\+N\+F\+I\+G\+\_\+\+B\+U\+I\+L\+D\+\_\+\+C\+O\+U\+NT} and {\ttfamily A\+T\+D\+M\+\_\+\+C\+O\+N\+F\+I\+G\+\_\+\+C\+T\+E\+S\+T\+\_\+\+P\+A\+R\+A\+L\+L\+E\+L\+\_\+\+L\+E\+V\+EL}, respectfully, as set by default for the given system by the {\ttfamily atdm/load-\/env.\+sh} script for the given machine. (On most machines, these are fixed but on generic systems like \href{\#sems-rhel6-environment}{\texttt{ sems-\/rhel6}}, they are computed from the number of cores on that machine). These values can be overridden by setting the env vars {\ttfamily A\+T\+D\+M\+\_\+\+C\+O\+N\+F\+I\+G\+\_\+\+B\+U\+I\+L\+D\+\_\+\+C\+O\+U\+N\+T\+\_\+\+O\+V\+E\+R\+R\+I\+DE} and {\ttfamily A\+T\+D\+M\+\_\+\+C\+O\+N\+F\+I\+G\+\_\+\+C\+T\+E\+S\+T\+\_\+\+P\+A\+R\+A\+L\+L\+E\+L\+\_\+\+L\+E\+V\+E\+L\+\_\+\+O\+V\+E\+R\+I\+DE}, respectfully as, for example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ env \(\backslash\)}
\DoxyCodeLine{  ATDM\_CONFIG\_BUILD\_COUNT\_OVERRIDE=8 \(\backslash\)}
\DoxyCodeLine{  ATDM\_CONFIG\_CTEST\_PARALLEL\_LEVEL\_OVERIDE=12 \(\backslash\)}
\DoxyCodeLine{  ./checkin-\/test-\/atdm.sh [options]}
\end{DoxyCode}


A value of {\ttfamily A\+T\+D\+M\+\_\+\+C\+O\+N\+F\+I\+G\+\_\+\+B\+U\+I\+L\+D\+\_\+\+C\+O\+U\+N\+T\+\_\+\+O\+V\+E\+R\+R\+I\+DE=0} or less than {\ttfamily 0} is allowed when using Ninja (i.\+e. {\ttfamily A\+T\+D\+M\+\_\+\+C\+O\+N\+F\+I\+G\+\_\+\+U\+S\+E\+\_\+\+N\+I\+N\+JA=ON}) in which case {\ttfamily ninja} will be run with non {\ttfamily -\/j$<$N$>$} argument, and therefore all of the non-\/loaded cores will be used.

Alternatively, one can override the parallel build and test running levels and set other make/ninja and ctest options using the checkin-\/test arguments {\ttfamily -\/-\/make-\/options} and {\ttfamily -\/-\/ctest-\/options}. For example, to use 20 processes to build with Nina, have Ninja keep going even if there are build errors, and run ctest with 10 proceses, one can use\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ ./checkin-\/test-\/atdm.sh \(\backslash\)}
\DoxyCodeLine{  -\/-\/make-\/options="-\/j20 -\/k 99999999" \(\backslash\)}
\DoxyCodeLine{  -\/-\/ctest-\/options=-\/j10 \(\backslash\)}
\DoxyCodeLine{  [other options]}
\end{DoxyCode}


To run tests for a C\+U\+DA build or to run tests on platforms that must run on a compute node one will need to run these on a compute node on the system that has a G\+PU. On such a system one would run\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ ./checkin-\/test-\/atdm.sh <job-\/name-\/0> <job-\/name-\/1> ... \(\backslash\)}
\DoxyCodeLine{  -\/-\/enable-\/packages=<Package> -\/-\/configure -\/-\/build \(\backslash\)}
\DoxyCodeLine{  \&\& \(\backslash\)}
\DoxyCodeLine{  <command-\/to-\/run-\/on-\/compute-\/node> \(\backslash\)}
\DoxyCodeLine{  ./checkin-\/test-\/atdm.sh <job-\/name-\/0> <job-\/name-\/1> ... \(\backslash\)}
\DoxyCodeLine{  -\/-\/enable-\/packages=<Package> -\/-\/test}
\end{DoxyCode}


See \href{\#specific-instructions-for-each-system}{\texttt{ Specific instructions for each system}} for details for how to run on the compute node for that system.

Note that one can create a {\ttfamily local-\/checkin-\/test-\/defaults.\+py} file to set defaults like\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{defaults = [}
\DoxyCodeLine{  "-\/-\/no-\/enable-\/fwd-\/packages",}
\DoxyCodeLine{  "-\/-\/enable-\/all-\/packages=off",}
\DoxyCodeLine{  ]}
\end{DoxyCode}


and then run\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ ./checkin-\/test-\/atdm.sh <job-\/name-\/0> <job-\/name-\/1> ... \(\backslash\)}
\DoxyCodeLine{  -\/-\/enable-\/packages=<Package> -\/-\/local-\/do-\/all}
\end{DoxyCode}


However, a default {\ttfamily local-\/checkin-\/test-\/defaults.\+py} is created the first time the {\ttfamily checkin-\/test-\/atdm.\+sh} script is run and will set these as the defaults (after which can be modified).

\doxysection*{Specific instructions for each system}


\begin{DoxyItemize}
\item \href{\#ridewhite}{\texttt{ ride/white}}
\item \href{\#shillerhansen}{\texttt{ shiller/hansen}}
\item \href{\#chamaserrano}{\texttt{ chama/serrano}}
\item \href{\#mutrino}{\texttt{ mutrino}}
\item \href{\#sems-rhel6-environment}{\texttt{ S\+E\+MS rhel6 environment}}
\item \href{\#cee-rhel6-environment}{\texttt{ C\+EE rhel6 environment}}
\item \href{\#waterman}{\texttt{ waterman}}
\end{DoxyItemize}

\doxysubsection*{ride/white}

Once logged on to {\ttfamily white} (on the S\+ON) or {\ttfamily ride} (on the S\+RN), one can directly configure and build on the login node (being careful not to overload the node). But to run the tests, one must run on the compute nodes using the {\ttfamily bsub} command to run if using a C\+U\+DA build. For example, to configure, build and run the tests for the {\ttfamily cuda-\/debug} build for say {\ttfamily Mue\+Lu} on {\ttfamily white}, (after cloning Trilinos on the {\ttfamily develop} branch) one would do\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ cd <some\_build\_dir>/}
\DoxyCodeLine{}
\DoxyCodeLine{\$ source \$TRILINOS\_DIR/cmake/std/atdm/load-\/env.sh cuda-\/debug}
\DoxyCodeLine{}
\DoxyCodeLine{\$ cmake \(\backslash\)}
\DoxyCodeLine{  -\/GNinja \(\backslash\)}
\DoxyCodeLine{  -\/DTrilinos\_CONFIGURE\_OPTIONS\_FILE:STRING=cmake/std/atdm/ATDMDevEnv.cmake \(\backslash\)}
\DoxyCodeLine{  -\/DTrilinos\_ENABLE\_TESTS=ON -\/DTrilinos\_ENABLE\_MueLu=ON \(\backslash\)}
\DoxyCodeLine{  \$TRILINOS\_DIR}
\DoxyCodeLine{}
\DoxyCodeLine{\$ make NP=16}
\DoxyCodeLine{}
\DoxyCodeLine{\$ bsub -\/x -\/Is -\/q rhel7F -\/n 16 ctest -\/j16}
\end{DoxyCode}


The A\+T\+DM configuration of Trilinos is set up to run on the Firestone nodes (Dual-\/\+Socket P\+O\+W\+E\+R8, 8 cores per socket, K80 G\+P\+Us). This configuration will not work on the other G\+PU nodes currently.

{\bfseries{N\+O\+TE\+:}} While the above example shows loading the environment, configuring and building on the login node, one can also do these on the compute nodes as well. In fact, that is what the C\+Test -\/S drivers do in automated testing on \textquotesingle{}white\textquotesingle{} and \textquotesingle{}ride\textquotesingle{}.

Note that one can also run the same build a tests using the \href{\#checkin-test-atdmsh}{\texttt{ checkin-\/test-\/atdm.\+sh}} script as\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ cd <some\_build\_dir>/}
\DoxyCodeLine{\$ ln -\/s \$TRILINOS\_DIR/cmake/std/atdm/checkin-\/test-\/atdm.sh .}
\DoxyCodeLine{\$ bsub -\/x -\/I -\/q rhel7F -\/n 16 \(\backslash\)}
\DoxyCodeLine{  ./checkin-\/test-\/atdm.sh cuda-\/debug \(\backslash\)}
\DoxyCodeLine{  -\/-\/enable-\/packages=MueLu \(\backslash\)}
\DoxyCodeLine{  -\/-\/local-\/do-\/all}
\end{DoxyCode}


\doxysubsection*{shiller/hansen}

Once logged on to {\ttfamily hansen} (on the S\+ON) or {\ttfamily shiller} (on the S\+RN), one can directly configure and build on the login node (being careful not to overload the node). But to run the tests, one must run on the compute nodes using the {\ttfamily srun} command. For example, to configure, build and run the tests for say {\ttfamily Mue\+Lu} on {\ttfamily hansen}, (after cloning Trilinos on the {\ttfamily develop} branch) one would do\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ cd <some\_build\_dir>/}
\DoxyCodeLine{}
\DoxyCodeLine{\$ source \$TRILINOS\_DIR/cmake/std/atdm/load-\/env.sh intel-\/opt-\/openmp}
\DoxyCodeLine{}
\DoxyCodeLine{\$ cmake \(\backslash\)}
\DoxyCodeLine{  -\/GNinja \(\backslash\)}
\DoxyCodeLine{  -\/DTrilinos\_CONFIGURE\_OPTIONS\_FILE:STRING=cmake/std/atdm/ATDMDevEnv.cmake \(\backslash\)}
\DoxyCodeLine{  -\/DTrilinos\_ENABLE\_TESTS=ON -\/DTrilinos\_ENABLE\_MueLu=ON \(\backslash\)}
\DoxyCodeLine{  \$TRILINOS\_DIR}
\DoxyCodeLine{}
\DoxyCodeLine{\$ make NP=16}
\DoxyCodeLine{}
\DoxyCodeLine{\$ srun ctest -\/j16}
\end{DoxyCode}


{\bfseries{N\+O\+TE\+:}} While the above example shows loading the environment, configuring and building on the login node, one can also do these on the compute nodes as well. In fact, that is what the C\+Test -\/S drivers do in automated testing on \textquotesingle{}hansen\textquotesingle{} and \textquotesingle{}shiller\textquotesingle{}.

Note that one can also run the same build a tests using the \href{\#checkin-test-atdmsh}{\texttt{ checkin-\/test-\/atdm.\+sh}} script as\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ cd <some\_build\_dir>/}
\DoxyCodeLine{\$ ln -\/s \$TRILINOS\_DIR/cmake/std/atdm/checkin-\/test-\/atdm.sh .}
\DoxyCodeLine{\$ srun ./checkin-\/test-\/atdm.sh intel-\/opt-\/openmp \(\backslash\)}
\DoxyCodeLine{  -\/-\/enable-\/packages=MueLu \(\backslash\)}
\DoxyCodeLine{  -\/-\/local-\/do-\/all}
\end{DoxyCode}


\doxysubsection*{chama/serrano}

Once logged on to {\ttfamily chama} or {\ttfamily serrano}, one can directly configure and build on the login node (being careful not to overload the node). But to run the tests, one must run on the compute nodes using the {\ttfamily srun} command. For example, to configure, build and run the tests for say {\ttfamily Mue\+Lu} on {\ttfamily serrano} or {\ttfamily chama}, (after cloning Trilinos on the {\ttfamily develop} branch) one would do\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ cd <some\_build\_dir>/}
\DoxyCodeLine{}
\DoxyCodeLine{\$ source \$TRILINOS\_DIR/cmake/std/atdm/load-\/env.sh intel-\/opt-\/openmp}
\DoxyCodeLine{}
\DoxyCodeLine{\$ cmake \(\backslash\)}
\DoxyCodeLine{  -\/GNinja \(\backslash\)}
\DoxyCodeLine{  -\/DTrilinos\_CONFIGURE\_OPTIONS\_FILE:STRING=cmake/std/atdm/ATDMDevEnv.cmake \(\backslash\)}
\DoxyCodeLine{  -\/DTrilinos\_ENABLE\_TESTS=ON -\/DTrilinos\_ENABLE\_MueLu=ON \(\backslash\)}
\DoxyCodeLine{  \$TRILINOS\_DIR}
\DoxyCodeLine{}
\DoxyCodeLine{\$ make NP=16}
\DoxyCodeLine{}
\DoxyCodeLine{\$ salloc -\/N1 -\/-\/time=0:20:00 -\/-\/account=<YOUR\_WCID> ctest -\/j16}
\end{DoxyCode}


To get information on $<$\+Y\+O\+U\+R\+\_\+\+W\+C\+I\+D$>$ used above, there is a WC tool tab on computing.\+sandia.\+gov

{\bfseries{N\+O\+TE\+:}} Unlike some of the other machines, one must load the environment, configure and build on the login node and then run the test suite on a compute node on this system. This is what the C\+Test -\/S driver on \textquotesingle{}chama\textquotesingle{} and \textquotesingle{}serrano\textquotesingle{} does in order to drive jobs and submit to C\+Dash.

To use the checkin-\/test-\/atdm.\+sh script, you must split running the tests from the configure and build as with\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ cd <some\_build\_dir>/}
\DoxyCodeLine{\$ ln -\/s \$TRILINOS\_DIR/cmake/std/atdm/checkin-\/test-\/atdm.sh .}
\DoxyCodeLine{\$ ./checkin-\/test-\/atdm.sh intel-\/opt-\/openmp \(\backslash\)}
\DoxyCodeLine{  -\/-\/enable-\/packages=MueLu -\/-\/allow-\/no-\/pull -\/-\/configure -\/-\/build}
\DoxyCodeLine{\$ salloc -\/N1 -\/-\/time=0:20:00 -\/-\/account=<YOUR\_WCID> \(\backslash\)}
\DoxyCodeLine{  ./checkin-\/test-\/atdm.sh intel-\/opt-\/openmp \(\backslash\)}
\DoxyCodeLine{  -\/-\/enable-\/packages=MueLu -\/-\/test}
\end{DoxyCode}


\doxysubsection*{mutrino}

Once logged on to {\ttfamily mutrino}, one can directly configure and build on the login node (being careful not to overload the node). But to run the tests, one must run on the compute nodes using the {\ttfamily salloc} command. For example, to configure, build and run the tests for say {\ttfamily Mue\+Lu} on {\ttfamily mutrino}, (after cloning Trilinos on the {\ttfamily develop} branch) one would\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ cd <some\_build\_dir>/}
\DoxyCodeLine{}
\DoxyCodeLine{\$ source \$TRILINOS\_DIR/cmake/std/atdm/load-\/env.sh intel-\/opt-\/openmp}
\DoxyCodeLine{}
\DoxyCodeLine{\$ cmake \(\backslash\)}
\DoxyCodeLine{  -\/DTrilinos\_CONFIGURE\_OPTIONS\_FILE:STRING=cmake/std/atdm/ATDMDevEnv.cmake \(\backslash\)}
\DoxyCodeLine{  -\/DTrilinos\_ENABLE\_TESTS=ON -\/DTrilinos\_ENABLE\_MueLu=ON \(\backslash\)}
\DoxyCodeLine{  \$TRILINOS\_DIR}
\DoxyCodeLine{}
\DoxyCodeLine{\$ make -\/j16}
\DoxyCodeLine{}
\DoxyCodeLine{\$ salloc -\/N 1 -\/p standard -\/J \$ATDM\_CONFIG\_JOB\_NAME ctest -\/j16}
\end{DoxyCode}


{\bfseries{N\+O\+TE\+:}} Unlike some of the other machines, one must load the environment, configure and build on the login node and then run the test suite on a compute node on this system. This is what the C\+Test -\/S driver on \textquotesingle{}mutrino\textquotesingle{} does in order to drive jobs and submit to C\+Dash.

\doxysubsection*{S\+E\+MS rhel6 environment}

Once logged on to a rhel6 machine with the sems N\+FS env, one can directly configure, build, and run tests. For example, to configure, build and run the tests for {\ttfamily Mue\+Lu} one would clone Trilinos on the {\ttfamily develop} branch and then do the following\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ cd <some\_build\_dir>/}
\DoxyCodeLine{}
\DoxyCodeLine{\$ source \$TRILINOS\_DIR/cmake/std/atdm/load-\/env.sh sems-\/rhel6-\/intel-\/opt-\/openmp}
\DoxyCodeLine{}
\DoxyCodeLine{\$ cmake \(\backslash\)}
\DoxyCodeLine{  -\/GNinja \(\backslash\)}
\DoxyCodeLine{  -\/DTrilinos\_CONFIGURE\_OPTIONS\_FILE:STRING=cmake/std/atdm/ATDMDevEnv.cmake \(\backslash\)}
\DoxyCodeLine{  -\/DTrilinos\_ENABLE\_TESTS=ON -\/DTrilinos\_ENABLE\_MueLu=ON \(\backslash\)}
\DoxyCodeLine{  \$TRILINOS\_DIR}
\DoxyCodeLine{}
\DoxyCodeLine{\$ make NP=16}
\DoxyCodeLine{}
\DoxyCodeLine{\$ ctest -\/j8}
\end{DoxyCode}


N\+O\+TE\+: Above including {\ttfamily sems-\/rhel6} in the job build name {\ttfamily sems-\/rhel6-\/intel-\/opt-\/openmp} is not necessary but is recommended when on a C\+EE L\+AN R\+H\+E\+L6 machine to be explicit that the S\+E\+MS env is being used and not the \href{\#cee-rhel6-environment}{\texttt{ C\+EE R\+H\+E\+L6 env}}.

One can also run the same build a tests using the \href{\#checkin-test-atdmsh}{\texttt{ checkin-\/test-\/atdm.\+sh}} script as\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ cd <some\_build\_dir>/}
\DoxyCodeLine{\$ ln -\/s \$TRILINOS\_DIR/cmake/std/atdm/checkin-\/test-\/atdm.sh .}
\DoxyCodeLine{\$ ./checkin-\/test-\/atdm.sh sems-\/rhel6-\/clang-\/opt-\/openmp \(\backslash\)}
\DoxyCodeLine{  -\/-\/enable-\/packages=MueLu \(\backslash\)}
\DoxyCodeLine{  -\/-\/local-\/do-\/all}
\end{DoxyCode}


N\+O\+TE\+: The number of parallel build and test processes in this case are determine automatically from the number of cores on the current machine. But this can be overridden by setting the env var {\ttfamily A\+T\+D\+M\+\_\+\+C\+O\+N\+F\+I\+G\+\_\+\+N\+U\+M\+\_\+\+C\+O\+R\+E\+S\+\_\+\+O\+N\+\_\+\+M\+A\+C\+H\+I\+N\+E\+\_\+\+O\+V\+E\+R\+R\+I\+DE} {\bfseries{before}} sourcing the {\ttfamily atdm/load-\/env.\+sh $<$job-\/name$>$} script.

\doxysubsection*{C\+EE R\+H\+E\+L6 environment}

Once logged into any C\+EE L\+AN R\+H\+E\+L6 S\+RN machine, one can configure, build, and run tests for any A\+T\+DM Trilinos package. For example, to configure, build and run the tests for the {\ttfamily cee-\/rhel6-\/clang-\/opt-\/openmp} build for say {\ttfamily Mue\+Lu} on a C\+EE L\+AN machine, (after cloning Trilinos on the {\ttfamily develop} branch) one would do\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ cd <some\_build\_dir>/}
\DoxyCodeLine{}
\DoxyCodeLine{\$ source \$TRILINOS\_DIR/cmake/std/atdm/load-\/env.sh cee-\/rhel6-\/clang-\/opt-\/openmp}
\DoxyCodeLine{}
\DoxyCodeLine{\$ cmake \(\backslash\)}
\DoxyCodeLine{  -\/GNinja \(\backslash\)}
\DoxyCodeLine{  -\/DTrilinos\_CONFIGURE\_OPTIONS\_FILE:STRING=cmake/std/atdm/ATDMDevEnv.cmake \(\backslash\)}
\DoxyCodeLine{  -\/DTrilinos\_ENABLE\_TESTS=ON -\/DTrilinos\_ENABLE\_MueLu=ON \(\backslash\)}
\DoxyCodeLine{  \$TRILINOS\_DIR}
\DoxyCodeLine{}
\DoxyCodeLine{\$ make NP=16}
\DoxyCodeLine{}
\DoxyCodeLine{\$ ctest -\/j16}
\end{DoxyCode}


N\+O\+TE\+: Above one must include {\ttfamily cee-\/rhel6} in the build job name {\ttfamily cee-\/rhel6-\/clang-\/opt-\/openmp} in order to select the {\ttfamily cee-\/rhel6} env on a C\+EE L\+AN R\+H\+E\+L6 machine or the \href{\#sems-rhel6-environment}{\texttt{ sems-\/rhel6}} env will be used by default.

One can also run the same build a tests using the \href{\#checkin-test-atdmsh}{\texttt{ checkin-\/test-\/atdm.\+sh}} script as\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ cd <some\_build\_dir>/}
\DoxyCodeLine{\$ ln -\/s \$TRILINOS\_DIR/cmake/std/atdm/checkin-\/test-\/atdm.sh .}
\DoxyCodeLine{\$ env ATDM\_CHT\_DEFAULT\_ENV=cee-\/rhel6-\/default \(\backslash\)}
\DoxyCodeLine{  ./checkin-\/test-\/atdm.sh cee-\/rhel6-\/clang-\/opt-\/openmp \(\backslash\)}
\DoxyCodeLine{  -\/-\/enable-\/packages=MueLu \(\backslash\)}
\DoxyCodeLine{  -\/-\/local-\/do-\/all}
\end{DoxyCode}


N\+O\+TE\+: Above one must set {\ttfamily A\+T\+D\+M\+\_\+\+C\+H\+T\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+NV=cee-\/rhel6-\/default} in the env when passing in {\ttfamily all} in order for it to select the correct set of supported builds for the {\ttfamily cee-\/rhel6} env.

N\+O\+TE\+: The number of parallel build and test processes in this case are determine automatically from the number of cores on the current machine. But this can be overridden by setting the env var {\ttfamily A\+T\+D\+M\+\_\+\+C\+O\+N\+F\+I\+G\+\_\+\+N\+U\+M\+\_\+\+C\+O\+R\+E\+S\+\_\+\+O\+N\+\_\+\+M\+A\+C\+H\+I\+N\+E\+\_\+\+O\+V\+E\+R\+R\+I\+DE} {\bfseries{before}} sourcing the {\ttfamily atdm/load-\/env.\+sh $<$job-\/name$>$} script.

\doxysubsection*{waterman}

Once logged on to {\ttfamily waterman} (S\+RN), one can directly configure and build on the login node (being careful not to overload the node). But to run the tests, one must run on the compute nodes using the {\ttfamily bsub} command to run if using a C\+U\+DA build. For example, to configure, build and run the tests for the default {\ttfamily cuda-\/debug} build for say {\ttfamily Mue\+Lu} (after cloning Trilinos on the {\ttfamily develop} branch) one would do\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ cd <some\_build\_dir>/}
\DoxyCodeLine{}
\DoxyCodeLine{\$ source \$TRILINOS\_DIR/cmake/std/atdm/load-\/env.sh cuda-\/debug}
\DoxyCodeLine{}
\DoxyCodeLine{\$ cmake \(\backslash\)}
\DoxyCodeLine{  -\/GNinja \(\backslash\)}
\DoxyCodeLine{  -\/DTrilinos\_CONFIGURE\_OPTIONS\_FILE:STRING=cmake/std/atdm/ATDMDevEnv.cmake \(\backslash\)}
\DoxyCodeLine{  -\/DTrilinos\_ENABLE\_TESTS=ON -\/DTrilinos\_ENABLE\_MueLu=ON \(\backslash\)}
\DoxyCodeLine{  \$TRILINOS\_DIR}
\DoxyCodeLine{}
\DoxyCodeLine{\$ make NP=20}
\DoxyCodeLine{}
\DoxyCodeLine{\$ bsub -\/x -\/Is -\/n 20 ctest -\/j20}
\end{DoxyCode}


{\bfseries{N\+O\+TE\+:}} While the above example shows loading the environment, configuring and building on the login node, one can also do these on the compute nodes as well. In fact, that is what the C\+Test -\/S drivers do in automated testing on \textquotesingle{}waterman\textquotesingle{}.

Note that one can also run the same build a tests using the \href{\#checkin-test-atdmsh}{\texttt{ checkin-\/test-\/atdm.\+sh}} script as\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ cd <some\_build\_dir>/}
\DoxyCodeLine{\$ ln -\/s \$TRILINOS\_DIR/cmake/std/atdm/checkin-\/test-\/atdm.sh .}
\DoxyCodeLine{\$ bsub -\/x -\/Is -\/n 20 \(\backslash\)}
\DoxyCodeLine{  ./checkin-\/test-\/atdm.sh cuda-\/debug -\/-\/enable-\/packages=MueLu -\/-\/local-\/do-\/all}
\end{DoxyCode}


\doxysection*{Troubleshooting configuration problems}

There are situations were a particular developer on a particular system will not be able to cleanly reproduce a Trilinos configuration as described above. Some of the issues that can cause that are described here.

The first set of problems that might occur are that the version of {\ttfamily git} that is loaded by sourcing {\ttfamily Trilinos/cmake/std/atdm/load-\/env.\+sh} for a given system may conflict with the developer\textquotesingle{}s global {\ttfamily $\sim$/.gitconfig} file on that system. It may be that an older or newer version of git is loaded by the script (i.\+e. {\ttfamily $<$atdm-\/loaded-\/git$>$}) than the git version that the developer has been using on the system (i.\+e. {\ttfamily $<$developer-\/git$>$}) and therefore some of the settings in the developer\textquotesingle{}s {\ttfamily $\sim$/.gitconfig} file may not be compatible with the different version of git. One approach to address this is run {\ttfamily module list} to see the version of git that is loaded by this script and then to swap out that version of git for the developer\textquotesingle{}s regular version of git using {\ttfamily module swap $<$atdm-\/loaded-\/git$>$ $<$developer-\/git$>$}. Or, the developer can just call {\ttfamily export P\+A\+TH=$<$path-\/to-\/developers-\/-\/git$>$/bin\+:\$\+P\+A\+TH} after sourcing {\ttfamily Trilinos/cmake/std/atdm/load-\/env.\+sh} to select the developer\textquotesingle{}s regular version of git. The git commands that are used by Tri\+B\+I\+TS, Trilinos, and the A\+T\+DM Trilinos configuration and testing scripts should work with just about any version of git 2.\+0+. Another approach would be for the user to (temporarily) edit their {\ttfamily $\sim$/.gitconfig} file to address the problems.

\doxysection*{Directory structure and contents}

This base directory\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{cmake/std/atdm/}
\end{DoxyCode}


contains the following files\+:


\begin{DoxyItemize}
\item {\bfseries{A\+T\+D\+M\+Dev\+Env\+Settings.\+cmake}}\+: Reads vars out of the env (loaded with {\ttfamily load-\/env.\+sh}) to set compilers and other options for the Trilinos build. It also default enables all of the T\+P\+Ls used in A\+T\+DM configurations of Trilinos. However, this file does {\bfseries{not}} include {\ttfamily A\+T\+D\+M\+Disables.\+cmake}. Therefore, this file can be used to set up builds of Trilinos that enable arbitrary sets of packages.
\item {\bfseries{A\+T\+D\+M\+Disables.\+cmake}}\+: Disables a bunch of Trilinos packages and subpackages not used by A\+T\+DM application customers. This file gets included automatically in {\ttfamily A\+T\+D\+M\+Dev\+Env.\+cmake} (so you don\textquotesingle{}t need to list it in local configures of Trilinos). But this file is also included in the outer {\ttfamily ctest -\/S} driver script code for A\+T\+DM builds of Trilinos which is needed for correct package-\/by-\/package testing of Trilinos.
\item {\bfseries{A\+T\+D\+M\+Dev\+Env.\+cmake}}\+: Includes {\ttfamily A\+T\+D\+M\+Dev\+Env\+Settings.\+cmake} and {\ttfamily A\+T\+D\+M\+Disables.\+cmake}.
\item {\bfseries{checkin-\/test-\/atdm.\+sh}}\+: Uses the {\ttfamily Trilinos/checkin-\/test.\+py} script to drive builds and tests on the given platform. (See comments in the top of the script for instructions.)
\end{DoxyItemize}

Each supported A\+T\+DM system {\ttfamily $<$system-\/name$>$} has its own sub-\/directory with the contents\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{<system-\/name>/}
\DoxyCodeLine{  environment.sh  \# Load env for the given system based on \$ATDM\_CONFIG\_JOB\_NAME keys}
\DoxyCodeLine{  all\_supported\_builds.sh  \# [Optional] List of all supported builds}
\DoxyCodeLine{  tweaks/}
\DoxyCodeLine{     <COMPILER0>-\/<BUILD\_TYPE0>-\/<NODE\_TYPE0>-\/<KOKKOS\_ARCH0>.cmake  \# [Optional]}
\DoxyCodeLine{     <COMPILER1>-\/<BUILD\_TYPE1>-\/<NODE\_TYPE1>-\/<KOKKOS\_ARCH0>.cmake  \# [Optional]}
\DoxyCodeLine{     ...}
\end{DoxyCode}


The optional file {\ttfamily $<$system-\/name$>$/all\+\_\+supported\+\_\+builds.sh} contains a list of all of the supported builds on the system. This sets the environment variable {\ttfamily A\+T\+D\+M\+\_\+\+C\+O\+N\+F\+I\+G\+\_\+\+A\+L\+L\+\_\+\+S\+U\+P\+P\+O\+R\+T\+E\+D\+\_\+\+B\+U\+I\+L\+DS} as\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{export ATDM\_CONFIG\_ALL\_SUPPORTED\_BUILDS="gnu-\/debug-\/openmp gnu-\/opt-\/openmp ..."}
\end{DoxyCode}


This is used in the {\ttfamily checkin-\/test-\/atdm.\+sh} script to run all of the builds for a system with {\ttfamily checkin-\/test-\/atdm.\+sh all \mbox{[}other options\mbox{]}}.

\label{_ATDM_TWEAKS_FILES}%


The files in the {\ttfamily cmake/std/atdm/$<$system-\/name$>$/tweaks/} directory contain special settings for specific builds for a specific system. Typically, this file contains (temporary) disables for tests for that given build. When a configure is performed, the internal C\+Make variable {\ttfamily A\+T\+D\+M\+\_\+\+J\+O\+B\+\_\+\+N\+A\+M\+E\+\_\+\+K\+E\+Y\+S\+\_\+\+S\+TR} set to {\ttfamily $<$C\+O\+M\+P\+I\+L\+ER$>$-\/$<$B\+U\+I\+L\+D\+\_\+\+T\+Y\+PE$>$-\/$<$N\+O\+D\+E\+\_\+\+T\+Y\+PE$>$-\/$<$K\+O\+K\+K\+O\+S\+\_\+\+A\+R\+CH$>$} (printed to S\+T\+D\+O\+UT) is used to define a default file name\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Trilinos/cmake/std/atdm/<system-\/name>/tweaks/\$\{ATDM\_JOB\_NAME\_KEYS\_STR\}.cmake}
\end{DoxyCode}


If that file exists, then it is set as the default for the cmake cache variable {\ttfamily A\+T\+D\+M\+\_\+\+T\+W\+E\+A\+K\+S\+\_\+\+F\+I\+L\+ES} (prints to S\+T\+D\+O\+UT) and that file is included and its options are read. For example, this is what the output looks like on \textquotesingle{}waterman\textquotesingle{}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{-\/-\/ Reading in configuration options from cmake/std/atdm/ATDMDevEnv.cmake ...}
\DoxyCodeLine{-\/-\/ ATDM\_JOB\_NAME\_KEYS\_STR='GNU-\/RELEASE-\/OPENMP-\/POWER9'}
\DoxyCodeLine{-\/-\/ ATDM\_TWEAKS\_FILES='<...>/Trilinos/cmake/std/atdm/waterman/tweaks/GNU-\/RELEASE-\/OPENMP-\/POWER9.cmake'}
\DoxyCodeLine{-\/-\/ Including ATDM build tweaks file <...>//Trilinos/cmake/std/atdm/waterman/tweaks/GNU-\/RELEASE-\/OPENMP-\/POWER9.cmake ...}
\end{DoxyCode}


\doxysection*{Disabling failing tests}

There are situations where specific tests must be disabled on certain platforms for certain builds or based on other criteria (see sub-\/process \href{https://snl-wiki.sandia.gov/display/CoodinatedDevOpsATDM/Triaging+and+addressing+ATDM+Trilinos+Failures\#TriagingandaddressingATDMTrilinosFailures-5.Makesuretheissueisaddressedinatimelyway:}{\texttt{ Temporarily disable the failing code or test}}). There are various ways to disable tests with the Trilinos Tri\+B\+I\+T\+S/\+C\+Make-\/based build and test system. Tests can be disabled in the {\ttfamily C\+Make\+Lists.\+txt} files that define the tests themselves using various logic. But the way to selectively disable tests for the A\+T\+DM Trilinos builds that will be described here will be to only modify files under the {\ttfamily Trilinos/cmake/std/atdm/} directory. This will be done by setting the C\+Make cache variable {\ttfamily $<$full-\/test-\/name$>$\+\_\+\+D\+I\+S\+A\+B\+LE=ON} for each test to be disabled where {\ttfamily $<$full-\/test-\/name$>$} is the full test name. For example, to disable the test {\ttfamily Mue\+Lu\+\_\+\+Unit\+Tests\+Tpetra\+\_\+\+M\+P\+I\+\_\+4}, one would set the C\+Make cache variable {\ttfamily Mue\+Lu\+\_\+\+Unit\+Tests\+Tpetra\+\_\+\+M\+P\+I\+\_\+4\+\_\+\+D\+I\+S\+A\+B\+LE=ON}. The Tri\+B\+I\+T\+S/\+C\+Make configure system will then disable the test and print the following line during configuration (when {\ttfamily Trilinos\+\_\+\+T\+R\+A\+C\+E\+\_\+\+A\+D\+D\+\_\+\+T\+E\+ST=ON} is also set)\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{-\/-\/ MueLu\_UnitTestsTpetra\_MPI\_4: NOT added test because MueLu\_UnitTestsTpetra\_MPI\_4\_DISABLE='ON'!}
\end{DoxyCode}


The C\+Make function {\ttfamily A\+T\+D\+M\+\_\+\+S\+E\+T\+\_\+\+E\+N\+A\+B\+L\+E()} is provided in order to set the disable such as with\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ATDM\_SET\_ENABLE(MueLu\_UnitTestsTpetra\_MPI\_4\_DISABLE ON)}
\end{DoxyCode}


Using this function will result in the C\+Make cache variable {\ttfamily $<$full-\/test-\/name$>$\+\_\+\+D\+I\+S\+A\+B\+LE} to get set to {\ttfamily ON} by default and will print the disable to the C\+Make S\+T\+D\+O\+UT when the {\ttfamily A\+T\+D\+M\+\_\+\+S\+E\+T\+\_\+\+E\+N\+A\+B\+L\+E()} is run, such as\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{-\/-\/ Setting default MueLu\_UnitTestsTpetra\_MPI\_4\_DISABLE=ON}
\end{DoxyCode}


This approach also allows a user to enable the test by adding {\ttfamily -\/D$<$full-\/test-\/name$>$\+\_\+\+D\+I\+S\+A\+B\+LE=O\+FF} to the configure line (which overrides the default {\ttfamily ON}).

However, before any tests are disabled, there must be a Trilinos Git\+Hub issue addressing the failing test(s) and the Git\+Hub issue number (e.\+g. {\ttfamily \#2839}) must put into a comment above the {\ttfamily A\+T\+D\+M\+\_\+\+S\+E\+T\+\_\+\+E\+N\+A\+B\+L\+E()} statement and the issue number must be added to the git commit message (see \mbox{[}Create a Trilinos Git\+Hub issue for the failure\mbox{]}(\href{https://snl-wiki.sandia.gov/display/CoodinatedDevOpsATDM/Triaging+and+addressing+ATDM+Trilinos+Failures\#TriagingandaddressingATDMTrilinosFailures-3.CreateaTrilinosGitHubissueforthefailure:}{\texttt{ https\+://snl-\/wiki.\+sandia.\+gov/display/\+Coodinated\+Dev\+Ops\+A\+T\+D\+M/\+Triaging+and+addressing+\+A\+T\+D\+M+\+Trilinos+\+Failures\#\+Triagingandaddressing\+A\+T\+D\+M\+Trilinos\+Failures-\/3.\+Createa\+Trilinos\+Git\+Hubissueforthefailure\+:}})).

The best file to add the {\ttfamily A\+T\+D\+M\+\_\+\+S\+E\+T\+\_\+\+E\+N\+A\+B\+LE($<$full-\/test-\/name$>$\+\_\+\+D\+I\+S\+A\+B\+LE ON)} statement to based on different situations is described in the following sub-\/sections\+:


\begin{DoxyItemize}
\item \href{\#disable-a-test-for-a-specific-build-on-a-specific-platform}{\texttt{ Disable a test for a specific build on a specific platform}}
\item \href{\#disable-a-test-for-several-or-all-builds-on-a-specific-platform}{\texttt{ Disable a test for several or all builds on a specific platform}}
\item \href{\#disable-a-test-for-builds-on-all-platforms}{\texttt{ Disable a test for builds on all platforms}}
\end{DoxyItemize}

\doxysubsection*{Disable a test for a specific build on a specific platform}

In order to disable a test for a single build on single platform, one will want to put the {\ttfamily A\+T\+D\+M\+\_\+\+S\+E\+T\+\_\+\+E\+N\+A\+B\+L\+E()} statement into the \href{\#ATDM_TWEAKS_FILES}{\texttt{ tweaks file}} for that build and platform\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Trilinos/cmake/std/atdm/<system-\/name>/tweaks/<ATDM\_JOB\_NAME\_KEYS\_STR>.cmake}
\end{DoxyCode}


The tweak file being looked for is printed out in the C\+Make configure output as the line\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{-\/-\/ ATDM\_TWEAKS\_FILES='.../Trilinos/cmake/std/atdm/<system-\/name>/tweaks/<ATDM\_JOB\_NAME\_KEYS\_STR>.cmake'}
\end{DoxyCode}


For example, for the {\ttfamily intel-\/debug-\/openmp-\/\+K\+NL} build on \textquotesingle{}mutrino\textquotesingle{}, the printout would be\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{-\/-\/ ATDM\_TWEAKS\_FILES='.../Trilinos/cmake/std/atdm/mutrino/tweaks/INTEL-\/DEBUG-\/OPENMP-\/KNL.cmake'}
\end{DoxyCode}


For example, Trilinos commit \href{https://github.com/trilinos/Trilinos/commit/73ae19cf0cc7295a7f36de342ea51718226825b7}{\texttt{ 73ae19cf0c}} shows the disable of the test\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\# Disable test that times out for some unkown reason (\#2925)}
\DoxyCodeLine{ATDM\_SET\_ENABLE(Stratimikos\_test\_aztecoo\_thyra\_driver\_MPI\_1\_DISABLE ON)}
\end{DoxyCode}


in both the files {\ttfamily cmake/std/atdm/shiller/tweaks/\+G\+N\+U-\/\+D\+E\+B\+U\+G-\/\+S\+E\+R\+I\+A\+L.\+cmake} and {\ttfamily cmake/std/atdm/shiller/tweaks/\+G\+N\+U-\/\+R\+E\+L\+E\+A\+S\+E-\/\+S\+E\+R\+I\+A\+L.\+cmake} (before {\ttfamily -\/H\+SW} was added to the names).

N\+O\+TE\+: Adding a comment with the Trilinos Git\+Hub Issue ID ({\ttfamily \#2925} in this example) is critical for tractability to remind why the test was disabled and where to find the disable to remove it later.

To avoid duplicate {\ttfamily A\+T\+D\+M\+\_\+\+S\+E\+T\+\_\+\+E\+N\+A\+B\+L\+E()} statements, one can use the approach of creating a single {\ttfamily $\ast$.cmake} that is included in the different tweak files as described below.

\doxysubsection*{Disable a test for several or all builds on a specific platform}

It is often the case that a test needs to be disabled for several (or all) builds for a given platform. An efficient way to do this is to create a new {\ttfamily $\ast$.cmake} file that contains the {\ttfamily A\+T\+D\+M\+\_\+\+S\+E\+T\+\_\+\+E\+N\+A\+B\+L\+E()} statements and then include that new file in all of the tweaks files on that system where the tests should be disabled.

For example, the Trilinos commit \href{https://github.com/trilinos/Trilinos/commit/3450efd421f1ce2b47700853aa4c5801f667202a}{\texttt{ 3450efd421}} shows how a set of tests were disabled for all of the C\+U\+DA builds on the system {\ttfamily ride} through the creation of the file\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Trilinos/cmake/std/atdm/ride/tweaks/CUDA\_COMMON\_TWEAKS.cmake}
\end{DoxyCode}


and then the inclusion of that file in the specific tweak files for each C\+U\+DA build\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Trilinos/cmake/std/atdm/ride/tweaks/CUDA-\/DEBUG-\/CUDA.cmake}
\DoxyCodeLine{Trilinos/cmake/std/atdm/ride/tweaks/CUDA-\/RELEASE-\/CUDA.cmake}
\end{DoxyCode}


(before {\ttfamily -\/P\+O\+W\+E\+R8-\/\+K\+E\+P\+L\+E\+R37} was added to the names) using the inserted C\+Make statement\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{INCLUDE("\$\{CMAKE\_CURRENT\_LIST\_DIR\}/CUDA\_COMMON\_TWEAKS.cmake")}
\end{DoxyCode}


An example of using a {\ttfamily $\ast$.cmake} file to disable the same set of tests in all of the builds for a given system is shown in Trilinos commit \href{https://github.com/trilinos/Trilinos/commit/33a933b004f88710274906fad612380049e1e82e}{\texttt{ 33a933b004}}. This example shows the creation of the file\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Trilinos/cmake/std/atdm/ride/tweaks/ALL\_COMMON\_TWEAKS.cmake}
\end{DoxyCode}


and then the inclusion of that file in all of the specific tweaks files on \textquotesingle{}ride\textquotesingle{} with the statement\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{INCLUDE("\$\{CMAKE\_CURRENT\_LIST\_DIR\}/ALL\_COMMON\_TWEAKS.cmake")}
\end{DoxyCode}


in each of those files.

\doxysubsection*{Disable a test for builds on all platforms}

There are rare cases where a test (or a set of tests) will need to be disabled for all or a subset of builds across all systems. To do that using the above-\/described approaches would require touching files in every {\ttfamily cmake/std/atdm/$<$system-\/name$>$/tweaks/} directory. In rare cases like this, one can accomplish this by adding a (conditional) {\ttfamily A\+T\+D\+M\+\_\+\+S\+E\+T\+\_\+\+E\+N\+A\+B\+L\+E()} statement for each test disable directly to the file\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Trilinos/cmake/std/atdm/ATDMDevEnvSettings.cmake}
\end{DoxyCode}


For example, Trilinos commit \href{https://github.com/trilinos/Trilinos/commit/5e52db03ff33acb5b9a0be7ba7507a8bb0de6e30}{\texttt{ 5e52db03ff}} added the C\+Make code\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\# Disable test that fails for all openmp builds (\#3035)}
\DoxyCodeLine{IF (ATDM\_USE\_OPENMP)}
\DoxyCodeLine{  ATDM\_SET\_ENABLE(MueLu\_UnitTestsTpetra\_MPI\_4\_DISABLE ON)}
\DoxyCodeLine{ENDIF()}
\end{DoxyCode}


to the file {\ttfamily A\+T\+D\+M\+Dev\+Env\+Settings.\+cmake} to disable the test {\ttfamily Mue\+Lu\+\_\+\+Unit\+Tests\+Tpetra\+\_\+\+M\+P\+I\+\_\+4} for all Open\+MP builds across all platforms. (Note that that disable was later removed in Trilinos commit \href{https://github.com/trilinos/Trilinos/commit/62fa6663a6d5a757d786ac87752c3e2074d28414}{\texttt{ 62fa6663a6}} after the test was fixed.)

\doxysection*{Specific systems supported}

The specific {\ttfamily cmake/std/atdm/$<$system-\/name$>$/} sub-\/directories and the systems they support are\+:


\begin{DoxyItemize}
\item {\ttfamily cee-\/rhel6/}\+: C\+EE L\+A\+NL R\+H\+E\+L6 systems with a C\+EE environment
\item {\ttfamily chama/}\+: Supports S\+NL H\+PC machine {\ttfamily chama}.
\item {\ttfamily mutrino/}\+: Supports S\+NL H\+PC machine {\ttfamily mutrino}.
\item {\ttfamily ride/}\+: Supports G\+NU and C\+U\+DA builds on both the S\+RN machine {\ttfamily ride} and the mirror S\+ON machine {\ttfamily white}.
\item {\ttfamily sems-\/rhel6/}\+: R\+H\+E\+L6 systems with the S\+E\+MS N\+FS environment
\item {\ttfamily serrano/}\+: Supports S\+NL H\+PC machine {\ttfamily serrano}.
\item {\ttfamily shiller/}\+: Supports G\+NU, Intel, and C\+U\+DA builds on both the S\+RN machine {\ttfamily shiller} and the mirror S\+ON machine {\ttfamily hansen}.
\item {\ttfamily waterman/}\+: Supports G\+NU and C\+U\+DA builds on the S\+RN machine {\ttfamily waterman}. 
\end{DoxyItemize}