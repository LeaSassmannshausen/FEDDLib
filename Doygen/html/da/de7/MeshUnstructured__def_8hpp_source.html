<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FEDDLib: /home/user/Programme/opt/FEDDLib/FEEDLIB_LEA/source/FEDDLib/feddlib/core/Mesh/MeshUnstructured_def.hpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FEDDLib
   </div>
   <div id="projectbrief">Finite Element Domain Decomposition Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_a7abe54e76939ade77b37861375e4c18.html">feddlib</a></li><li class="navelem"><a class="el" href="../../dir_4d2a120ed35eb3406b5c375f9d7da577.html">core</a></li><li class="navelem"><a class="el" href="../../dir_d050f8c708fed916b10437859acdd62f.html">Mesh</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">MeshUnstructured_def.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#ifndef MESHUNSTRUCTURED_def_hpp</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#define MESHUNSTRUCTURED_def_hpp</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &quot;MeshUnstructured_decl.hpp&quot;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &quot;feddlib/core/LinearAlgebra/MultiVector_def.hpp&quot;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">using namespace </span>std;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">namespace </span><a class="code" href="../../d0/dac/namespaceFEDD.html">FEDD</a> {</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;MeshUnstructured&lt;SC,LO,GO,NO&gt;::MeshUnstructured():</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;Mesh&lt;SC,LO,GO,NO&gt;(),</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;meshInterface_(),</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;volumeID_(10),</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;edgeElements_(),</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;surfaceEdgeElements_(),</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;meshFileName_(<span class="stringliteral">&quot;fileName.mesh&quot;</span>),</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;delimiter_(<span class="stringliteral">&quot; &quot;</span>)</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">//#ifdef FULL_TIMER</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">//,TotalP1ToP2Time_(Teuchos::TimeMonitor::getNewCounter(&quot;FE: Unstructured Mesh: Total P1 to P2&quot;)),</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">//BuildRedundantInfoTime_ (Teuchos::TimeMonitor::getNewCounter(&quot;FE: Unstructured Mesh: Build Redundant Info&quot;)),</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">//SortUniqueRedundantInfoTime_ (Teuchos::TimeMonitor::getNewCounter(&quot;FE: Unstructured Mesh: Sort Unique redundant&quot;)),</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">//CheckingFlaggedAndDeleteTime_ (Teuchos::TimeMonitor::getNewCounter(&quot;FE: Unstructured Mesh: Flagged &amp; Delete Interior&quot;)),</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">//CheckingFlaggedTime_ (Teuchos::TimeMonitor::getNewCounter(&quot;FE: Unstructured Mesh: Flagged &amp; Delete Interior: Flagged&quot;)),</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">//DeleteInteriorTime_(Teuchos::TimeMonitor::getNewCounter(&quot;FE: Unstructured Mesh: Flagged &amp; Delete Interior: Interior&quot;)),</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">//SetGlobalInterfaceIDTime_ (Teuchos::TimeMonitor::getNewCounter(&quot;FE: Unstructured Mesh: Set Global IDs&quot;)),</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">//SetP2InfoTime_(Teuchos::TimeMonitor::getNewCounter(&quot;FE: Unstructured Mesh: Set P2 Information&quot;)),</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">//GatherAllMarkedTime_(Teuchos::TimeMonitor::getNewCounter(&quot;FE: Unstructured Mesh: Flagged &amp; Delete Interior: Flagged: Gather All&quot;)),</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">//UniqueAndFindMarkedTime_(Teuchos::TimeMonitor::getNewCounter(&quot;FE: Unstructured Mesh: Flagged &amp; Delete Interior: Flagged: Unique and MaxAll&quot;)),</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">//UniqueNewFaceTime_(Teuchos::TimeMonitor::getNewCounter(&quot;FE: Unstructured Mesh: Flagged &amp; Delete Interior: Flagged: Unique new Faces&quot;)),</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">//SumAllMarkedTime_(Teuchos::TimeMonitor::getNewCounter(&quot;FE: Unstructured Mesh: Flagged &amp; Delete Interior: Flagged: Sum All&quot;)),</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">//SetP2PointsTime_(Teuchos::TimeMonitor::getNewCounter(&quot;FE: Unstructured Mesh: Set P2 Information: Set Points&quot;)),</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">//SetP2ElementsTime_(Teuchos::TimeMonitor::getNewCounter(&quot;FE: Unstructured Mesh: Set P2 Information: Set Elements&quot;))</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">//#endif</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;{</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    edgeElements_ = Teuchos::rcp( <span class="keyword">new</span> EdgeElements_Type() );</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    surfaceEdgeElements_ = Teuchos::rcp( <span class="keyword">new</span> Elements_Type() );</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;}</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;MeshUnstructured&lt;SC,LO,GO,NO&gt;::MeshUnstructured(CommConstPtr_Type comm, <span class="keywordtype">int</span> volumeID):</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;Mesh&lt;SC,LO,GO,NO&gt;(comm),</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;meshInterface_(),</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;volumeID_(volumeID),</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;edgeElements_(),</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;surfaceEdgeElements_(),</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;meshFileName_(<span class="stringliteral">&quot;fileName.mesh&quot;</span>),</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;delimiter_(<span class="stringliteral">&quot; &quot;</span>)</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;{</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    edgeElements_ = Teuchos::rcp( <span class="keyword">new</span> EdgeElements_Type() );</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    surfaceEdgeElements_ = Teuchos::rcp( <span class="keyword">new</span> Elements_Type() );</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;}</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;MeshUnstructured&lt;SC,LO,GO,NO&gt;::~MeshUnstructured(){</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;}</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keywordtype">void</span> MeshUnstructured&lt;SC,LO,GO,NO&gt;::getTriangles(<span class="keywordtype">int</span> vertex1ID, <span class="keywordtype">int</span> vertex2ID, vec_int_Type &amp;vertices3ID){</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    vertices3ID.resize(2);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">if</span> (vertex2ID&lt;vertex1ID) {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keywordtype">int</span> tmp = vertex2ID;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        vertex2ID = vertex1ID;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        vertex1ID = tmp;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">if</span> (vertex1ID == 0) {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordflow">if</span> (vertex2ID == 1) {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            vertices3ID.at(0) = 2;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            vertices3ID.at(1) = 3;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        }</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vertex2ID == 2) {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            vertices3ID.at(0) = 1;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            vertices3ID.at(1) = 3;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        }</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vertex2ID == 3) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            vertices3ID.at(0) = 1;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            vertices3ID.at(1) = 2;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        }</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(vertex1ID == 1){</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">if</span> (vertex2ID == 2) {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            vertices3ID.at(0) = 0;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            vertices3ID.at(1) = 3;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vertex2ID == 3) {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            vertices3ID.at(0) = 0;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            vertices3ID.at(1) = 2;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    }</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(vertex1ID == 2){</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keywordflow">if</span> (vertex2ID == 3) {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            vertices3ID.at(0) = 0;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            vertices3ID.at(1) = 1;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="preprocessor">#ifdef ASSERTS_WARNINGS</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        MYASSERT(<span class="keyword">false</span>,<span class="stringliteral">&quot;Could not identify triangle.&quot;</span>);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00119"></a><span class="lineno"><a class="line" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html#a06539e8a4e35240b21b40d85622ca754">  119</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::buildP2ofP1MeshEdge</a>( MeshUnstrPtr_Type meshP1 ){</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">// If flags of line segments should be used over surface flags, this functions must be checked</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;     <span class="keywordtype">int</span> rank = this-&gt;comm_-&gt;getRank();</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    this-&gt;rankRange_ = meshP1-&gt;rankRange_;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordtype">bool</span> verbose( this-&gt;comm_-&gt;getRank() == 0 );</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    this-&gt;elementMap_ = meshP1-&gt;elementMap_;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    this-&gt;edgeMap_ = meshP1-&gt;edgeMap_;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    this-&gt;dim_ = meshP1-&gt;getDimension();</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    this-&gt;FEType_ = <span class="stringliteral">&quot;P2&quot;</span>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    this-&gt;numElementsGlob_ = meshP1-&gt;numElementsGlob_;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">//this-&gt;surfaceTriangleElements_ = meshP1-&gt;surfaceTriangleElements_; // for later</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    meshP1-&gt;assignEdgeFlags(); <span class="comment">// Function that determines the flag for each edge. That way the P2 flags can easily be determined</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    GO P1Offset = meshP1-&gt;mapUnique_-&gt;getMaxAllGlobalIndex()+1;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    EdgeElementsPtr_Type edgeElements = meshP1-&gt;getEdgeElements();</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    ElementsPtr_Type elements = meshP1-&gt;getElementsC();</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;-- --  Start building P2 mesh -- -- &quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;-- Building edge mid points with edges and setting P2 elements ... &quot;</span> &lt;&lt; flush;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    vec2D_dbl_Type newPoints( edgeElements-&gt;numberElements(), vec_dbl_Type( this-&gt;dim_ ) );</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    vec_int_Type newFlags( edgeElements-&gt;numberElements(), -1 );</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordtype">int</span> newNodesPerElement = -1;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">if</span> (this-&gt;dim_==2)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        newNodesPerElement = 3;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (this-&gt;dim_==3)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        newNodesPerElement = 6;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    vec2D_LO_Type newElementNodes( elements-&gt;numberElements(), vec_LO_Type( newNodesPerElement, -1 ) );</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    vec2D_dbl_ptr_Type pointsP1 = meshP1-&gt;getPointsRepeated();</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    MapConstPtr_Type mapRepeatedP1 = meshP1-&gt;getMapRepeated();</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">// loop over all previously created edges to construct new P2 points </span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;edgeElements-&gt;numberElements(); i++) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        LO p1ID = edgeElements-&gt;getElement(i).getNode( 0 );</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        LO p2ID = edgeElements-&gt;getElement(i).getNode( 1 );</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        GO id1 = mapRepeatedP1-&gt;getGlobalElement( p1ID );</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        GO id2 = mapRepeatedP1-&gt;getGlobalElement( p2ID );</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> d=0; d&lt;this-&gt;dim_; d++)</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            newPoints[i][d] = ( (*pointsP1)[p1ID][d] + (*pointsP1)[p2ID][d] ) / 2.; <span class="comment">// New point on middle of nodes</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        newFlags[i] = edgeElements-&gt;getElement(i).getFlag(); <span class="comment">// New flags according to edge flags</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                        </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keyword">const</span> vec_LO_Type elementsOfEdge = edgeElements-&gt;getElementsOfEdge( i );</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="keyword">const</span> vec_GO_Type elementsGlobalOfEdge = edgeElements-&gt;getElementsOfEdgeGlobal( i );</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        vec_GO_Type relevantElementsOfEdge(0);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;elementsOfEdge.size(); j++) {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <span class="keywordflow">if</span> ( elementsOfEdge[j] != OTLO::invalid() )</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                relevantElementsOfEdge.push_back( elementsOfEdge[j] );</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="comment">// We need to determine the correct location in the P2 element as prescribed by a specific pattern</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        vec_int_Type positions( relevantElementsOfEdge.size() );</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keywordflow">if</span> ( relevantElementsOfEdge.size() &gt; 0 )</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            determinePositionInElementP2( positions, relevantElementsOfEdge, p1ID, p2ID, meshP1 );</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keywordtype">int</span> factor = 0;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">if</span> (this-&gt;dim_==2)</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            factor=3;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(this-&gt;dim_==3)</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            factor = 4;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;relevantElementsOfEdge.size(); j++)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            newElementNodes[ relevantElementsOfEdge[j] ][ positions[j]-factor ] =  i ;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// Set P2 Elements, by resetting &#39;old&#39; elements and adding them with the new nodes per element</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    this-&gt;elementsC_.reset(<span class="keyword">new</span> <a class="code" href="../../de/dbb/classFEDD_1_1Elements.html">Elements</a>());</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    LO numberLocalP1Nodes = meshP1-&gt;getPointsRepeated()-&gt;size();</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;elements-&gt;numberElements(); i++) {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        vec_int_Type feNodeList = elements-&gt;getElement( i ).getVectorNodeListNonConst(); <span class="comment">// get a copy</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;newElementNodes[i].size(); j++)</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            feNodeList.push_back( newElementNodes[i][j] + numberLocalP1Nodes );</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <a class="code" href="../../dc/d7e/classFEDD_1_1FiniteElement.html">FiniteElement</a> feP2( feNodeList );</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        this-&gt;elementsC_-&gt;addElement(feP2);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;done --&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;-- Setting global point IDs and building repeated P2 map and repeated points ... &quot;</span> &lt;&lt; flush;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">// Now the corresponding maps for nodes and flags are updated.</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// Generally the P2 points are added after the P1 points in the node lists. Thus the new IDs just need to be added at the </span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// end of the maps</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    this-&gt;pointsRep_.reset(<span class="keyword">new</span> std::vector&lt;std::vector&lt;double&gt; &gt;(meshP1-&gt;pointsRep_-&gt;size(),vector&lt;double&gt;(this-&gt;dim_,-1.)));</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    *this-&gt;pointsRep_ = *meshP1-&gt;pointsRep_;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    this-&gt;bcFlagRep_.reset(<span class="keyword">new</span> vector&lt;int&gt;(meshP1-&gt;bcFlagRep_-&gt;size()));</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    *this-&gt;bcFlagRep_ = *meshP1-&gt;bcFlagRep_;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    this-&gt;pointsRep_-&gt;insert( this-&gt;pointsRep_-&gt;end(), newPoints.begin(), newPoints.end() );</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    this-&gt;bcFlagRep_-&gt;insert( this-&gt;bcFlagRep_-&gt;end(), newFlags.begin(), newFlags.end());</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    Teuchos::ArrayView&lt;const GO&gt; nodeList = meshP1-&gt;getMapRepeated()-&gt;getNodeElementList();</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    std::vector&lt;GO&gt; vecGlobalIDs = Teuchos::createVector( nodeList );</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">// To correctly determine the global nodeIDs of the new P2 nodes we set them via the global edge IDs.</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// As can be on more than one processor at a time, they are an easy way to determine the correct </span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">// nodeIDs via the edges&#39;globalID.</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;edgeElements-&gt;numberElements(); i++){</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        vecGlobalIDs.push_back( edgeElements-&gt;getGlobalID( (LO) i ) + P1Offset );</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    Teuchos::RCP&lt;std::vector&lt;GO&gt; &gt; pointsRepGlobMapping = Teuchos::rcp( <span class="keyword">new</span> vector&lt;GO&gt;( vecGlobalIDs ) );</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    Teuchos::ArrayView&lt;GO&gt; pointsRepGlobMappingArray = Teuchos::arrayViewFromVector( *pointsRepGlobMapping );</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    this-&gt;mapRepeated_.reset(<span class="keyword">new</span> <a class="code" href="../../dc/dae/classFEDD_1_1Map.html">Map&lt;LO,GO,NO&gt;</a>( meshP1-&gt;getMapRepeated()-&gt;getUnderlyingLib(), Teuchos::OrdinalTraits&lt;GO&gt;::invalid(), pointsRepGlobMappingArray, 0, this-&gt;comm_) );</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;done --&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;-- Building unique P2 map, setting unique points and setting P2 elements ... &quot;</span> &lt;&lt; flush;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    this-&gt;mapUnique_ = this-&gt;mapRepeated_-&gt;buildUniqueMap( this-&gt;rankRange_ );</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    this-&gt;pointsUni_.reset(<span class="keyword">new</span> std::vector&lt;std::vector&lt;double&gt; &gt;( this-&gt;mapUnique_-&gt;getNodeNumElements(), vector&lt;double&gt;(this-&gt;dim_,-1. ) ) );</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    this-&gt;bcFlagUni_.reset( <span class="keyword">new</span> std::vector&lt;int&gt; ( this-&gt;mapUnique_-&gt;getNodeNumElements(), 0 ) );</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;this-&gt;mapUnique_-&gt;getNodeNumElements(); i++) {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        GO gid = this-&gt;mapUnique_-&gt;getGlobalElement( i );</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        LO <span class="keywordtype">id</span> = this-&gt;mapRepeated_-&gt;getLocalElement( this-&gt;mapUnique_-&gt;getGlobalElement( i ) );</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        this-&gt;pointsUni_-&gt;at(i) = this-&gt;pointsRep_-&gt;at(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        this-&gt;bcFlagUni_-&gt;at(i) = this-&gt;bcFlagRep_-&gt;at(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    this-&gt;edgeElements_ = edgeElements;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;done --&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;-- Building P2 surface elements ... &quot;</span> &lt;&lt; flush;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    setP2SurfaceElements( meshP1 );</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;done --&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;}</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00277"></a><span class="lineno"><a class="line" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html#a984a743914ebfec7aac02893d1bc1d33">  277</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::setP2SurfaceElements</a>( MeshUnstrPtr_Type meshP1 ){</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="comment">// loop over all elements. Inside we loop over all P1 surface elements and set the P2 surface elements accordingly</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    ElementsPtr_Type elementsP1 = meshP1-&gt;getElementsC();</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    ElementsPtr_Type elementsP2 = this-&gt;getElementsC();</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    vec2D_int_Type localSurfaceIndices;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordtype">int</span> surfaceElementOrder = 2;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">if</span> (this-&gt;dim_==3)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        surfaceElementOrder = 3;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    vec2D_int_Type surfacePermutation;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    getLocalSurfaceIndices( surfacePermutation, surfaceElementOrder );</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    vec2D_int_Type surfacePermutation2D; <span class="comment">// only used if in 3D, since we need to additionally set edges</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">if</span> (this-&gt;dim_==3)</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        getLocalSurfaceIndices( surfacePermutation2D, 2 );</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;elementsP1-&gt;numberElements(); i++) {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <a class="code" href="../../dc/d7e/classFEDD_1_1FiniteElement.html">FiniteElement</a> fe = elementsP1-&gt;getElement( i );</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <a class="code" href="../../dc/d7e/classFEDD_1_1FiniteElement.html">FiniteElement</a> feP2 = elementsP2-&gt;getElement( i );</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        ElementsPtr_Type subEl = fe.getSubElements(); <span class="comment">//might be null</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;fe.numSubElements(); j++) {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <a class="code" href="../../dc/d7e/classFEDD_1_1FiniteElement.html">FiniteElement</a> feSurf = subEl-&gt;getElement(j);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            <span class="comment">// In some instances a element has only an edge as subelement. In that case this step is not required</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            <span class="keywordflow">if</span>(feSurf.getVectorNodeList().size() == this-&gt;dim_)</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                this-&gt;setSurfaceP2(feP2, feSurf, surfacePermutation, this-&gt;dim_);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <span class="comment">// set edges for 3D case and if there are any edges, for 2D the edges are handled above</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            ElementsPtr_Type subElSurf = feSurf.getSubElements(); <span class="comment">//might be null</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <span class="keywordflow">if</span> (!subElSurf.is_null()) {</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                ElementsPtr_Type subElP2 = feP2.getSubElements();</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                <a class="code" href="../../dc/d7e/classFEDD_1_1FiniteElement.html">FiniteElement</a> feSubP2 = subElP2-&gt;getElement(j);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> e=0; e&lt;feSurf.numSubElements(); e++) {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                    <a class="code" href="../../dc/d7e/classFEDD_1_1FiniteElement.html">FiniteElement</a> feEdge = subElSurf-&gt;getElement(e);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                    this-&gt;setSurfaceP2( feSubP2, feEdge, surfacePermutation2D, this-&gt;dim_-1 );</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                    subElP2-&gt;switchElement( j, feSubP2 );</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                }</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            elementsP2-&gt;switchElement( i, feP2 );</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;}</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160; </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00325"></a><span class="lineno"><a class="line" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html#a082c41772236065b0cc4c2bc20fa0cde">  325</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::setSurfaceP2</a>( <a class="code" href="../../dc/d7e/classFEDD_1_1FiniteElement.html">FiniteElement</a> &amp;feP2, <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classFEDD_1_1FiniteElement.html">FiniteElement</a> &amp;surfFeP1, <span class="keyword">const</span> vec2D_int_Type &amp;surfacePermutation, <span class="keywordtype">int</span> dim ){</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    </div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">if</span> (dim == 2) {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;surfacePermutation.size(); j++) {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            vec_int_Type tmpSurface(2);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            tmpSurface[0] = feP2.getNode( surfacePermutation.at(j).at(0) );</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            tmpSurface[1] = feP2.getNode( surfacePermutation.at(j).at(1) );</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            sort( tmpSurface.begin(), tmpSurface.end() );</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            vec_int_Type surfaceNodeP2(0);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <span class="keyword">const</span> vec_int_Type surfaceNodeP1 = surfFeP1.getVectorNodeList();</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            <span class="keywordflow">if</span> ( tmpSurface[0] == surfaceNodeP1[0]  &amp;&amp; tmpSurface[1] == surfaceNodeP1[1] ) {</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                                </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                surfaceNodeP2.push_back( surfaceNodeP1[0] );</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                surfaceNodeP2.push_back( surfaceNodeP1[1] );</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                <span class="keywordflow">if</span> (j == 0)</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                    surfaceNodeP2.push_back( feP2.getNode( 3 ) );</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( j == 1 )</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                    surfaceNodeP2.push_back( feP2.getNode( 5 ) );</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( j == 2 )</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                    surfaceNodeP2.push_back( feP2.getNode( 4 ) );</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                <span class="keywordtype">int</span> flag = surfFeP1.getFlag();</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                <a class="code" href="../../dc/d7e/classFEDD_1_1FiniteElement.html">FiniteElement</a> feP2Surf( surfaceNodeP2, flag );</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                <span class="keywordflow">if</span> ( !feP2.subElementsInitialized() )</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                    feP2.initializeSubElements(<span class="stringliteral">&quot;P2&quot;</span>,dim-1);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                feP2.addSubElement(feP2Surf);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    }</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dim == 3){</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;surfacePermutation.size(); j++) {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            vec_int_Type tmpSurface(3);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            tmpSurface[0] = feP2.getNode( surfacePermutation.at(j).at(0) );</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            tmpSurface[1] = feP2.getNode( surfacePermutation.at(j).at(1) );</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            tmpSurface[2] = feP2.getNode( surfacePermutation.at(j).at(2) );</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                        </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            <span class="comment">//sort( tmpSurface.begin(), tmpSurface.end() );</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            vec_int_Type index(3, 0);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0 ; i != index.size() ; i++)</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                index[i] = i;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            sort(index.begin(), index.end(),</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                 [&amp;](<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; a, <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; b) {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                     return  tmpSurface[a] &lt; tmpSurface[b];</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                    }</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                 );</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            tmpSurface = sort_from_ref(tmpSurface, index);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            vec_int_Type surfaceNodeP2(0);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;            <span class="keyword">const</span> vec_int_Type surfaceNodeP1 = surfFeP1.getVectorNodeList();</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            <span class="keywordflow">if</span> ( tmpSurface[0] == surfaceNodeP1[0]  &amp;&amp;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                    tmpSurface[1] == surfaceNodeP1[1] &amp;&amp;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                    tmpSurface[2] == surfaceNodeP1[2]) {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                surfaceNodeP2.push_back( surfaceNodeP1[0] );</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                surfaceNodeP2.push_back( surfaceNodeP1[1] );</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                surfaceNodeP2.push_back( surfaceNodeP1[2] );</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                vec_int_Type additionalP2IDs(3);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                <span class="keywordflow">if</span> (j == 0){</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                    additionalP2IDs[0] = feP2.getNode( 4 );</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                    additionalP2IDs[1] = feP2.getNode( 5 );</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                    additionalP2IDs[2] = feP2.getNode( 6 );</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( j == 1 ){</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                    additionalP2IDs[0] = feP2.getNode( 4 );</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                    additionalP2IDs[1] = feP2.getNode( 7 );</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                    additionalP2IDs[2] = feP2.getNode( 8 );</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( j == 2 ){</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                    additionalP2IDs[0] = feP2.getNode( 5 );</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                    additionalP2IDs[1] = feP2.getNode( 8 );</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                    additionalP2IDs[2] = feP2.getNode( 9 );</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( j == 3 ){</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                    additionalP2IDs[0] = feP2.getNode( 6 );</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                    additionalP2IDs[1] = feP2.getNode( 7 );</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                    additionalP2IDs[2] = feP2.getNode( 9 );</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                }</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                additionalP2IDs = this-&gt;reorderP2SurfaceIndices(additionalP2IDs, index);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                surfaceNodeP2.push_back( additionalP2IDs[0] );</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                surfaceNodeP2.push_back( additionalP2IDs[1] );</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                surfaceNodeP2.push_back( additionalP2IDs[2] );</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                <span class="keywordtype">int</span> flag = surfFeP1.getFlag();</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                <a class="code" href="../../dc/d7e/classFEDD_1_1FiniteElement.html">FiniteElement</a> feP2Surf( surfaceNodeP2, flag );</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                <span class="keywordflow">if</span> ( !feP2.subElementsInitialized() )</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                    feP2.initializeSubElements(<span class="stringliteral">&quot;P2&quot;</span>,dim-1);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                feP2.addSubElement(feP2Surf);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        }</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    }</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;}</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00428"></a><span class="lineno"><a class="line" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html#aa6819a39978d03238b34f865112ed713">  428</a></span>&#160;vec_int_Type <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::reorderP2SurfaceIndices</a>( vec_int_Type&amp; additionalP2IDs, vec_int_Type&amp; index , <span class="keywordtype">bool</span> track){</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    vec_int_Type reorderedIDs(3);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="comment">// depending on the sorting of P1 surface nodes we have to adjust the new ordering of P2 edge midpoints for surfaces in 3D</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordflow">if</span> (index[0] == 0){</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="keywordflow">if</span>(index[1] == 1){</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            reorderedIDs[0] = 0; reorderedIDs[1] = 1; reorderedIDs[2] = 2;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(index[1] == 2){</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            reorderedIDs[0] = 2; reorderedIDs[1] = 1; reorderedIDs[2] = 0;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    }</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index[0] == 1){</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="keywordflow">if</span>(index[1] == 0){</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            reorderedIDs[0] = 0; reorderedIDs[1] = 2; reorderedIDs[2] = 1;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        }</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(index[1] == 2){</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            reorderedIDs[0] = 1; reorderedIDs[1] = 2; reorderedIDs[2] = 0;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        }</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    }</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index[0] == 2){</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keywordflow">if</span>(index[1] == 0){</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            reorderedIDs[0] = 2; reorderedIDs[1] = 0; reorderedIDs[2] = 1;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        }</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(index[1] == 1){</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            reorderedIDs[0] = 1; reorderedIDs[1] = 0; reorderedIDs[2] = 2;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    }</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    </div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordflow">return</span> sort_from_ref(additionalP2IDs, reorderedIDs);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;}</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">//template &lt;class SC, class LO, class GO, class NO&gt;</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">//void MeshUnstructured&lt;SC,LO,GO,NO&gt;::setSurfaceP2( const FiniteElement &amp;elementP2 , const vec_int_Type&amp; surfaceNode, vec_int_Type&amp; surfaceNodeP2, const vec2D_int_Type &amp;surfacePermutation ){</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">//    </span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">//    int loc, id1, id2, id3;</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">//    if (this-&gt;dim_ == 2) {</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">//        for (int j=0; j&lt;surfacePermutation.size(); j++) {</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">//            id1 = elementP2.getNode( surfacePermutation.at(j).at(0) );</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">//            id2 = elementP2.getNode( surfacePermutation.at(j).at(1) );</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">//            </span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">//            vec_int_Type tmpSurface(2);</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">//            if (id1 &gt; id2){</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">//                tmpSurface[0] = id2;</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">//                tmpSurface[1] = id1;</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">//            }</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">//            else{</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">//                tmpSurface[0] = id1;</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">//                tmpSurface[1] = id2;</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">//            }</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">//            </span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">//            if ( tmpSurface[0] == surfaceNode[0]  &amp;&amp; tmpSurface[1] == surfaceNode[1] ) {</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">//                surfaceNodeP2.push_back( surfaceNode[0] );</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">//                surfaceNodeP2.push_back( surfaceNode[1] );</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">//                if (j == 0)</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">//                    surfaceNodeP2.push_back( elementP2.getNode( 3 ) );</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">//                else if( j == 1 )</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">//                    surfaceNodeP2.push_back( elementP2.getNode( 5 ) );</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">//                else if( j == 2 )</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">//                    surfaceNodeP2.push_back( elementP2.getNode( 4 ) );</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">//            }</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">//        }</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">//    else if (this-&gt;dim_ == 3){</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">//        for (int j=0; j&lt;surfacePermutation.size(); j++) {</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">//            id1 = elementP2.getNode( surfacePermutation.at(j).at(0) );</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">//            id2 = elementP2.getNode( surfacePermutation.at(j).at(1) );</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">//            id3 = elementP2.getNode( surfacePermutation.at(j).at(2) );</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">//            </span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">//            vec_int_Type tmpSurface = {id1 , id2 , id3};</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">//            sort( tmpSurface.begin(), tmpSurface.end() );</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">//            </span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">//            if ( tmpSurface[0] == surfaceNode[0]  &amp;&amp;</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">//                    tmpSurface[1] == surfaceNode[1] &amp;&amp;</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">//                    tmpSurface[2] == surfaceNode[2]) {</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">//                surfaceNodeP2.push_back( surfaceNode[0] );</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">//                surfaceNodeP2.push_back( surfaceNode[1] );</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">//                surfaceNodeP2.push_back( surfaceNode[2] );</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">//                if (j == 0){</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">//                    surfaceNodeP2.push_back( elementP2.getNode( 4 ) );</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">//                    surfaceNodeP2.push_back( elementP2.getNode( 5 ) );</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">//                    surfaceNodeP2.push_back( elementP2.getNode( 6 ) );</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">//                }</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">//                else if( j == 1 ){</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">//                    surfaceNodeP2.push_back( elementP2.getNode( 4 ) );</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">//                    surfaceNodeP2.push_back( elementP2.getNode( 7 ) );</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">//                    surfaceNodeP2.push_back( elementP2.getNode( 8 ) );</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">//                }</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">//                else if( j == 2 ){</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">//                    surfaceNodeP2.push_back( elementP2.getNode( 5 ) );</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">//                    surfaceNodeP2.push_back( elementP2.getNode( 8 ) );</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">//                    surfaceNodeP2.push_back( elementP2.getNode( 9 ) );</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">//                }</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">//                else if( j == 3 ){</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">//                    surfaceNodeP2.push_back( elementP2.getNode( 6 ) );</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">//                    surfaceNodeP2.push_back( elementP2.getNode( 7 ) );</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">//                    surfaceNodeP2.push_back( elementP2.getNode( 9 ) );</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">//                }</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">//            }</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">//        }</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">//    </span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">//}</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">//    </span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00532"></a><span class="lineno"><a class="line" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html#ab09dea26fd8e9d3ca3b23ddcb31e56d6">  532</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::getLocalSurfaceIndices</a>(vec2D_int_Type &amp;localSurfaceIndices , <span class="keywordtype">int</span> surfaceElementOrder ){</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">if</span> ( this-&gt;dim_ == 2 ) {</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <span class="keywordflow">if</span> (surfaceElementOrder == 2) { <span class="comment">//P1</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            localSurfaceIndices.resize(3,vec_int_Type(3,-1));</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            localSurfaceIndices.at(0).at(0) = 0;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            localSurfaceIndices.at(0).at(1) = 1;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            localSurfaceIndices.at(1).at(0) = 0;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            localSurfaceIndices.at(1).at(1) = 2;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            localSurfaceIndices.at(2).at(0) = 1;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            localSurfaceIndices.at(2).at(1) = 2;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        }</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="preprocessor">#ifdef ASSERTS_WARNINGS</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            MYASSERT(<span class="keyword">false</span>,<span class="stringliteral">&quot;no permutation for this surface yet.&quot;</span>);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        }</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    }</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( this-&gt;dim_ == 3 ){</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="keywordflow">if</span> (surfaceElementOrder == 3) {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            localSurfaceIndices.resize(4,vec_int_Type(3,-1));</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            localSurfaceIndices.at(0).at(0) = 0;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            localSurfaceIndices.at(0).at(1) = 1;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            localSurfaceIndices.at(0).at(2) = 2;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            localSurfaceIndices.at(1).at(0) = 0;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            localSurfaceIndices.at(1).at(1) = 1;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            localSurfaceIndices.at(1).at(2) = 3;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            localSurfaceIndices.at(2).at(0) = 1;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            localSurfaceIndices.at(2).at(1) = 2;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            localSurfaceIndices.at(2).at(2) = 3;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            localSurfaceIndices.at(3).at(0) = 0;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            localSurfaceIndices.at(3).at(1) = 2;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            localSurfaceIndices.at(3).at(2) = 3;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        }</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="preprocessor">#ifdef ASSERTS_WARNINGS</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            MYASSERT(<span class="keyword">false</span>,<span class="stringliteral">&quot;no permutation for this surface yet.&quot;</span>);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        }</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    }</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;}</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00577"></a><span class="lineno"><a class="line" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html#ac3437001072631837f3c5a3c4329d754">  577</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::getEdgeCombinations</a>( vec2D_int_Type&amp; edgeCombinations ){</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160; </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">if</span> (this-&gt;dim_ == 2) {</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        edgeCombinations[0][0] = 0; edgeCombinations[0][1] = 1;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        edgeCombinations[1][0] = 0; edgeCombinations[1][1] = 2;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        edgeCombinations[2][0] = 1; edgeCombinations[2][1] = 2;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (this-&gt;dim_ == 3) {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        edgeCombinations[0][0] = 0; edgeCombinations[0][1] = 1;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        edgeCombinations[1][0] = 0; edgeCombinations[1][1] = 2;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        edgeCombinations[2][0] = 0; edgeCombinations[2][1] = 3;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        edgeCombinations[3][0] = 1; edgeCombinations[3][1] = 2;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        edgeCombinations[4][0] = 1; edgeCombinations[4][1] = 3;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        edgeCombinations[5][0] = 2; edgeCombinations[5][1] = 3;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    }</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    </div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;}</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00596"></a><span class="lineno"><a class="line" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html#ad0cf3fc0059ca9b97c596906a08d8f28">  596</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::determinePositionInElementP2</a>( vec_int_Type&amp; positions, vec_GO_Type&amp; elementsOfEdge, LO p1ID, LO p2ID, MeshUnstrPtr_Type meshP1 ){</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    ElementsPtr_Type elements = meshP1-&gt;getElementsC();</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;elementsOfEdge.size(); i++) {</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="keyword">const</span> vec_int_Type nodeList = elements-&gt;getElement( elementsOfEdge[i] ).getVectorNodeList();</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160; </div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="keyword">auto</span> it1 = find( nodeList.begin(), nodeList.end() , p1ID );</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordtype">int</span> localElNum1 = distance( nodeList.begin() , it1 );</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keyword">auto</span> it2 = find( nodeList.begin(), nodeList.end() , p2ID );</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <span class="keywordtype">int</span> localElNum2 = distance( nodeList.begin() , it2 );</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="keywordflow">if</span> (localElNum1 &gt; localElNum2) {</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            <span class="keywordtype">int</span> tmp = localElNum1;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            localElNum1 = localElNum2;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            localElNum2 = tmp;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        }</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="keywordflow">if</span> (this-&gt;dim_ == 2) {</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            <span class="keywordflow">if</span> (localElNum1==0) {</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                <span class="keywordflow">if</span> (localElNum2==1)</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                    positions[i] = 3;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(localElNum2==2)</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                    positions[i] = 5;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            }</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                positions[i] = 4;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        }</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (this-&gt;dim_ == 3) {</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            <span class="keywordflow">if</span> (localElNum1==0) {</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                <span class="keywordflow">if</span> (localElNum2==1)</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                    positions[i] = 4;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(localElNum2==2)</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                    positions[i] = 6;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(localElNum2==3)</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                    positions[i] = 7;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            }</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(localElNum1==1){</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                <span class="keywordflow">if</span> (localElNum2==2)</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                    positions[i] = 5;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(localElNum2==3)</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                    positions[i] = 8;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                positions[i] = 9;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;}</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00644"></a><span class="lineno"><a class="line" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html#a59217225e99feb51b0d4fe8258580866">  644</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::determineFlagP2</a>( <a class="code" href="../../dc/d7e/classFEDD_1_1FiniteElement.html">FiniteElement</a>&amp; fe, LO p1ID, LO p2ID, vec2D_int_Type&amp; permutation ){</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keywordtype">int</span> newFlag = std::numeric_limits&lt;int&gt;::max();</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    vec_int_Type newFlags(0);</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordtype">bool</span> foundLineSegment;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keyword">const</span> vec_int_Type nodeList = fe.getVectorNodeList();</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    vec_int_Type localElementNumbering(2);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keyword">auto</span> it1 = find( nodeList.begin(), nodeList.end() , p1ID );</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    localElementNumbering[0] = distance( nodeList.begin() , it1 );</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keyword">auto</span> it2 = find( nodeList.begin(), nodeList.end() , p2ID );</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    localElementNumbering[1] = distance( nodeList.begin() , it2 );</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160; </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    fe.findEdgeFlagInSubElements( localElementNumbering, newFlags, <span class="keyword">false</span> <span class="comment">/*we are not in a subElement yet*/</span>, permutation, foundLineSegment );</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    </div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="keywordflow">if</span> (newFlags.size() == 0)</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        newFlag = volumeID_;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="comment">// We use the lowest flag</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; newFlags.size(); k++) {</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <span class="keywordflow">if</span> ( newFlag &gt; newFlags[k] )</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            newFlag = newFlags[k];</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    }</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordflow">return</span> newFlag;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;}</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00672"></a><span class="lineno"><a class="line" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html#a287002d7c6cdbf0745ea92b227ded1fb">  672</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::determineFlagP2</a>( LO p1ID, LO p2ID, LO localEdgeID, vec2D_LO_Type&amp; markedPoint ){</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    ElementsPtr_Type elements = this-&gt;getElementsC();</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    vec2D_int_Type permutation = elements-&gt;getElementEdgePermutation();</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160; </div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    EdgeElementsPtr_Type edgeElements = this-&gt;getEdgeElements();</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160; </div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    MapConstPtr_Type elementMap = this-&gt;getElementMap();</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160; </div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keywordtype">int</span> rank = this-&gt;comm_-&gt;getRank();</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160; </div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordtype">int</span> flag1 = ( *this-&gt;getBCFlagRepeated() )[p1ID];</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160; </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keywordtype">int</span> flag2 = ( *this-&gt;getBCFlagRepeated() )[p2ID];</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="keywordtype">int</span> newFlag = std::numeric_limits&lt;int&gt;::max();</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordflow">if</span>(flag1 == this-&gt;volumeID_ || flag2 == this-&gt;volumeID_ ) <span class="comment">// one node is in an inner node, than the new node is an inner node aswell</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        newFlag = this-&gt;volumeID_;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="comment">// check if node 1 and node 2 are part of the same surface. In this case we can use the flag of the corresponding surface. Otherwise we mark the new point as an interior point and it gets the volumeID_.</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160; </div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="keyword">const</span> vec_LO_Type elementsOfEdge = edgeElements-&gt;getElementsOfEdge( (<span class="keywordtype">int</span>) localEdgeID );</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160; </div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="keyword">const</span> vec_GO_Type elementsOfEdgeGlobal = edgeElements-&gt;getElementsOfEdgeGlobal( (<span class="keywordtype">int</span>) localEdgeID );</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160; </div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <span class="keywordtype">bool</span> markPoint = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="keywordtype">bool</span> foundFlag = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        vec_int_Type localElementNumbering(2);</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        vec_int_Type edge(2);</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <span class="keywordtype">bool</span> foundLineSegment = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        vec_int_Type newFlags(0);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;elementsOfEdge.size() &amp;&amp; !foundLineSegment; i++) {</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            <span class="keywordflow">if</span> ( elementsOfEdge[i] != OTLO::invalid() ) {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                <span class="comment">//In elementsOfEdge we can access all elements which have this (the current) edge.</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                </div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                <a class="code" href="../../dc/d7e/classFEDD_1_1FiniteElement.html">FiniteElement</a> fe = elements-&gt;getElement( elementsOfEdge[i] );</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                <span class="keyword">const</span> vec_int_Type nodeList = fe.getVectorNodeList();</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                <span class="comment">// we need to determine the numbering of p1ID and p2ID corresponding to the current element</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                <span class="keyword">auto</span> it1 = find( nodeList.begin(), nodeList.end() , p1ID );</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                localElementNumbering[0] = distance( nodeList.begin() , it1 );</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                <span class="keyword">auto</span> it2 = find( nodeList.begin(), nodeList.end() , p2ID );</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                localElementNumbering[1] = distance( nodeList.begin() , it2 );</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                edge[0] = p1ID; edge[1] = p2ID;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                sort( edge.begin(), edge.end() );</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                </div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                fe.findEdgeFlagInSubElements( edge, newFlags, <span class="keyword">false</span> <span class="comment">/*we are not in a subElement yet*/</span>, permutation, foundLineSegment );</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160; </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                <span class="comment">//We need to mark this point since it can still be on the surface and another element holds the corresponding surface with the correct flag.</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                <span class="keywordflow">if</span> (newFlags.size() == 0 &amp;&amp; newFlag &gt; this-&gt;volumeID_)</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                    newFlag = this-&gt;volumeID_; <span class="comment">//do we need this?</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                <span class="comment">//If we found a line element, then we choose this flag</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                <span class="keywordflow">if</span> (foundLineSegment){</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                    foundFlag = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                    newFlag = newFlags [0];</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                }</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                    <span class="comment">// We use the lowest flag of all surfaces</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                    </div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; newFlags.size(); k++) {</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                        foundFlag = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                       <span class="keywordflow">if</span> (newFlag &gt; newFlags[k] )</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                            newFlag = newFlags[k];</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                    }</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                }</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                markPoint = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        }</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        <span class="keywordflow">if</span> (markPoint &amp;&amp; !foundFlag) {</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            <span class="comment">// We have not found a surface flag for this point.</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            <span class="comment">// No part of the element which owns this edge is part of the surface, but there might be a different element which has this edge but does not own it, but this element might have a part of the surface. We mark this point and determine the correct flag later</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            markedPoint.push_back( {p1ID, p2ID, localEdgeID } );</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            newFlag = -1;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        }</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keywordflow">return</span> newFlag;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;}</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160; </div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::findSurfaces</a>( <span class="keyword">const</span> vec_int_Type&amp; elementNodeList, vec_int_Type numbering,  vec2D_int_Type&amp; localSurfaceNodeList_vec, vec_int_Type&amp; loc_vector, <span class="keywordtype">bool</span> critical){</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordtype">int</span> tmpID;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    loc_vector.resize(0);</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    vec2D_int_Type::iterator it;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="keywordtype">int</span> id1 = elementNodeList.at(numbering.at(0));</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="keywordtype">int</span> id2 = elementNodeList.at(numbering.at(1));</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keywordflow">if</span> (this-&gt;dim_==2) {</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        vec_int_Type searchfor(2,-1);</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        <span class="comment">// Here, we use that the local surfaces are sorted. See MyMeshConvert::ReadMesh(...)</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <span class="keywordflow">if</span> ( id1 &lt; id2 ) {</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            searchfor.at(0) = id1;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            searchfor.at(1) = id2;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        }</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            searchfor.at(0) = id2;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            searchfor.at(1) = id1;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160; </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        it = find( localSurfaceNodeList_vec.begin(), localSurfaceNodeList_vec.end(), searchfor );</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        <span class="keywordflow">if</span> (it!=localSurfaceNodeList_vec.end()) {</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            loc_vector.push_back( distance(localSurfaceNodeList_vec.begin(),it) );</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        }</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160; </div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    }</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (this-&gt;dim_==3){</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        </div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        vec_int_Type vertices3ID(0);</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <span class="comment">//we want to identify the possible third surface component of a triangle. If we use other elements in 3D we might change this function.</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        getTriangles(numbering.at(0), numbering.at(1), vertices3ID);</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <span class="comment">// we have the two  possible combinations as a vector: vertices3ID</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        </div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        vec_int_Type searchfor(3,-1);</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;2; i++) {</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            searchfor.at(0) = id1;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;            searchfor.at(1) = id2;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            searchfor.at(2) = elementNodeList.at( vertices3ID.at(i) );</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160; </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            sort( searchfor.begin(), searchfor.end() );</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            </div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            it = find( localSurfaceNodeList_vec.begin(), localSurfaceNodeList_vec.end(), searchfor );</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            <span class="keywordflow">if</span> (it!=localSurfaceNodeList_vec.end()){</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                loc_vector.push_back( distance(localSurfaceNodeList_vec.begin(),it) );</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            }</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        }</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    }</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;}</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160; </div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00811"></a><span class="lineno"><a class="line" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html#ad564e1fa124ea1f205fcd134661f3e80">  811</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::findEdges</a>( <span class="keyword">const</span> vec_int_Type&amp; elementNodeList, vec_int_Type numbering,  vec2D_int_Type&amp; localEdgeNodeList_vec, vec_int_Type&amp; loc_vector){</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordtype">int</span> tmpID;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    loc_vector.resize(0);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    vec2D_int_Type::iterator it;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="keywordtype">int</span> id1 = elementNodeList.at(numbering.at(0));</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="keywordtype">int</span> id2 = elementNodeList.at(numbering.at(1));</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    vec_int_Type searchEdge(0);</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">if</span> (id2 &gt; id1)</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        searchEdge = { id1, id2 };</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        searchEdge = { id2, id1 };</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    </div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    it = find( localEdgeNodeList_vec.begin(), localEdgeNodeList_vec.end(), searchEdge );</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="keywordflow">if</span> ( it != localEdgeNodeList_vec.end() )</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        loc_vector.push_back( distance(localEdgeNodeList_vec.begin(),it) );</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;}</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00829"></a><span class="lineno"><a class="line" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html#ae0b2bc56d2fb1668afec7d5f1d904938">  829</a></span>&#160;<span class="keyword">typename</span> MeshUnstructured&lt;SC,LO,GO,NO&gt;::MeshInterfacePtr_Type <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::getMeshInterface</a>(){</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    TEUCHOS_TEST_FOR_EXCEPTION( meshInterface_.is_null(), std::runtime_error, <span class="stringliteral">&quot;MeshInterface is null.&quot;</span>);</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="keywordflow">return</span> meshInterface_;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;}</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    </div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::buildMeshInterfaceParallelAndDistance</a>( MeshUnstrPtr_Type mesh, vec_int_Type flag_vec, vec_dbl_ptr_Type &amp;distancesToInterface ){</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    this-&gt;meshInterface_.reset( <span class="keyword">new</span> <a class="code" href="../../d5/d2a/classFEDD_1_1MeshInterface.html">MeshInterface&lt;SC,LO,GO,NO&gt;</a> ( this-&gt;getComm() ) );</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; </div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="comment">//    BuildMeshInterface for different flags</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    this-&gt;meshInterface_-&gt;determineInterfaceParallelAndDistance( this-&gt;pointsUni_,  mesh-&gt;pointsUni_, this-&gt;bcFlagUni_, mesh-&gt;bcFlagUni_, flag_vec, this-&gt;getMapUnique(), mesh-&gt;getMapUnique(), distancesToInterface, this-&gt;pointsRep_, this-&gt;getDimension() );</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    </div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    mesh-&gt;meshInterface_.reset( <span class="keyword">new</span> MeshInterface_Type ( mesh-&gt;getComm() ) );</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    mesh-&gt;meshInterface_-&gt;buildFromOtherInterface( meshInterface_ );</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    </div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="comment">//because we had to communicated all interface information in determineInterfaceParallel(), we can now partition the information again.</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    this-&gt;partitionInterface();</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    mesh-&gt;partitionInterface();</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;}</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    </div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="keywordtype">void</span> MeshUnstructured&lt;SC,LO,GO,NO&gt;::partitionInterface(){</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    FEDD_TIMER_START(interfacePartitionTimer,<span class="stringliteral">&quot; : Mesh : Partition Interface&quot;</span>);</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="keywordflow">if</span> (!this-&gt;meshInterface_.is_null())</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        this-&gt;meshInterface_-&gt;partitionMeshInterface( this-&gt;mapRepeated_, this-&gt;mapUnique_);</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160; </div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;}</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00857"></a><span class="lineno"><a class="line" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html#aeb0ecbb839125869e7f1469ce6818eb4">  857</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::setMeshFileName</a>(<span class="keywordtype">string</span> meshFileName, <span class="keywordtype">string</span> delimiter){</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160; </div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    meshFileName_ = meshFileName;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    delimiter_ = delimiter;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;}</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160; </div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00872"></a><span class="lineno"><a class="line" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html#adac83696732ac7e8115cfa43f14779c3">  872</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::assignEdgeFlags</a>(){</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160; </div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    vec2D_LO_Type markedPoints(0);</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    EdgeElementsPtr_Type edgeElements = this-&gt;getEdgeElements();</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    ElementsPtr_Type elements = this-&gt;getElementsC();</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    MapConstPtr_Type mapRepeatedP1 = this-&gt;getMapRepeated();</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    vec_int_Type newFlags(edgeElements-&gt;numberElements());</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160; </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    MapConstPtr_Type edgeMap = this-&gt;getEdgeMap();</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160; </div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    vec_int_Type markedTrue(edgeElements-&gt;numberElements());</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; edgeElements-&gt;numberElements() ; i++){</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        LO p1ID =edgeElements-&gt;getElement(i).getNode(0);</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        LO p2ID =edgeElements-&gt;getElement(i).getNode(1);</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        newFlags[i]=this-&gt;determineFlagP2(p1ID, p2ID, i , markedPoints );</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="keywordflow">if</span>(newFlags[i] != -1){ <span class="comment">// questionable point that were given a flag, but that is not certain yet</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            vec_LO_Type elementsOfEdge = edgeElements-&gt;getElementsOfEdge( (<span class="keywordtype">int</span>) i );        </div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;elementsOfEdge.size(); j++) {</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                <span class="keywordflow">if</span> ( elementsOfEdge[j] == -1 ) </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                    markedTrue[i] =1;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            }</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        }   </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    }</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="comment">// It is possible that a Edge is conencted to two surfaces with different Flags, that are also on different Processors</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="comment">// This Leads to two different Flags for the same Edge</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="comment">// In order to counter that effect we check the interface edges of which we determined the flag via surfaces and check if they have the same flag and if not choose the lower one</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordtype">int</span> maxRank = std::get&lt;1&gt;(this-&gt;rankRange_);</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="keywordflow">if</span>(maxRank &gt;0 ){</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        vec_GO_Type edgeSwitch(0);</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        vec_LO_Type flags(0);</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;edgeElements-&gt;numberElements(); i++){</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            <span class="keywordflow">if</span>(markedTrue[i]==1){</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                edgeSwitch.push_back(edgeMap-&gt;getGlobalElement(i));</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                flags.push_back(newFlags[i]);</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;            }</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        }</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160; </div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="comment">// communticating elements across interface</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        Teuchos::ArrayView&lt;GO&gt; edgeSwitchArray = Teuchos::arrayViewFromVector( edgeSwitch);</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160; </div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        MapPtr_Type mapGlobalInterface =</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../dc/dae/classFEDD_1_1Map.html">Map_Type</a>( edgeMap-&gt;getUnderlyingLib(), Teuchos::OrdinalTraits&lt;GO&gt;::invalid(), edgeSwitchArray, 0, this-&gt;comm_) );</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160; </div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <span class="comment">// Global IDs of Procs</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        <span class="comment">// Setting newPoints as to be communicated Values</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        MultiVectorLOPtr_Type edgeFlags = Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../df/d17/classFEDD_1_1MultiVector.html">MultiVectorLO_Type</a>( mapGlobalInterface, 1 ) );</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        Teuchos::ArrayRCP&lt; LO &gt; edgeFlagsEntries  = edgeFlags-&gt;getDataNonConst(0);</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160; </div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; edgeFlagsEntries.size() ; i++){</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;            edgeFlagsEntries[i] = flags[i] ;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160; </div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        MapConstPtr_Type mapGlobalInterfaceUnique = mapGlobalInterface;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <span class="keywordflow">if</span>(mapGlobalInterface-&gt;getGlobalNumElements()&gt;0){</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            mapGlobalInterfaceUnique = mapGlobalInterface-&gt;buildUniqueMap( this-&gt;rankRange_ );</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        }</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160; </div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160; </div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        MultiVectorLOPtr_Type isInterfaceElement_imp = Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../df/d17/classFEDD_1_1MultiVector.html">MultiVectorLO_Type</a>( mapGlobalInterfaceUnique, 1 ) );</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        isInterfaceElement_imp-&gt;putScalar( (LO) 0 ); </div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        isInterfaceElement_imp-&gt;importFromVector( edgeFlags, <span class="keyword">false</span>, <span class="stringliteral">&quot;Insert&quot;</span>);</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160; </div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        MultiVectorLOPtr_Type isInterfaceElement_exp = Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../df/d17/classFEDD_1_1MultiVector.html">MultiVectorLO_Type</a>( mapGlobalInterfaceUnique, 1 ) );</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        isInterfaceElement_exp-&gt;putScalar( (LO) 0 ); </div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        isInterfaceElement_exp-&gt;exportFromVector( edgeFlags, <span class="keyword">false</span>, <span class="stringliteral">&quot;Insert&quot;</span>);</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160; </div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        MultiVectorLOPtr_Type isInterfaceElement2_imp = Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../df/d17/classFEDD_1_1MultiVector.html">MultiVectorLO_Type</a>( mapGlobalInterface, 1 ) );</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        isInterfaceElement2_imp-&gt;putScalar( (LO) 0 ); </div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        isInterfaceElement2_imp-&gt;importFromVector(isInterfaceElement_imp, <span class="keyword">false</span>, <span class="stringliteral">&quot;Insert&quot;</span>);</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160; </div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        isInterfaceElement2_imp-&gt;exportFromVector(isInterfaceElement_exp, <span class="keyword">false</span>, <span class="stringliteral">&quot;Insert&quot;</span>);</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160; </div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        edgeFlagsEntries  = isInterfaceElement2_imp-&gt;getDataNonConst(0);</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160; </div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;edgeFlagsEntries.size(); i++){</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;            LO entry = edgeMap-&gt;getLocalElement(edgeSwitch[i]);</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            <span class="keywordflow">if</span>(newFlags[entry] &gt; edgeFlagsEntries[i]){</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                newFlags[entry] = edgeFlagsEntries[i];</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160; </div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;            }</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        }</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    }</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="comment">// In the next Step we need to determine the missing Flags of the &#39;MarkedMissing&#39; Edges</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="comment">// We create a Map of the entries we have and one of the ones we need</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    vec_GO_Type edgesNeeded(0); <span class="comment">// For the Flag entries we need</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    vec_GO_Type edgesActive(0);</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    vec_int_Type flagsTmp(0);</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;edgeElements-&gt;numberElements(); i++){</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        <span class="keywordflow">if</span>(newFlags[i]==-1){</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            edgesNeeded.push_back(edgeMap-&gt;getGlobalElement(i));</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        }</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;            edgesActive.push_back(edgeMap-&gt;getGlobalElement(i));</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;            flagsTmp.push_back(newFlags[i]);</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;            </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        }</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    }</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160; </div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="comment">// communticating elements across interface</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    Teuchos::ArrayView&lt;GO&gt; edgesNeededArray = Teuchos::arrayViewFromVector( edgesNeeded);</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    Teuchos::ArrayView&lt;GO&gt; edgesActiveArray = Teuchos::arrayViewFromVector( edgesActive);</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    </div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    MapPtr_Type mapEdgesNeeded =</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../dc/dae/classFEDD_1_1Map.html">Map_Type</a>( edgeMap-&gt;getUnderlyingLib(), Teuchos::OrdinalTraits&lt;GO&gt;::invalid(), edgesNeededArray, 0, this-&gt;comm_) );</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    MapPtr_Type mapEdgesActive =</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../dc/dae/classFEDD_1_1Map.html">Map_Type</a>( edgeMap-&gt;getUnderlyingLib(), Teuchos::OrdinalTraits&lt;GO&gt;::invalid(), edgesActiveArray, 0, this-&gt;comm_) );</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160; </div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    MultiVectorLOPtr_Type flagsImport = Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../df/d17/classFEDD_1_1MultiVector.html">MultiVectorLO_Type</a>( mapEdgesNeeded, 1 ) );</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    flagsImport-&gt;putScalar(10);</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160; </div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    MultiVectorLOPtr_Type flagsExport = Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../df/d17/classFEDD_1_1MultiVector.html">MultiVectorLO_Type</a>( mapEdgesActive, 1 ) );</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    Teuchos::ArrayRCP&lt; LO &gt; flagExportEntries  = flagsExport-&gt;getDataNonConst(0);</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; flagExportEntries.size(); i++){</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        flagExportEntries[i] = flagsTmp[i];</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    }</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    </div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    flagsImport-&gt;importFromVector(flagsExport, <span class="keyword">false</span>, <span class="stringliteral">&quot;Insert&quot;</span>);</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160; </div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    Teuchos::ArrayRCP&lt; LO &gt; flagImportEntries  = flagsImport-&gt;getDataNonConst(0);</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;flagImportEntries.size(); i++){</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        LO entry = edgeMap-&gt;getLocalElement(edgesNeeded[i]);</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        <span class="keywordflow">if</span>(newFlags[entry] ==-1){</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;            newFlags[entry] = flagImportEntries[i];</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        }</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    }</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160; </div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; edgeElements-&gt;numberElements() ; i++){</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        edgeElements-&gt;getElement(i).setFlag(newFlags[i]);</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    }</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    </div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;}</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160; </div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l01006"></a><span class="lineno"><a class="line" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html#a0435ad39c6cfbfcddafeb840aee12e79"> 1006</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::buildEdgeMap</a>(){</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160; </div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        <span class="keywordtype">int</span> maxRank = std::get&lt;1&gt;(this-&gt;rankRange_);</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        vec_GO_Type globalProcs(0);</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;= maxRank; i++)</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;            globalProcs.push_back(i);</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160; </div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        Teuchos::ArrayView&lt;GO&gt; globalProcArray = Teuchos::arrayViewFromVector( globalProcs);</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        vec_GO_Type localProc(0);</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        localProc.push_back(this-&gt;comm_-&gt;getRank());</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        Teuchos::ArrayView&lt;GO&gt; localProcArray = Teuchos::arrayViewFromVector( localProc);</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160; </div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        MapPtr_Type mapGlobalProc =</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;            Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../dc/dae/classFEDD_1_1Map.html">Map_Type</a>( this-&gt;getMapRepeated()-&gt;getUnderlyingLib(), Teuchos::OrdinalTraits&lt;GO&gt;::invalid(), globalProcArray, 0, this-&gt;comm_) );</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160; </div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;        MapPtr_Type mapProc =</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;            Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../dc/dae/classFEDD_1_1Map.html">Map_Type</a>( this-&gt;getMapRepeated()-&gt;getUnderlyingLib(), Teuchos::OrdinalTraits&lt;GO&gt;::invalid(), localProcArray, 0, this-&gt;comm_) );</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        </div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160; </div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        vec2D_int_Type interfaceEdgesLocalId(1,vec_int_Type(1));</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> myRank = this-&gt;comm_-&gt;getRank();</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160; </div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        MultiVectorLOPtr_Type exportLocalEntry = Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../df/d17/classFEDD_1_1MultiVector.html">MultiVectorLO_Type</a>( mapProc, 1 ) );</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160; </div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        <span class="comment">// First we determine a Map only for the interface Nodes</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        <span class="comment">// This will reduce the size of the Matrix we build later significantly if only look at the interface edges</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        <span class="keywordtype">int</span> numEdges= this-&gt;edgeElements_-&gt;numberElements();</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        vec2D_GO_Type inzidenzIndices(0,vec_GO_Type(2)); <span class="comment">// Vector that stores global IDs of each edge (in Repeated Sense)</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        vec_LO_Type localEdgeIndex(0); <span class="comment">// stores the local ID of edges in question </span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        vec_GO_Type id(2);</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        <span class="keywordtype">int</span> edgesUnique=0;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        EdgeElementsPtr_Type edgeElements = this-&gt;edgeElements_; <span class="comment">// Edges</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160; </div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        vec2D_dbl_ptr_Type points = this-&gt;pointsRep_;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160; </div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;        <span class="keywordtype">int</span> interfaceNum=0;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;numEdges; i++ ){</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;            <span class="keywordflow">if</span>(edgeElements-&gt;getElement(i).isInterfaceElement()){</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160; </div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                <span class="keywordtype">id</span>[0] = this-&gt;mapRepeated_-&gt;getGlobalElement(edgeElements-&gt;getElement(i).getNode(0)); </div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                <span class="keywordtype">id</span>[1] = this-&gt;mapRepeated_-&gt;getGlobalElement(edgeElements-&gt;getElement(i).getNode(1));</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                </div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160; </div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160; </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                sort(<span class="keywordtype">id</span>.begin(),<span class="keywordtype">id</span>.end());</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                inzidenzIndices.push_back(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160; </div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                localEdgeIndex.push_back(i);</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                interfaceNum++;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;            }</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    </div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;            <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                edgesUnique++;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;            }</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160; </div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160; </div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;         }</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        <span class="comment">// This Matrix is row based, where the row is based on mapInterfaceNodesUnqiue</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        <span class="comment">// We then add a &#39;1&#39; Entry when two global Node IDs form an edge</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        MatrixPtr_Type inzidenzMatrix = Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../d2/d6e/classFEDD_1_1Matrix.html">Matrix_Type</a>(this-&gt;mapUnique_, 40 ) );</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        Teuchos::Array&lt;GO&gt; index(1);</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        Teuchos::Array&lt;GO&gt; col(1);</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        Teuchos::Array&lt;SC&gt; value(1, Teuchos::ScalarTraits&lt;SC&gt;::one() );</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160; </div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;inzidenzIndices.size(); i++ ){</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    </div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;            index[0] = inzidenzIndices[i][0];</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;            col[0] = inzidenzIndices[i][1];</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;            inzidenzMatrix-&gt;insertGlobalValues(index[0], col(), value());</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        </div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;         }</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        inzidenzMatrix-&gt;fillComplete(); <span class="comment">//mapInterfaceNodesUnique,mapInterfaceNodesUnique);</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        </div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160; </div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        <span class="comment">// Set unique edges IDs </span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        <span class="comment">// Setting the IDs of Edges that are uniquely on one Processor</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160; </div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        exportLocalEntry-&gt;putScalar( (LO) edgesUnique );</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160; </div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;        MultiVectorLOPtr_Type newEdgesUniqueGlobal= Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../df/d17/classFEDD_1_1MultiVector.html">MultiVectorLO_Type</a>( mapGlobalProc, 1 ) );</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        newEdgesUniqueGlobal-&gt;putScalar( (LO) 0 ); </div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        newEdgesUniqueGlobal-&gt;importFromVector( exportLocalEntry, <span class="keyword">true</span>, <span class="stringliteral">&quot;Insert&quot;</span>);</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        <span class="comment">// offset EdgesUnique for proc and globally</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        Teuchos::ArrayRCP&lt; const LO &gt; newEdgesList = newEdgesUniqueGlobal-&gt;getData(0);</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160; </div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        GO procOffsetEdges=0;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; myRank; i++)</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            procOffsetEdges= procOffsetEdges + newEdgesList[i];</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160; </div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        <span class="comment">// global IDs for map</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        vec_GO_Type vecGlobalIDsEdges(this-&gt;edgeElements_-&gt;numberElements()); </div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    </div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        <span class="comment">// Step 1: adding unique global edge IDs</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        <span class="keywordtype">int</span> count=0;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; this-&gt;edgeElements_-&gt;numberElements(); i++){</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;            <span class="keywordflow">if</span>(!this-&gt;edgeElements_-&gt;getElement(i).isInterfaceElement()){</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;                vecGlobalIDsEdges.at(i) = procOffsetEdges+count;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                count++;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;            }</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        }   </div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        </div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <span class="comment">// Now we add the repeated ids, by first turning interfaceEdgesTag into a map</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        <span class="comment">// Offset for interface IDS:</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        GO offsetInterface=0;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; maxRank+1; i++)</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;             offsetInterface=  offsetInterface + newEdgesList[i];</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        </div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        <span class="comment">//Now we count the row entries on each processor an set global IDs</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160; </div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        Teuchos::ArrayView&lt;const LO&gt; indices;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        Teuchos::ArrayView&lt;const SC&gt; values;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        vec2D_GO_Type inzidenzIndicesUnique(0,vec_GO_Type(2)); <span class="comment">// Vector that stores only both global IDs if the first is part of my unique Interface Nodes</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        MapConstPtr_Type colMap = inzidenzMatrix-&gt;getMap(<span class="stringliteral">&quot;col&quot;</span>);</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        MapConstPtr_Type rowMap = inzidenzMatrix-&gt;getMap(<span class="stringliteral">&quot;row&quot;</span>);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        <span class="keywordtype">int</span> numRows = rowMap-&gt;getNodeNumElements();</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;        <span class="keywordtype">int</span> uniqueEdges =0;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;numRows; i++ ){</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;            inzidenzMatrix-&gt;getLocalRowView(i, indices,values); </div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;            uniqueEdges = uniqueEdges+indices.size();</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;            vec_GO_Type edgeTmp(2);</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;indices.size(); j++){</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                edgeTmp[0] = rowMap-&gt;getGlobalElement(i);</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                edgeTmp[1] = colMap-&gt;getGlobalElement(indices[j]);</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                inzidenzIndicesUnique.push_back(edgeTmp);</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;            }</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        }</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    </div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;        exportLocalEntry-&gt;putScalar( uniqueEdges );</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        MultiVectorLOPtr_Type newEdgesInterfaceGlobal= Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../df/d17/classFEDD_1_1MultiVector.html">MultiVectorLO_Type</a>( mapGlobalProc, 1 ) );</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        newEdgesInterfaceGlobal-&gt;putScalar( (LO) 0 ); </div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        newEdgesInterfaceGlobal-&gt;importFromVector( exportLocalEntry, <span class="keyword">true</span>, <span class="stringliteral">&quot;Insert&quot;</span>);</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160; </div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        <span class="comment">// offset EdgesUnique for proc and globally</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;        Teuchos::ArrayRCP&lt; const LO &gt; numUniqueInterface = newEdgesInterfaceGlobal-&gt;getData(0);</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160; </div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        procOffsetEdges=0;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; myRank; i++)</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;            procOffsetEdges= procOffsetEdges + numUniqueInterface[i];</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160; </div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        <span class="keywordtype">int</span> numInterfaceEdges=0;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        </div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        vec_GO_Type uniqueInterfaceIDsList_(inzidenzIndicesUnique.size());</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; uniqueInterfaceIDsList_.size(); i++)</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;            uniqueInterfaceIDsList_[i] = procOffsetEdges + i;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160; </div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        MatrixPtr_Type indMatrix = Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../d2/d6e/classFEDD_1_1Matrix.html">Matrix_Type</a>(this-&gt;mapUnique_, 40 ) );</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160; </div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;inzidenzIndicesUnique.size(); i++ ){</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;            index[0] = inzidenzIndicesUnique[i][0];</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;            col[0] = inzidenzIndicesUnique[i][1];</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;            Teuchos::Array&lt;SC&gt; value2(1,uniqueInterfaceIDsList_[i]);</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;            indMatrix-&gt;insertGlobalValues(index[0], col(), value2());</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;         }</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        indMatrix-&gt;fillComplete(); </div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160; </div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        MatrixPtr_Type importMatrix = Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../d2/d6e/classFEDD_1_1Matrix.html">Matrix_Type</a>(this-&gt;mapRepeated_, 40 ) );</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        </div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        importMatrix-&gt;importFromVector(indMatrix,<span class="keyword">false</span>,<span class="stringliteral">&quot;Insert&quot;</span>);</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        importMatrix-&gt;fillComplete();       </div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        </div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        <span class="comment">// Determine global indices</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        GO edgeID=0;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;        colMap = importMatrix-&gt;getMap(<span class="stringliteral">&quot;col&quot;</span>);</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        rowMap = importMatrix-&gt;getMap(<span class="stringliteral">&quot;row&quot;</span>);</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    </div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;        LO valueID=0;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;        <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        GO entry =0;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;inzidenzIndices.size(); i++ ){</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;            </div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;            importMatrix-&gt;getLocalRowView(rowMap-&gt;getLocalElement(inzidenzIndices[i][0]), indices,values); <span class="comment">// Indices and values connected to node i / row i in Matrix</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;            <span class="comment">// Entries in &#39;indices&#39; represent the local entry in &#39;colmap</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;            <span class="comment">// with &#39;getGlobalElement&#39; we know the global Node ID that belongs to the first Node that form an edge</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;            <span class="comment">// vector in with entries only for edges belonging to node i;</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;            vec2D_GO_Type indicesTmp(indices.size(),vec_GO_Type(2));</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;            vec_GO_Type indTmp(2);</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;indices.size(); j++){</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                indTmp[0] = colMap-&gt;getGlobalElement(indices[j]);</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                indTmp[1] = values[j];</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                indicesTmp.push_back(indTmp);   <span class="comment">// vector with the indices and values belonging to node i</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;            }</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;            found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;indicesTmp.size();k++){</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                <span class="keywordflow">if</span>(inzidenzIndices[i][1] == indicesTmp[k][0]){</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                    entry =k;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                    k = indicesTmp.size();</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                    edgeID = indicesTmp[entry][1];</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                    vecGlobalIDsEdges.at(localEdgeIndex[i]) = offsetInterface + edgeID;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                    found =<span class="keyword">true</span>;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                }</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;            }</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;            </div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;         }</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160; </div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160; </div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        Teuchos::RCP&lt;std::vector&lt;GO&gt;&gt; edgesGlobMapping = Teuchos::rcp( <span class="keyword">new</span> vector&lt;GO&gt;( vecGlobalIDsEdges ) );</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        Teuchos::ArrayView&lt;GO&gt; edgesGlobMappingArray = Teuchos::arrayViewFromVector( *edgesGlobMapping);</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160; </div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        this-&gt;edgeMap_.reset(<span class="keyword">new</span> <a class="code" href="../../dc/dae/classFEDD_1_1Map.html">Map&lt;LO,GO,NO&gt;</a>(this-&gt;getMapRepeated()-&gt;getUnderlyingLib(), Teuchos::OrdinalTraits&lt;GO&gt;::invalid(), edgesGlobMappingArray, 0, this-&gt;comm_) );</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        <span class="comment">//this-&gt;edgeMap_-&gt;print();</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;}</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160; </div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160; </div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l01211"></a><span class="lineno"><a class="line" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html#a326ea0c57c466a5e4c8ffdb644980644"> 1211</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::readMeshSize</a>(){</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160; </div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="keywordtype">int</span> numElement;</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="keywordtype">int</span> orderElement;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <span class="keywordtype">int</span> dim;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="keywordtype">int</span> numNode;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <span class="keywordtype">int</span> numSurface = -1;</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="keywordtype">int</span> orderSurface = -1;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <span class="keywordtype">int</span> numEdges = 0;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="keywordtype">int</span> orderEdges = 0;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <span class="keywordtype">bool</span> verbose ( this-&gt;comm_-&gt;getRank() == 0 );</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160; </div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="keywordflow">if</span> (verbose) {</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;  Read data of mesh &quot;</span> &lt;&lt; meshFileName_&lt;&lt; <span class="stringliteral">&quot;:\n&quot;</span>;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    }</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160; </div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    meshReadSize ( meshFileName_, numNode, dim, numElement, orderElement, numSurface, orderSurface, numEdges, orderEdges );</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    </div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="keywordflow">if</span> (verbose) {</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;  Number of nodes = &quot;</span> &lt;&lt; numNode &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;  Spatial dimension = &quot;</span> &lt;&lt; dim &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;  Number of elements = &quot;</span> &lt;&lt; numElement &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;  Element order = &quot;</span> &lt;&lt; orderElement &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;  Number of surface elements = &quot;</span> &lt;&lt; numSurface &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;  Surface element order = &quot;</span> &lt;&lt; orderSurface &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;  Number of edge elements (for 3D) = &quot;</span> &lt;&lt; numEdges &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;  Edges element order (for 3D) = &quot;</span> &lt;&lt; orderEdges &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        </div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot; Starting to read the data. \n&quot;</span>;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    }</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160; </div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    </div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    this-&gt;elementOrder_ = orderElement;</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    this-&gt;surfaceElementOrder_ = orderSurface;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    this-&gt;edgesElementOrder_ = orderEdges;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    this-&gt;numElements_ = numElement;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    this-&gt;numSurfaces_ = numSurface;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    this-&gt;numEdges_ = numEdges;</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    this-&gt;numNodes_ = numNode;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    </div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    this-&gt;numElementsGlob_ = numElement;    </div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;}</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160; </div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l01260"></a><span class="lineno"><a class="line" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html#a35afa6346e5a9f09212a960897e556e6"> 1260</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::readMeshEntity</a>(<span class="keywordtype">string</span> entityType){</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    </div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="keywordflow">if</span> (entityType == <span class="stringliteral">&quot;element&quot;</span>)</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;        this-&gt;readElements( );</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (entityType == <span class="stringliteral">&quot;surface&quot;</span>)</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        this-&gt;readSurfaces( );</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (entityType == <span class="stringliteral">&quot;line&quot;</span>)</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        this-&gt;readLines( );</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (entityType == <span class="stringliteral">&quot;node&quot;</span>)</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        this-&gt;readNodes( );</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;        TEUCHOS_TEST_FOR_EXCEPTION( <span class="keyword">true</span>, std::runtime_error, <span class="stringliteral">&quot;Unknown entity type.&quot;</span>);</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;}</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160; </div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment">//template &lt;class SC, class LO, class GO, class NO&gt;</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="comment">//void MeshUnstructured&lt;SC,LO,GO,NO&gt;::readSurfaces(){</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="comment">//    bool verbose ( this-&gt;comm_-&gt;getRank() == 0 );</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment">//    if (verbose)</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="comment">//        cout &lt;&lt; &quot;### Starting to read surface data ... &quot; &lt;&lt; flush;</span></div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="comment">//    vec_int_Type    surfaceFlags( numSurfaces_, 0 );</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="comment">//    vec_int_Type    surfacesCont( numSurfaces_* surfaceElementOrder_, 0 );</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="comment">//    // We need the edges of surface elements to use special surface flags, which are only set on 1D line segments. We need to save these edges to determine the correct flag of P2 elements which might be build later</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="comment">//    meshReadData ( meshFileName_, &quot;surface&quot;, delimiter_, this-&gt;getDimension(), numSurfaces_, surfaceElementOrder_, surfacesCont, surfaceFlags );</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="comment">//    if (verbose){</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="comment">//        cout &lt;&lt; &quot;done.&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="comment">//        cout &lt;&lt; &quot;### Setting surface data ... &quot; &lt;&lt; flush;</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="comment">//    ElementsPtr_Type surfaceElementsMesh = this-&gt;getSurfaceElements();</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="comment">//    for (int i=0; i&lt;numSurfaces_; i++) {</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;<span class="comment">//        vec_int_Type tmp(surfaceElementOrder_);</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="comment">//        for (int j=0; j&lt;surfaceElementOrder_; j++)</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="comment">//            tmp.at(j) = surfacesCont.at( i * surfaceElementOrder_ + j ) - 1;// -1 to have start index 0</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="comment">//        sort( tmp.begin(), tmp.end() ); // we sort here in order to identify the corresponding element faster!</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="comment">//        FiniteElement feSurface( tmp , surfaceFlags[i] );</span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="comment">//        surfaceElementsMesh-&gt;addElement( feSurface );</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="comment">//    if (verbose)</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="comment">//        cout &lt;&lt; &quot;done.&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment">//}</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160; </div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="comment">//template &lt;class SC, class LO, class GO, class NO&gt;</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="comment">//void MeshUnstructured&lt;SC,LO,GO,NO&gt;::readLines(){</span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="comment">//    bool verbose ( this-&gt;comm_-&gt;getRank() == 0 );</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment">//    if (verbose)</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="comment">//        cout &lt;&lt; &quot;### Starting to read line data ... &quot; &lt;&lt; flush;</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="comment">//    vec_int_Type    edgeFlags( numEdges_, 0 );</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="comment">//    vec_int_Type    edgesCont( numEdges_* edgesElementOrder_, 0 );</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="comment">//    // We need the edges of surface elements to use special surface flags, which are only set on 1D line segments. We need to save these edges to determine the correct flag of P2 elements which might be build later</span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="comment">//    meshReadData ( meshFileName_, &quot;line&quot;, delimiter_, this-&gt;getDimension(), numEdges_, edgesElementOrder_, edgesCont, edgeFlags );</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="comment">//    if (verbose){</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="comment">//        cout &lt;&lt; &quot;done.&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="comment">//        cout &lt;&lt; &quot;### Setting line data ... &quot; &lt;&lt; flush;</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="comment">//    ElementsPtr_Type edgeElementsMesh = this-&gt;getSurfaceEdgeElements();</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="comment">//    //Continous edge surface elements to FiniteElement object (only relevant in 3D)</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="comment">//    for (int i=0; i&lt;numEdges_; i++) {</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="comment">//        vec_int_Type tmp(edgesElementOrder_);</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="comment">//        for (int j=0; j&lt;edgesElementOrder_; j++)</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="comment">//            tmp.at(j) = edgesCont.at( i * edgesElementOrder_ + j ) - 1;// -1 to have start index 0</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="comment">//        sort( tmp.begin(), tmp.end() ); // we sort here in order to identify the corresponding element faster!</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="comment">//        FiniteElement feEdge( tmp , edgeFlags[i] );</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment">//        edgeElementsMesh-&gt;addElement( feEdge );</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="comment">//    if (verbose)</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment">//        cout &lt;&lt; &quot;done.&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="comment">//}</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160; </div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">MeshUnstructured&lt;SC,LO,GO,NO&gt;::readNodes</a>(){</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <span class="keywordtype">bool</span> verbose ( this-&gt;comm_-&gt;getRank() == 0 );</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;### Starting to read node data ... &quot;</span> &lt;&lt; flush;</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160; </div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    vec_dbl_Type nodes(numNodes_ * this-&gt;getDimension(), 0.);</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    vec_int_Type nodeFlags(numNodes_,0);</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    meshReadData ( meshFileName_, <span class="stringliteral">&quot;node&quot;</span>, delimiter_, this-&gt;getDimension(), numNodes_, 3<span class="comment">/*order of nodes is always 3*/</span>, nodes, nodeFlags );</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    </div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <span class="keywordflow">if</span> (verbose){</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;done.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;### Setting node data ... &quot;</span> &lt;&lt; flush;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    }</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <span class="comment">//Here, all points are saved on every proc</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    this-&gt;pointsRep_.reset(<span class="keyword">new</span> std::vector&lt;std::vector&lt;double&gt; &gt;(numNodes_,std::vector&lt;double&gt;(this-&gt;getDimension(),-1.)));</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    this-&gt;bcFlagRep_.reset(<span class="keyword">new</span> std::vector&lt;int&gt; (numNodes_,0));</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160; </div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    FEDD_TIMER_START(pointsTimer,<span class="stringliteral">&quot; : MeshReader : Set Points not partitioned&quot;</span>);</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160; </div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numNodes_ ; i++) {</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;this-&gt;getDimension(); j++)</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;            this-&gt;pointsRep_-&gt;at(i).at(j) = nodes[this-&gt;getDimension()*i+j];</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        </div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;        this-&gt;bcFlagRep_-&gt;at(i) = nodeFlags[i];</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    }</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160; </div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;done.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;}</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160; </div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="keywordtype">void</span> MeshUnstructured&lt;SC,LO,GO,NO&gt;::readElements(){</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    <span class="keywordtype">bool</span> verbose ( this-&gt;comm_-&gt;getRank() == 0 );</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;### Starting to read element data ... &quot;</span> &lt;&lt; flush;</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160; </div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    vec_int_Type    elementFlags( numElements_, 0 );</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    vec_int_Type    elementsCont( numElements_* elementOrder_, 0 );</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        </div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    <span class="comment">// We need the edges of surface elements to use special surface flags, which are only set on 1D line segments. We need to save these edges to determine the correct flag of P2 elements which might be build later</span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    meshReadData ( meshFileName_, <span class="stringliteral">&quot;element&quot;</span>, delimiter_, this-&gt;getDimension(), numElements_, elementOrder_, elementsCont, elementFlags );</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160; </div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    <span class="keywordflow">if</span> (verbose){</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;done.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;### Setting element data ... &quot;</span> &lt;&lt; flush;</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    }</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    ElementsPtr_Type elementsMesh = this-&gt;getElementsC();</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    elementsMesh-&gt;setFiniteElementType(<span class="stringliteral">&quot;P1&quot;</span>);</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    elementsMesh-&gt;setDimension(this-&gt;getDimension());</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    </div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    </div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="keywordtype">int</span> id;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numElements_; i++) {</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;        vec_int_Type tmp(elementOrder_);</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;elementOrder_; j++){</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;            <span class="keywordtype">id</span> = elementsCont.at(i*elementOrder_ + j) - 1;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;            tmp.at(j) = id;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        }</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        FiniteElement fe( tmp , elementFlags[i] );</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;        elementsMesh-&gt;addElement( fe );</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    }</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    </div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;done.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;}</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160; </div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160; </div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="keywordtype">void</span> MeshUnstructured&lt;SC,LO,GO,NO&gt;::readSurfaces(){</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <span class="keywordtype">bool</span> verbose ( this-&gt;comm_-&gt;getRank() == 0 );</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;### Starting to read surface data ... &quot;</span> &lt;&lt; flush;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    </div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    vec_int_Type    surfaceFlags( numSurfaces_, 0 );</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    vec_int_Type    surfacesCont( numSurfaces_* surfaceElementOrder_, 0 );</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;        </div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <span class="comment">// We need the edges of surface elements to use special surface flags, which are only set on 1D line segments. We need to save these edges to determine the correct flag of P2 elements which might be build later</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    meshReadData ( meshFileName_, <span class="stringliteral">&quot;surface&quot;</span>, delimiter_, this-&gt;getDimension(), numSurfaces_, surfaceElementOrder_, surfacesCont, surfaceFlags );</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;        </div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="keywordflow">if</span> (verbose){</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;done.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;### Setting surface data ... &quot;</span> &lt;&lt; flush;</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    }</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    ElementsPtr_Type surfaceElementsMesh = this-&gt;getSurfaceElements();</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    </div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numSurfaces_; i++) {</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        vec_int_Type tmp(surfaceElementOrder_);</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;surfaceElementOrder_; j++)</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;            tmp.at(j) = surfacesCont.at( i * surfaceElementOrder_ + j ) - 1;<span class="comment">// -1 to have start index 0</span></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;        </div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;        sort( tmp.begin(), tmp.end() ); <span class="comment">// we sort here in order to identify the corresponding element faster!</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;        FiniteElement feSurface( tmp , surfaceFlags[i] );</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        surfaceElementsMesh-&gt;addElement( feSurface );</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    }</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    </div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    </div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;done.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;}</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160; </div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> SC, <span class="keyword">class</span> LO, <span class="keyword">class</span> GO, <span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="keywordtype">void</span> MeshUnstructured&lt;SC,LO,GO,NO&gt;::readLines(){</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    <span class="keywordtype">bool</span> verbose ( this-&gt;comm_-&gt;getRank() == 0 );</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160; </div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;### Starting to read line data ... &quot;</span> &lt;&lt; flush;</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160; </div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    vec_int_Type    edgeFlags( numEdges_, 0 );</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    vec_int_Type    edgesCont( numEdges_* edgesElementOrder_, 0 );</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        </div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <span class="comment">// We need the edges of surface elements to use special surface flags, which are only set on 1D line segments. We need to save these edges to determine the correct flag of P2 elements which might be build later</span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    meshReadData ( meshFileName_, <span class="stringliteral">&quot;line&quot;</span>, delimiter_, this-&gt;getDimension(), numEdges_, edgesElementOrder_, edgesCont, edgeFlags );</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160; </div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    </div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <span class="keywordflow">if</span> (verbose){</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;done.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;### Setting line data ... &quot;</span> &lt;&lt; flush;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    }</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    </div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    ElementsPtr_Type edgeElementsMesh = this-&gt;getSurfaceEdgeElements();</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    </div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    <span class="comment">//Continous edge surface elements to FiniteElement object (only relevant in 3D)</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numEdges_; i++) {</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;        vec_int_Type tmp(edgesElementOrder_);</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;edgesElementOrder_; j++)</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;            tmp.at(j) = edgesCont.at( i * edgesElementOrder_ + j ) - 1;<span class="comment">// -1 to have start index 0</span></div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        </div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        sort( tmp.begin(), tmp.end() ); <span class="comment">// we sort here in order to identify the corresponding element faster!</span></div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        FiniteElement feEdge( tmp , edgeFlags[i] );</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        edgeElementsMesh-&gt;addElement( feEdge );</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    }</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    </div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;done.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;}</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160; </div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160; </div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;}</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="preprocessor">#endif</span></div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aclassFEDD_1_1MeshUnstructured_html"><div class="ttname"><a href="../../dc/d49/classFEDD_1_1MeshUnstructured.html">FEDD::MeshUnstructured</a></div><div class="ttdef"><b>Definition:</b> MeshUnstructured_decl.hpp:30</div></div>
<div class="ttc" id="aclassFEDD_1_1FiniteElement_html"><div class="ttname"><a href="../../dc/d7e/classFEDD_1_1FiniteElement.html">FEDD::FiniteElement</a></div><div class="ttdef"><b>Definition:</b> FiniteElement.hpp:17</div></div>
<div class="ttc" id="aclassFEDD_1_1MeshInterface_html"><div class="ttname"><a href="../../d5/d2a/classFEDD_1_1MeshInterface.html">FEDD::MeshInterface</a></div><div class="ttdef"><b>Definition:</b> MeshInterface_decl.hpp:19</div></div>
<div class="ttc" id="anamespaceFEDD_html"><div class="ttname"><a href="../../d0/dac/namespaceFEDD.html">FEDD</a></div><div class="ttdoc">Domain.</div><div class="ttdef"><b>Definition:</b> AssembleFE_decl.hpp:9</div></div>
<div class="ttc" id="aclassFEDD_1_1Elements_html"><div class="ttname"><a href="../../de/dbb/classFEDD_1_1Elements.html">FEDD::Elements</a></div><div class="ttdef"><b>Definition:</b> Elements.hpp:22</div></div>
<div class="ttc" id="aclassFEDD_1_1Matrix_html"><div class="ttname"><a href="../../d2/d6e/classFEDD_1_1Matrix.html">FEDD::Matrix</a></div><div class="ttdef"><b>Definition:</b> Matrix_decl.hpp:29</div></div>
<div class="ttc" id="aclassFEDD_1_1MultiVector_html"><div class="ttname"><a href="../../df/d17/classFEDD_1_1MultiVector.html">FEDD::MultiVector</a></div><div class="ttdef"><b>Definition:</b> BlockMultiVector_decl.hpp:21</div></div>
<div class="ttc" id="aclassFEDD_1_1Map_html"><div class="ttname"><a href="../../dc/dae/classFEDD_1_1Map.html">FEDD::Map</a></div><div class="ttdef"><b>Definition:</b> Map_decl.hpp:28</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
