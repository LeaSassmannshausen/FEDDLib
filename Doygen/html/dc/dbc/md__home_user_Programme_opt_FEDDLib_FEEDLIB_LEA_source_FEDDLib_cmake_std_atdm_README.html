<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FEDDLib: Local ATDM builds of Trilinos</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FEDDLib
   </div>
   <div id="projectbrief">Finite Element Domain Decomposition Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Local ATDM builds of Trilinos </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This directory <code>cmake/std/atdm/</code> contains a set of <code>*.sh</code> shell scripts and <code>*.cmake</code> files that define a standard ATDM-focused build of Trilinos on a number of different ATDM platforms.</p>
<p>This is used to define a set of automated builds of Trilinos that are run with Jenkins and post to the main Trilinos CDash site using build names that start with <code>Trilinos-atdm</code>. The CTest driver scripts and Jenkins driver scripts that use this ATDM configuration are defined in the Trilinos directory <code>cmake/ctest/drivers/atdm/</code> (see the <code>README.md</code> file in that directory for details) but these details are not necessary in order to just reproduce a build locally as described below.</p>
<p><b>Outline:</b></p><ul>
<li><a href="../../#quick-start">Quick-start</a></li>
<li><a href="../../#installation-and-usage">Installation and usage</a></li>
<li><a href="../../#checkin-test-atdmsh">checkin-test-atdm.sh</a></li>
<li><a href="../../#specific-instructions-for-each-system">Specific instructions for each system</a></li>
<li><a href="../../#troubleshooting-configuration-problems">Troubleshooting configuration problems</a></li>
<li><a href="../../#directory-structure-and-contents">Directory structure and contents</a></li>
<li><a href="../../#disabling-failing-tests">Disabling failing tests</a></li>
<li><a href="../../#specific-systems-supported">Specific systems supported</a></li>
</ul>
<h1>Quick-start</h1>
<p>After <a href="https://github.com/trilinos/Trilinos/wiki/VC-%7C-Initial-Git-Setup">cloning the Trilinos git repo</a> on one of the supported ATDM machines, a local configure of Trilinos enabling a few packages is performed as:</p>
<div class="fragment"><div class="line">$ cd &lt;some_build_dir&gt;/</div>
<div class="line"> </div>
<div class="line">$ source $TRILINOS_DIR/cmake/std/atdm/load-env.sh &lt;job-name&gt;</div>
<div class="line"> </div>
<div class="line">$ cmake \</div>
<div class="line">  -GNinja \</div>
<div class="line">  -DTrilinos_CONFIGURE_OPTIONS_FILE:STRING=cmake/std/atdm/ATDMDevEnv.cmake \</div>
<div class="line">  -DTrilinos_ENABLE_TESTS=ON -DTrilinos_ENABLE_&lt;Package1&gt;=ON \</div>
<div class="line">  $TRILINOS_DIR</div>
<div class="line"> </div>
<div class="line">$ make NP=16  # Uses ninja -j16</div>
<div class="line"> </div>
<div class="line">$ ctest -j16  # Might need to be run with srun or some other command, see below</div>
</div><!-- fragment --><p>The command:</p>
<div class="fragment"><div class="line">$ source $TRILINOS_DIR/cmake/std/atdm/load-env.sh &lt;job-name&gt;</div>
</div><!-- fragment --><p>determines what machine you are on (using <code>hostname</code>) and then loads the correct environment automatically for that machine and for the build options passed through in <code>&lt;job-name&gt;</code> (or errors out if the current machine is not one of the supported machines).</p>
<p>The <code>&lt;job-name&gt;</code> argument is a single string of the form <code>XXX-&lt;keyword0&gt;-&lt;keyword1&gt;-...</code>. The standard order and format of this string is: </p><pre class="fragment">&lt;system-name&gt;-&lt;compiler&gt;-&lt;release_or_debug&gt;-&lt;kokkos_threading&gt;-&lt;kokkos_arch&gt;
</pre><p>Each of these keywords are described below.</p>
<p>**<code>&lt;system-name&gt;</code>**: Typically, the system name is determined automatically by examining the <code>hostname</code> on the system and matching it to known hosts. Therefore, it is typically not necessary to specify <code>&lt;system-name&gt;</code> in the <code>&lt;job-name&gt;</code> keys. But there are some cases where more then one <code>&lt;system-name&gt;</code> env are supported on the same machine. For example, on CEE LAN RHEL6 machines, both the <a href="../../#sems-rhel6-environment">SEMS RHEL6 env</a> and <a href="../../#cee-rhel6-environment">CEE RHEL6 env</a> are supported. On these CEE LAN RHEL6 machines, when <code>cee-rhel6</code> is included in the build job name, then the <code>cee-rhel6</code> env will be selected. But if <code>sems-rhel6</code> is included in the job name or non system name is given, then the <code>sems-rhel6</code> env will be selected by default.</p>
<p>**<code>&lt;compiler&gt;</code>:** The following <b>lower case</b> <code>&lt;job-name&gt;</code> keywords specify the <code>&lt;COMPILER&gt;</code> variable include:</p>
<ul>
<li><code>gnu</code>: Use the GCC compilers (<code>&lt;COMPILER&gt;=GNU</code>)</li>
<li><code>intel</code>: Use the Intel compilers (<code>&lt;COMPILER&gt;=INTEL</code>)</li>
<li><code>clang</code>: Use the LLVM Clang compilers (<code>&lt;COMPILER&gt;=CLANG</code>)</li>
<li><code>cuda</code>: Do a CUDA build (<code>&lt;COMPILER&gt;=CUDA</code>, <code>NODE_TYPE=CUDA</code>)<ul>
<li><code>cuda-8.0</code>: Use CUDA 8.0</li>
<li><code>cuda-9.0</code>: Use CUDA 9.0</li>
</ul>
</li>
</ul>
<p>When using <code>gnu</code>, <code>intel</code>, <code>clang</code>, and <code>cuda</code> without specifying a version (e.g. <code>cuda-9.0</code>), then a default version of the compilers for that system will be chosen (see the loaded env for the default chosen version). Each system may only support a subset of these compilers; see the <code>cmake/std/atdm/&lt;system-name&gt;/environment.sh</code> file for details on which compilers and which versions are supported. If you choose a compiler that is not supported, an error message will be provided. If <code>default</code> is used, then the default compiler for the system will be selected.</p>
<p>**<code>&lt;release_or_debug&gt;</code>:** The following <code>&lt;job-name&gt;</code> keywords specify debug or optimized build and the <code>&lt;BUILD_TYPE&gt; variable</code>(used to set the CMake cache var <code>CMAKE_BUILD_TYPE=[DEBUG|RELEASE]</code> and turn on or off runtime debug checking (e.g. array bounds checking, pointer checking etc.)):</p>
<ul>
<li><code>release-debug</code>: (<code>&lt;BUILD_TYPE&gt;=RELEASE_RELEASE</code>)<ul>
<li>Set <code>CMAKE_BULD_TYPE=RELEASE</code> (i.e. <code>-O3</code> compiler options)</li>
<li>Turn <b>ON</b> runtime debug checking</li>
<li>NOTE: This build runs runtime checks to catch developer and user mistakes but still runs fairly fast.</li>
</ul>
</li>
<li><code>debug</code>: (<code>&lt;BUILD_TYPE&gt;=DEBUG</code>, DEFAULT)<ul>
<li>Set <code>CMAKE_BULD_TYPE=DEBUG</code> (i.e. <code>-O0 -g</code> compiler options)</li>
<li>Turn <b>ON</b> runtime debug checking</li>
<li>NOTE: This build supports running in a debugger.</li>
</ul>
</li>
<li><code>release</code> or <code>opt</code>: (<code>&lt;BUILD_TYPE&gt;=RELEASE</code>)<ul>
<li>Set <code>CMAKE_BULD_TYPE=RELEASE</code> (i.e. <code>-O3</code> compiler options)</li>
<li>Turn <b>OFF</b> runtime debug checking</li>
<li>NOTE: This build runs fast with minimal checks (i.e. production).</li>
</ul>
</li>
</ul>
<p>**<code>&lt;kokkos_threading&gt;</code>:** The following <code>&lt;job-name&gt;</code> keywords determine the Kokkos threading model variable <code>&lt;NODE_TYPE&gt;</code> (default is <code>&lt;NODE_TYPE&gt;=SERIAL</code> unless <code>&lt;COMPILER&gt;=CUDA</code>):</p>
<ul>
<li><code>openmp</code>: Use OpenMP for host threading (<code>NODE_TYPE=OPENMP</code>)</li>
<li><code>pthread</code>: Use Pthreads for host threading (<code>NODE_TYPE=THREAD</code>)</li>
<li><code>serial</code>: Use no host threading (<code>NODE_TYPE=SERIAL</code>, DEFAULT)</li>
</ul>
<p>If <code>cuda</code> (or <code>cuda-8.0</code>, <code>cuda-9.0</code>, etc.) is given, then <code>&lt;NODE_TYPE&gt;</code> is automatically set to <code>CUDA</code>.</p>
<p>**<code>&lt;kokkos_arch&gt;</code>:** The <code>&lt;job-name&gt;</code> string can also contain keywords to determine the <code>KOKKOS_ARCH</code> option of the build. This is the case-sensitive architecture name that is recognized by the CMake <a href="https://trilinos.org/docs/files/TrilinosBuildReference.html#configuring-with-kokkos-and-advanced-back-ends">KOKKOS_ARCH</a> configure option for Trilinos and Kokkos. Some common supported Kokkos architectures for the host node include <code>BDW</code>, <code>HSW</code>, <code>Power8</code>, <code>Power9</code>, and <code>KNL</code>. When a GPU is present, some common Kokkos architecture options include <code>Kepler37</code> and <code>Pascal60</code>. If one selects a <code>KOKKOS_ARCH</code> value that is not supported by the current system or selected compiler, then the <code>load-env.sh</code> script will return an error message listing the value choices for <code>KOKKOS_ARCH</code> for each supported compiler.</p>
<p>Note that currently only a single <code>KOKKOS_ARCH</code> value is recognized in the <code>&lt;job-name&gt;</code> string and it must be proceeded a dash '-' such as with <code>intel-KNL</code> or <code>cuda-Kepler37</code>. This setup does not currently support specifying multiple <code>KOKKOS_ARCH</code> values (since there is no example yet where that would be needed or useful) but such functionality could be supported in the future if needed.</p>
<p>All other strings in <code>&lt;job-name&gt;</code> are ignored but are allowed for informational purposes. The reason that a <code>&lt;job-name&gt;</code> string is defined in this form is that this can be used as the Jenkins job name and the Trilinos build name that shows up on CDash. This makes it very easy to define the configuration options and maintain the Jenkins build jobs. The combination <code>&lt;COMPILER&gt;-&lt;BUILD_TYPE&gt;-&lt;NODE_TYPE&gt;-&lt;KOKKOS_ACRCH&gt;</code> is used to define the CMake variable <code>ATDM_JOB_NAME_KEYS_STR</code> that is used to uniquely define a build on a particular system and to manage a system of tweaks for each of the supported builds (see below).</p>
<p>Some examples of <code>&lt;job-name&gt;</code> keyword sets used on various platforms include:</p><ul>
<li><code>gnu-debug-openmp</code></li>
<li><code>gnu-opt-openmp</code></li>
<li><code>intel-debug-openmp</code></li>
<li><code>intel-opt-openmp</code></li>
<li><code>sems-rhel6-gnu-debug-openmp</code></li>
<li><code>cee-rhel6-gnu-debug-openmp</code></li>
<li><code>sems-rhel6-intel-opt-openmp</code></li>
<li><code>cee-rhel6-intel-opt-openmp</code></li>
<li><code>intel-debug-openmp-KNL</code></li>
<li><code>intel-opt-openmp-HSW</code></li>
<li><code>cuda-debug</code> (<code>&lt;NODE_TYPE&gt;</code> is implicitly <code>CUDA</code>)</li>
<li><code>cuda-opt</code> (<code>&lt;NODE_TYPE&gt;</code> is implicitly <code>CUDA</code>)</li>
<li><code>cuda-8.0-debug</code> (<code>&lt;NODE_TYPE&gt;</code> is implicitly <code>CUDA</code>)</li>
<li><code>cuda-9.0-opt-Kepler37</code> (<code>&lt;NODE_TYPE&gt;</code> is implicitly <code>CUDA</code>)</li>
</ul>
<p>The script <code>cmake/std/atdm/load-env.sh</code> when sourced sets some bash environment variables that are prefixed with <code>ATDM_CONFIG_</code> and other standard variables. This includes setting the var <code>ATDM_CONFIG_JOB_NAME</code> which stores the input <code>&lt;job-name&gt;</code> which is used in other parts of the system.</p>
<p>The file <code>ATDMDevEnv.cmake</code> pulls bash environment variables set by the sourced <code>atdm/load-env.sh</code> script and sets up a number of CMake cache variables such as the compilers, compiler options, and sets up a number of Trilinos configuration variables (many of which are echoed to the STDOUT when running <code>cmake</code>). This also enables by default all of the standard TPLs used by ATDM Application codes through Trilinos and sets up locations for the include directories and libraries for each of these TPLs.</p>
<p>When included, the file <code>ATDMDevEnv.cmake</code> also disables many packages and subpackages not used for the ATDM configuration of Trilinos. This uses a so-called back-listing approach which allows one to only directly enable the packages you want to use with <code>Trilinos_ENABLE_ALL_OPTIONAL_PACKAGES=ON</code> and then disable the ones you don't want. This is a much more flexible way to define a standard configuration of Trilinos that allows different sets of actual packages to be enabled based on the needs of the different ATDM application customers and Trilinos developers just needing to enable a subset of packages. But if package X does get enabled, then it will always have the same configuration options independent of any other packages that are enabled.</p>
<p>When <code>ATDMDevEnv.cmake</code> is being processed, if there is a "tweaks" file defined for a build, then it will be picked up in the CMake cache var <a href="../../#ATDM_TWEAKS_FILES">ATDM_TWEAKS_FILES</a> and that file will be read in using <code>INCLUDE()</code> to process the extra options contained within it.</p>
<h1>Installation and usage</h1>
<p>When including the <code>ATDMDevEnv.cmake</code> file (or <code>ATDMDevEnvSettings.cmake</code>) at configure time as described above, the cmake configure automatically sets up to install an environment script:</p>
<div class="fragment"><div class="line">&lt;install-prefix&gt;/&lt;load-matching-env-sh&gt;</div>
</div><!-- fragment --><p>where <code>&lt;install-prefix&gt;</code> and <code>&lt;load-matching-env-sh&gt;</code> are set at configure-time using:</p>
<div class="fragment"><div class="line">-D CMAKE_INSTALL_PREFIX=&lt;install-prefix&gt; \</div>
<div class="line">-D ATDM_INSTALLED_ENV_LOAD_SCRIPT_NAME=&lt;load-matching-env-sh&gt; \</div>
<div class="line">-D ATDM_TRILINOS_INSTALL_PREFIX_ENV_VAR_NAME=&lt;trilinos-install-prefix-var-name&gt; \</div>
</div><!-- fragment --><ul>
<li>If <code>ATDM_INSTALLED_ENV_LOAD_SCRIPT_NAME</code> is not specified then it is given the name <code>load_matching_env.sh</code> by default.</li>
<li>If <code>ATDM_TRILINOS_INSTALL_PREFIX_ENV_VAR_NAME</code> is not specified then it is given the name <code>ATDM_TRILINOS_INSTALL_PREFIX</code> by default.</li>
</ul>
<p>After installation with <code>make install</code>, a client can load the environment to use this ATDM configuration of Trilinos by running:</p>
<div class="fragment"><div class="line">$ source &lt;install-prefix&gt;/&lt;load-matching-env-sh&gt;</div>
</div><!-- fragment --><p>Sourcing this file sets all of the various <code>ATDM_CONG_</code> environment variables described above and also sets the environment variable <code>&lt;trilinos-install-prefix-var-name&gt;</code> to <code>&lt;install-prefix&gt;</code>.</p>
<h1>checkin-test-atdm.sh</h1>
<p>For those Trilinos developers comfortable with using the <code>Trilinos/checkin-test.py</code> script, multiple local builds and testing on a system can also be driven with the provided <code>checkin-test-atdm.sh</code> wrapper script. This can be used to drive a number of builds on system as:</p>
<div class="fragment"><div class="line">$ cd &lt;some_build_dir&gt;/</div>
<div class="line"> </div>
<div class="line">$ ln -s $TRILINOS_DIR/cmake/std/atdm/checkin-test-atdm.sh .</div>
<div class="line"> </div>
<div class="line">$ ./checkin-test-atdm.sh &lt;job-name-0&gt; &lt;job-name-1&gt; ... \</div>
<div class="line">  --enable-packages=&lt;Package&gt; --local-do-all</div>
</div><!-- fragment --><p>That will configure, build, and run tests for each specified build <code>&lt;job-name-0&gt;</code> and send a summary email when complete. All of the supported builds on the local system can be run by using <code>all</code> instead of <code>&lt;job-name-0&gt; &lt;job-name-1&gt; ...</code>. See comments at the top of the script <code>checkin-test-atdm.sh</code> for more details.</p>
<p>The parallel level for building and running tests are determined by the env vars <code>ATDM_CONFIG_BUILD_COUNT</code> and <code>ATDM_CONFIG_CTEST_PARALLEL_LEVEL</code>, respectfully, as set by default for the given system by the <code>atdm/load-env.sh</code> script for the given machine. (On most machines, these are fixed but on generic systems like <a href="../../#sems-rhel6-environment">sems-rhel6</a>, they are computed from the number of cores on that machine). These values can be overridden by setting the env vars <code>ATDM_CONFIG_BUILD_COUNT_OVERRIDE</code> and <code>ATDM_CONFIG_CTEST_PARALLEL_LEVEL_OVERIDE</code>, respectfully as, for example:</p>
<div class="fragment"><div class="line">$ env \</div>
<div class="line">  ATDM_CONFIG_BUILD_COUNT_OVERRIDE=8 \</div>
<div class="line">  ATDM_CONFIG_CTEST_PARALLEL_LEVEL_OVERIDE=12 \</div>
<div class="line">  ./checkin-test-atdm.sh [options]</div>
</div><!-- fragment --><p>A value of <code>ATDM_CONFIG_BUILD_COUNT_OVERRIDE=0</code> or less than <code>0</code> is allowed when using Ninja (i.e. <code>ATDM_CONFIG_USE_NINJA=ON</code>) in which case <code>ninja</code> will be run with non <code>-j&lt;N&gt;</code> argument, and therefore all of the non-loaded cores will be used.</p>
<p>Alternatively, one can override the parallel build and test running levels and set other make/ninja and ctest options using the checkin-test arguments <code>--make-options</code> and <code>--ctest-options</code>. For example, to use 20 processes to build with Nina, have Ninja keep going even if there are build errors, and run ctest with 10 proceses, one can use:</p>
<div class="fragment"><div class="line">$ ./checkin-test-atdm.sh \</div>
<div class="line">  --make-options=&quot;-j20 -k 99999999&quot; \</div>
<div class="line">  --ctest-options=-j10 \</div>
<div class="line">  [other options]</div>
</div><!-- fragment --><p>To run tests for a CUDA build or to run tests on platforms that must run on a compute node one will need to run these on a compute node on the system that has a GPU. On such a system one would run:</p>
<div class="fragment"><div class="line">$ ./checkin-test-atdm.sh &lt;job-name-0&gt; &lt;job-name-1&gt; ... \</div>
<div class="line">  --enable-packages=&lt;Package&gt; --configure --build \</div>
<div class="line">  &amp;&amp; \</div>
<div class="line">  &lt;command-to-run-on-compute-node&gt; \</div>
<div class="line">  ./checkin-test-atdm.sh &lt;job-name-0&gt; &lt;job-name-1&gt; ... \</div>
<div class="line">  --enable-packages=&lt;Package&gt; --test</div>
</div><!-- fragment --><p>See <a href="../../#specific-instructions-for-each-system">Specific instructions for each system</a> for details for how to run on the compute node for that system.</p>
<p>Note that one can create a <code>local-checkin-test-defaults.py</code> file to set defaults like:</p>
<div class="fragment"><div class="line">defaults = [</div>
<div class="line">  &quot;--no-enable-fwd-packages&quot;,</div>
<div class="line">  &quot;--enable-all-packages=off&quot;,</div>
<div class="line">  ]</div>
</div><!-- fragment --><p>and then run:</p>
<div class="fragment"><div class="line">$ ./checkin-test-atdm.sh &lt;job-name-0&gt; &lt;job-name-1&gt; ... \</div>
<div class="line">  --enable-packages=&lt;Package&gt; --local-do-all</div>
</div><!-- fragment --><p>However, a default <code>local-checkin-test-defaults.py</code> is created the first time the <code>checkin-test-atdm.sh</code> script is run and will set these as the defaults (after which can be modified).</p>
<h1>Specific instructions for each system</h1>
<ul>
<li><a href="../../#ridewhite">ride/white</a></li>
<li><a href="../../#shillerhansen">shiller/hansen</a></li>
<li><a href="../../#chamaserrano">chama/serrano</a></li>
<li><a href="../../#mutrino">mutrino</a></li>
<li><a href="../../#sems-rhel6-environment">SEMS rhel6 environment</a></li>
<li><a href="../../#cee-rhel6-environment">CEE rhel6 environment</a></li>
<li><a href="../../#waterman">waterman</a></li>
</ul>
<h2>ride/white</h2>
<p>Once logged on to <code>white</code> (on the SON) or <code>ride</code> (on the SRN), one can directly configure and build on the login node (being careful not to overload the node). But to run the tests, one must run on the compute nodes using the <code>bsub</code> command to run if using a CUDA build. For example, to configure, build and run the tests for the <code>cuda-debug</code> build for say <code>MueLu</code> on <code>white</code>, (after cloning Trilinos on the <code>develop</code> branch) one would do:</p>
<div class="fragment"><div class="line">$ cd &lt;some_build_dir&gt;/</div>
<div class="line"> </div>
<div class="line">$ source $TRILINOS_DIR/cmake/std/atdm/load-env.sh cuda-debug</div>
<div class="line"> </div>
<div class="line">$ cmake \</div>
<div class="line">  -GNinja \</div>
<div class="line">  -DTrilinos_CONFIGURE_OPTIONS_FILE:STRING=cmake/std/atdm/ATDMDevEnv.cmake \</div>
<div class="line">  -DTrilinos_ENABLE_TESTS=ON -DTrilinos_ENABLE_MueLu=ON \</div>
<div class="line">  $TRILINOS_DIR</div>
<div class="line"> </div>
<div class="line">$ make NP=16</div>
<div class="line"> </div>
<div class="line">$ bsub -x -Is -q rhel7F -n 16 ctest -j16</div>
</div><!-- fragment --><p>The ATDM configuration of Trilinos is set up to run on the Firestone nodes (Dual-Socket POWER8, 8 cores per socket, K80 GPUs). This configuration will not work on the other GPU nodes currently.</p>
<p><b>NOTE:</b> While the above example shows loading the environment, configuring and building on the login node, one can also do these on the compute nodes as well. In fact, that is what the CTest -S drivers do in automated testing on 'white' and 'ride'.</p>
<p>Note that one can also run the same build a tests using the <a href="../../#checkin-test-atdmsh">checkin-test-atdm.sh</a> script as:</p>
<div class="fragment"><div class="line">$ cd &lt;some_build_dir&gt;/</div>
<div class="line">$ ln -s $TRILINOS_DIR/cmake/std/atdm/checkin-test-atdm.sh .</div>
<div class="line">$ bsub -x -I -q rhel7F -n 16 \</div>
<div class="line">  ./checkin-test-atdm.sh cuda-debug \</div>
<div class="line">  --enable-packages=MueLu \</div>
<div class="line">  --local-do-all</div>
</div><!-- fragment --><h2>shiller/hansen</h2>
<p>Once logged on to <code>hansen</code> (on the SON) or <code>shiller</code> (on the SRN), one can directly configure and build on the login node (being careful not to overload the node). But to run the tests, one must run on the compute nodes using the <code>srun</code> command. For example, to configure, build and run the tests for say <code>MueLu</code> on <code>hansen</code>, (after cloning Trilinos on the <code>develop</code> branch) one would do:</p>
<div class="fragment"><div class="line">$ cd &lt;some_build_dir&gt;/</div>
<div class="line"> </div>
<div class="line">$ source $TRILINOS_DIR/cmake/std/atdm/load-env.sh intel-opt-openmp</div>
<div class="line"> </div>
<div class="line">$ cmake \</div>
<div class="line">  -GNinja \</div>
<div class="line">  -DTrilinos_CONFIGURE_OPTIONS_FILE:STRING=cmake/std/atdm/ATDMDevEnv.cmake \</div>
<div class="line">  -DTrilinos_ENABLE_TESTS=ON -DTrilinos_ENABLE_MueLu=ON \</div>
<div class="line">  $TRILINOS_DIR</div>
<div class="line"> </div>
<div class="line">$ make NP=16</div>
<div class="line"> </div>
<div class="line">$ srun ctest -j16</div>
</div><!-- fragment --><p><b>NOTE:</b> While the above example shows loading the environment, configuring and building on the login node, one can also do these on the compute nodes as well. In fact, that is what the CTest -S drivers do in automated testing on 'hansen' and 'shiller'.</p>
<p>Note that one can also run the same build a tests using the <a href="../../#checkin-test-atdmsh">checkin-test-atdm.sh</a> script as:</p>
<div class="fragment"><div class="line">$ cd &lt;some_build_dir&gt;/</div>
<div class="line">$ ln -s $TRILINOS_DIR/cmake/std/atdm/checkin-test-atdm.sh .</div>
<div class="line">$ srun ./checkin-test-atdm.sh intel-opt-openmp \</div>
<div class="line">  --enable-packages=MueLu \</div>
<div class="line">  --local-do-all</div>
</div><!-- fragment --><h2>chama/serrano</h2>
<p>Once logged on to <code>chama</code> or <code>serrano</code>, one can directly configure and build on the login node (being careful not to overload the node). But to run the tests, one must run on the compute nodes using the <code>srun</code> command. For example, to configure, build and run the tests for say <code>MueLu</code> on <code>serrano</code> or <code>chama</code>, (after cloning Trilinos on the <code>develop</code> branch) one would do:</p>
<div class="fragment"><div class="line">$ cd &lt;some_build_dir&gt;/</div>
<div class="line"> </div>
<div class="line">$ source $TRILINOS_DIR/cmake/std/atdm/load-env.sh intel-opt-openmp</div>
<div class="line"> </div>
<div class="line">$ cmake \</div>
<div class="line">  -GNinja \</div>
<div class="line">  -DTrilinos_CONFIGURE_OPTIONS_FILE:STRING=cmake/std/atdm/ATDMDevEnv.cmake \</div>
<div class="line">  -DTrilinos_ENABLE_TESTS=ON -DTrilinos_ENABLE_MueLu=ON \</div>
<div class="line">  $TRILINOS_DIR</div>
<div class="line"> </div>
<div class="line">$ make NP=16</div>
<div class="line"> </div>
<div class="line">$ salloc -N1 --time=0:20:00 --account=&lt;YOUR_WCID&gt; ctest -j16</div>
</div><!-- fragment --><p>To get information on &lt;YOUR_WCID&gt; used above, there is a WC tool tab on computing.sandia.gov</p>
<p><b>NOTE:</b> Unlike some of the other machines, one must load the environment, configure and build on the login node and then run the test suite on a compute node on this system. This is what the CTest -S driver on 'chama' and 'serrano' does in order to drive jobs and submit to CDash.</p>
<p>To use the checkin-test-atdm.sh script, you must split running the tests from the configure and build as with:</p>
<div class="fragment"><div class="line">$ cd &lt;some_build_dir&gt;/</div>
<div class="line">$ ln -s $TRILINOS_DIR/cmake/std/atdm/checkin-test-atdm.sh .</div>
<div class="line">$ ./checkin-test-atdm.sh intel-opt-openmp \</div>
<div class="line">  --enable-packages=MueLu --allow-no-pull --configure --build</div>
<div class="line">$ salloc -N1 --time=0:20:00 --account=&lt;YOUR_WCID&gt; \</div>
<div class="line">  ./checkin-test-atdm.sh intel-opt-openmp \</div>
<div class="line">  --enable-packages=MueLu --test</div>
</div><!-- fragment --><h2>mutrino</h2>
<p>Once logged on to <code>mutrino</code>, one can directly configure and build on the login node (being careful not to overload the node). But to run the tests, one must run on the compute nodes using the <code>salloc</code> command. For example, to configure, build and run the tests for say <code>MueLu</code> on <code>mutrino</code>, (after cloning Trilinos on the <code>develop</code> branch) one would:</p>
<div class="fragment"><div class="line">$ cd &lt;some_build_dir&gt;/</div>
<div class="line"> </div>
<div class="line">$ source $TRILINOS_DIR/cmake/std/atdm/load-env.sh intel-opt-openmp</div>
<div class="line"> </div>
<div class="line">$ cmake \</div>
<div class="line">  -DTrilinos_CONFIGURE_OPTIONS_FILE:STRING=cmake/std/atdm/ATDMDevEnv.cmake \</div>
<div class="line">  -DTrilinos_ENABLE_TESTS=ON -DTrilinos_ENABLE_MueLu=ON \</div>
<div class="line">  $TRILINOS_DIR</div>
<div class="line"> </div>
<div class="line">$ make -j16</div>
<div class="line"> </div>
<div class="line">$ salloc -N 1 -p standard -J $ATDM_CONFIG_JOB_NAME ctest -j16</div>
</div><!-- fragment --><p><b>NOTE:</b> Unlike some of the other machines, one must load the environment, configure and build on the login node and then run the test suite on a compute node on this system. This is what the CTest -S driver on 'mutrino' does in order to drive jobs and submit to CDash.</p>
<h2>SEMS rhel6 environment</h2>
<p>Once logged on to a rhel6 machine with the sems NFS env, one can directly configure, build, and run tests. For example, to configure, build and run the tests for <code>MueLu</code> one would clone Trilinos on the <code>develop</code> branch and then do the following:</p>
<div class="fragment"><div class="line">$ cd &lt;some_build_dir&gt;/</div>
<div class="line"> </div>
<div class="line">$ source $TRILINOS_DIR/cmake/std/atdm/load-env.sh sems-rhel6-intel-opt-openmp</div>
<div class="line"> </div>
<div class="line">$ cmake \</div>
<div class="line">  -GNinja \</div>
<div class="line">  -DTrilinos_CONFIGURE_OPTIONS_FILE:STRING=cmake/std/atdm/ATDMDevEnv.cmake \</div>
<div class="line">  -DTrilinos_ENABLE_TESTS=ON -DTrilinos_ENABLE_MueLu=ON \</div>
<div class="line">  $TRILINOS_DIR</div>
<div class="line"> </div>
<div class="line">$ make NP=16</div>
<div class="line"> </div>
<div class="line">$ ctest -j8</div>
</div><!-- fragment --><p>NOTE: Above including <code>sems-rhel6</code> in the job build name <code>sems-rhel6-intel-opt-openmp</code> is not necessary but is recommended when on a CEE LAN RHEL6 machine to be explicit that the SEMS env is being used and not the <a href="../../#cee-rhel6-environment">CEE RHEL6 env</a>.</p>
<p>One can also run the same build a tests using the <a href="../../#checkin-test-atdmsh">checkin-test-atdm.sh</a> script as:</p>
<div class="fragment"><div class="line">$ cd &lt;some_build_dir&gt;/</div>
<div class="line">$ ln -s $TRILINOS_DIR/cmake/std/atdm/checkin-test-atdm.sh .</div>
<div class="line">$ ./checkin-test-atdm.sh sems-rhel6-clang-opt-openmp \</div>
<div class="line">  --enable-packages=MueLu \</div>
<div class="line">  --local-do-all</div>
</div><!-- fragment --><p>NOTE: The number of parallel build and test processes in this case are determine automatically from the number of cores on the current machine. But this can be overridden by setting the env var <code>ATDM_CONFIG_NUM_CORES_ON_MACHINE_OVERRIDE</code> <b>before</b> sourcing the <code>atdm/load-env.sh &lt;job-name&gt;</code> script.</p>
<h2>CEE RHEL6 environment</h2>
<p>Once logged into any CEE LAN RHEL6 SRN machine, one can configure, build, and run tests for any ATDM Trilinos package. For example, to configure, build and run the tests for the <code>cee-rhel6-clang-opt-openmp</code> build for say <code>MueLu</code> on a CEE LAN machine, (after cloning Trilinos on the <code>develop</code> branch) one would do:</p>
<div class="fragment"><div class="line">$ cd &lt;some_build_dir&gt;/</div>
<div class="line"> </div>
<div class="line">$ source $TRILINOS_DIR/cmake/std/atdm/load-env.sh cee-rhel6-clang-opt-openmp</div>
<div class="line"> </div>
<div class="line">$ cmake \</div>
<div class="line">  -GNinja \</div>
<div class="line">  -DTrilinos_CONFIGURE_OPTIONS_FILE:STRING=cmake/std/atdm/ATDMDevEnv.cmake \</div>
<div class="line">  -DTrilinos_ENABLE_TESTS=ON -DTrilinos_ENABLE_MueLu=ON \</div>
<div class="line">  $TRILINOS_DIR</div>
<div class="line"> </div>
<div class="line">$ make NP=16</div>
<div class="line"> </div>
<div class="line">$ ctest -j16</div>
</div><!-- fragment --><p>NOTE: Above one must include <code>cee-rhel6</code> in the build job name <code>cee-rhel6-clang-opt-openmp</code> in order to select the <code>cee-rhel6</code> env on a CEE LAN RHEL6 machine or the <a href="../../#sems-rhel6-environment">sems-rhel6</a> env will be used by default.</p>
<p>One can also run the same build a tests using the <a href="../../#checkin-test-atdmsh">checkin-test-atdm.sh</a> script as:</p>
<div class="fragment"><div class="line">$ cd &lt;some_build_dir&gt;/</div>
<div class="line">$ ln -s $TRILINOS_DIR/cmake/std/atdm/checkin-test-atdm.sh .</div>
<div class="line">$ env ATDM_CHT_DEFAULT_ENV=cee-rhel6-default \</div>
<div class="line">  ./checkin-test-atdm.sh cee-rhel6-clang-opt-openmp \</div>
<div class="line">  --enable-packages=MueLu \</div>
<div class="line">  --local-do-all</div>
</div><!-- fragment --><p>NOTE: Above one must set <code>ATDM_CHT_DEFAULT_ENV=cee-rhel6-default</code> in the env when passing in <code>all</code> in order for it to select the correct set of supported builds for the <code>cee-rhel6</code> env.</p>
<p>NOTE: The number of parallel build and test processes in this case are determine automatically from the number of cores on the current machine. But this can be overridden by setting the env var <code>ATDM_CONFIG_NUM_CORES_ON_MACHINE_OVERRIDE</code> <b>before</b> sourcing the <code>atdm/load-env.sh &lt;job-name&gt;</code> script.</p>
<h2>waterman</h2>
<p>Once logged on to <code>waterman</code> (SRN), one can directly configure and build on the login node (being careful not to overload the node). But to run the tests, one must run on the compute nodes using the <code>bsub</code> command to run if using a CUDA build. For example, to configure, build and run the tests for the default <code>cuda-debug</code> build for say <code>MueLu</code> (after cloning Trilinos on the <code>develop</code> branch) one would do:</p>
<div class="fragment"><div class="line">$ cd &lt;some_build_dir&gt;/</div>
<div class="line"> </div>
<div class="line">$ source $TRILINOS_DIR/cmake/std/atdm/load-env.sh cuda-debug</div>
<div class="line"> </div>
<div class="line">$ cmake \</div>
<div class="line">  -GNinja \</div>
<div class="line">  -DTrilinos_CONFIGURE_OPTIONS_FILE:STRING=cmake/std/atdm/ATDMDevEnv.cmake \</div>
<div class="line">  -DTrilinos_ENABLE_TESTS=ON -DTrilinos_ENABLE_MueLu=ON \</div>
<div class="line">  $TRILINOS_DIR</div>
<div class="line"> </div>
<div class="line">$ make NP=20</div>
<div class="line"> </div>
<div class="line">$ bsub -x -Is -n 20 ctest -j20</div>
</div><!-- fragment --><p><b>NOTE:</b> While the above example shows loading the environment, configuring and building on the login node, one can also do these on the compute nodes as well. In fact, that is what the CTest -S drivers do in automated testing on 'waterman'.</p>
<p>Note that one can also run the same build a tests using the <a href="../../#checkin-test-atdmsh">checkin-test-atdm.sh</a> script as:</p>
<div class="fragment"><div class="line">$ cd &lt;some_build_dir&gt;/</div>
<div class="line">$ ln -s $TRILINOS_DIR/cmake/std/atdm/checkin-test-atdm.sh .</div>
<div class="line">$ bsub -x -Is -n 20 \</div>
<div class="line">  ./checkin-test-atdm.sh cuda-debug --enable-packages=MueLu --local-do-all</div>
</div><!-- fragment --><h1>Troubleshooting configuration problems</h1>
<p>There are situations were a particular developer on a particular system will not be able to cleanly reproduce a Trilinos configuration as described above. Some of the issues that can cause that are described here.</p>
<p>The first set of problems that might occur are that the version of <code>git</code> that is loaded by sourcing <code>Trilinos/cmake/std/atdm/load-env.sh</code> for a given system may conflict with the developer's global <code>~/.gitconfig</code> file on that system. It may be that an older or newer version of git is loaded by the script (i.e. <code>&lt;atdm-loaded-git&gt;</code>) than the git version that the developer has been using on the system (i.e. <code>&lt;developer-git&gt;</code>) and therefore some of the settings in the developer's <code>~/.gitconfig</code> file may not be compatible with the different version of git. One approach to address this is run <code>module list</code> to see the version of git that is loaded by this script and then to swap out that version of git for the developer's regular version of git using <code>module swap &lt;atdm-loaded-git&gt; &lt;developer-git&gt;</code>. Or, the developer can just call <code>export PATH=&lt;path-to-developers--git&gt;/bin:$PATH</code> after sourcing <code>Trilinos/cmake/std/atdm/load-env.sh</code> to select the developer's regular version of git. The git commands that are used by TriBITS, Trilinos, and the ATDM Trilinos configuration and testing scripts should work with just about any version of git 2.0+. Another approach would be for the user to (temporarily) edit their <code>~/.gitconfig</code> file to address the problems.</p>
<h1>Directory structure and contents</h1>
<p>This base directory:</p>
<div class="fragment"><div class="line">cmake/std/atdm/</div>
</div><!-- fragment --><p>contains the following files:</p>
<ul>
<li><b>ATDMDevEnvSettings.cmake</b>: Reads vars out of the env (loaded with <code>load-env.sh</code>) to set compilers and other options for the Trilinos build. It also default enables all of the TPLs used in ATDM configurations of Trilinos. However, this file does <b>not</b> include <code>ATDMDisables.cmake</code>. Therefore, this file can be used to set up builds of Trilinos that enable arbitrary sets of packages.</li>
<li><b>ATDMDisables.cmake</b>: Disables a bunch of Trilinos packages and subpackages not used by ATDM application customers. This file gets included automatically in <code>ATDMDevEnv.cmake</code> (so you don't need to list it in local configures of Trilinos). But this file is also included in the outer <code>ctest -S</code> driver script code for ATDM builds of Trilinos which is needed for correct package-by-package testing of Trilinos.</li>
<li><b>ATDMDevEnv.cmake</b>: Includes <code>ATDMDevEnvSettings.cmake</code> and <code>ATDMDisables.cmake</code>.</li>
<li><b>checkin-test-atdm.sh</b>: Uses the <code>Trilinos/checkin-test.py</code> script to drive builds and tests on the given platform. (See comments in the top of the script for instructions.)</li>
</ul>
<p>Each supported ATDM system <code>&lt;system-name&gt;</code> has its own sub-directory with the contents:</p>
<div class="fragment"><div class="line">&lt;system-name&gt;/</div>
<div class="line">  environment.sh  # Load env for the given system based on $ATDM_CONFIG_JOB_NAME keys</div>
<div class="line">  all_supported_builds.sh  # [Optional] List of all supported builds</div>
<div class="line">  tweaks/</div>
<div class="line">     &lt;COMPILER0&gt;-&lt;BUILD_TYPE0&gt;-&lt;NODE_TYPE0&gt;-&lt;KOKKOS_ARCH0&gt;.cmake  # [Optional]</div>
<div class="line">     &lt;COMPILER1&gt;-&lt;BUILD_TYPE1&gt;-&lt;NODE_TYPE1&gt;-&lt;KOKKOS_ARCH0&gt;.cmake  # [Optional]</div>
<div class="line">     ...</div>
</div><!-- fragment --><p>The optional file <code>&lt;system-name&gt;/all_supported_builds.sh</code> contains a list of all of the supported builds on the system. This sets the environment variable <code>ATDM_CONFIG_ALL_SUPPORTED_BUILDS</code> as:</p>
<div class="fragment"><div class="line">export ATDM_CONFIG_ALL_SUPPORTED_BUILDS=&quot;gnu-debug-openmp gnu-opt-openmp ...&quot;</div>
</div><!-- fragment --><p>This is used in the <code>checkin-test-atdm.sh</code> script to run all of the builds for a system with <code>checkin-test-atdm.sh all [other options]</code>.</p>
<p><a class="anchor" id="ATDM_TWEAKS_FILES"></a></p>
<p>The files in the <code>cmake/std/atdm/&lt;system-name&gt;/tweaks/</code> directory contain special settings for specific builds for a specific system. Typically, this file contains (temporary) disables for tests for that given build. When a configure is performed, the internal CMake variable <code>ATDM_JOB_NAME_KEYS_STR</code> set to <code>&lt;COMPILER&gt;-&lt;BUILD_TYPE&gt;-&lt;NODE_TYPE&gt;-&lt;KOKKOS_ARCH&gt;</code> (printed to STDOUT) is used to define a default file name:</p>
<div class="fragment"><div class="line">Trilinos/cmake/std/atdm/&lt;system-name&gt;/tweaks/${ATDM_JOB_NAME_KEYS_STR}.cmake</div>
</div><!-- fragment --><p>If that file exists, then it is set as the default for the cmake cache variable <code>ATDM_TWEAKS_FILES</code> (prints to STDOUT) and that file is included and its options are read. For example, this is what the output looks like on 'waterman':</p>
<div class="fragment"><div class="line">-- Reading in configuration options from cmake/std/atdm/ATDMDevEnv.cmake ...</div>
<div class="line">-- ATDM_JOB_NAME_KEYS_STR=&#39;GNU-RELEASE-OPENMP-POWER9&#39;</div>
<div class="line">-- ATDM_TWEAKS_FILES=&#39;&lt;...&gt;/Trilinos/cmake/std/atdm/waterman/tweaks/GNU-RELEASE-OPENMP-POWER9.cmake&#39;</div>
<div class="line">-- Including ATDM build tweaks file &lt;...&gt;//Trilinos/cmake/std/atdm/waterman/tweaks/GNU-RELEASE-OPENMP-POWER9.cmake ...</div>
</div><!-- fragment --><h1>Disabling failing tests</h1>
<p>There are situations where specific tests must be disabled on certain platforms for certain builds or based on other criteria (see sub-process <a href="https://snl-wiki.sandia.gov/display/CoodinatedDevOpsATDM/Triaging+and+addressing+ATDM+Trilinos+Failures#TriagingandaddressingATDMTrilinosFailures-5.Makesuretheissueisaddressedinatimelyway:">Temporarily disable the failing code or test</a>). There are various ways to disable tests with the Trilinos TriBITS/CMake-based build and test system. Tests can be disabled in the <code>CMakeLists.txt</code> files that define the tests themselves using various logic. But the way to selectively disable tests for the ATDM Trilinos builds that will be described here will be to only modify files under the <code>Trilinos/cmake/std/atdm/</code> directory. This will be done by setting the CMake cache variable <code>&lt;full-test-name&gt;_DISABLE=ON</code> for each test to be disabled where <code>&lt;full-test-name&gt;</code> is the full test name. For example, to disable the test <code>MueLu_UnitTestsTpetra_MPI_4</code>, one would set the CMake cache variable <code>MueLu_UnitTestsTpetra_MPI_4_DISABLE=ON</code>. The TriBITS/CMake configure system will then disable the test and print the following line during configuration (when <code>Trilinos_TRACE_ADD_TEST=ON</code> is also set):</p>
<div class="fragment"><div class="line">-- MueLu_UnitTestsTpetra_MPI_4: NOT added test because MueLu_UnitTestsTpetra_MPI_4_DISABLE=&#39;ON&#39;!</div>
</div><!-- fragment --><p>The CMake function <code>ATDM_SET_ENABLE()</code> is provided in order to set the disable such as with:</p>
<div class="fragment"><div class="line">ATDM_SET_ENABLE(MueLu_UnitTestsTpetra_MPI_4_DISABLE ON)</div>
</div><!-- fragment --><p>Using this function will result in the CMake cache variable <code>&lt;full-test-name&gt;_DISABLE</code> to get set to <code>ON</code> by default and will print the disable to the CMake STDOUT when the <code>ATDM_SET_ENABLE()</code> is run, such as:</p>
<div class="fragment"><div class="line">-- Setting default MueLu_UnitTestsTpetra_MPI_4_DISABLE=ON</div>
</div><!-- fragment --><p>This approach also allows a user to enable the test by adding <code>-D&lt;full-test-name&gt;_DISABLE=OFF</code> to the configure line (which overrides the default <code>ON</code>).</p>
<p>However, before any tests are disabled, there must be a Trilinos GitHub issue addressing the failing test(s) and the GitHub issue number (e.g. <code>#2839</code>) must put into a comment above the <code>ATDM_SET_ENABLE()</code> statement and the issue number must be added to the git commit message (see [Create a Trilinos GitHub issue for the failure](<a href="https://snl-wiki.sandia.gov/display/CoodinatedDevOpsATDM/Triaging+and+addressing+ATDM+Trilinos+Failures#TriagingandaddressingATDMTrilinosFailures-3.CreateaTrilinosGitHubissueforthefailure:">https://snl-wiki.sandia.gov/display/CoodinatedDevOpsATDM/Triaging+and+addressing+ATDM+Trilinos+Failures#TriagingandaddressingATDMTrilinosFailures-3.CreateaTrilinosGitHubissueforthefailure:</a>)).</p>
<p>The best file to add the <code>ATDM_SET_ENABLE(&lt;full-test-name&gt;_DISABLE ON)</code> statement to based on different situations is described in the following sub-sections:</p>
<ul>
<li><a href="../../#disable-a-test-for-a-specific-build-on-a-specific-platform">Disable a test for a specific build on a specific platform</a></li>
<li><a href="../../#disable-a-test-for-several-or-all-builds-on-a-specific-platform">Disable a test for several or all builds on a specific platform</a></li>
<li><a href="../../#disable-a-test-for-builds-on-all-platforms">Disable a test for builds on all platforms</a></li>
</ul>
<h2>Disable a test for a specific build on a specific platform</h2>
<p>In order to disable a test for a single build on single platform, one will want to put the <code>ATDM_SET_ENABLE()</code> statement into the <a href="../../#ATDM_TWEAKS_FILES">tweaks file</a> for that build and platform:</p>
<div class="fragment"><div class="line">Trilinos/cmake/std/atdm/&lt;system-name&gt;/tweaks/&lt;ATDM_JOB_NAME_KEYS_STR&gt;.cmake</div>
</div><!-- fragment --><p>The tweak file being looked for is printed out in the CMake configure output as the line:</p>
<div class="fragment"><div class="line">-- ATDM_TWEAKS_FILES=&#39;.../Trilinos/cmake/std/atdm/&lt;system-name&gt;/tweaks/&lt;ATDM_JOB_NAME_KEYS_STR&gt;.cmake&#39;</div>
</div><!-- fragment --><p>For example, for the <code>intel-debug-openmp-KNL</code> build on 'mutrino', the printout would be:</p>
<div class="fragment"><div class="line">-- ATDM_TWEAKS_FILES=&#39;.../Trilinos/cmake/std/atdm/mutrino/tweaks/INTEL-DEBUG-OPENMP-KNL.cmake&#39;</div>
</div><!-- fragment --><p>For example, Trilinos commit <a href="https://github.com/trilinos/Trilinos/commit/73ae19cf0cc7295a7f36de342ea51718226825b7">73ae19cf0c</a> shows the disable of the test:</p>
<div class="fragment"><div class="line"># Disable test that times out for some unkown reason (#2925)</div>
<div class="line">ATDM_SET_ENABLE(Stratimikos_test_aztecoo_thyra_driver_MPI_1_DISABLE ON)</div>
</div><!-- fragment --><p>in both the files <code>cmake/std/atdm/shiller/tweaks/GNU-DEBUG-SERIAL.cmake</code> and <code>cmake/std/atdm/shiller/tweaks/GNU-RELEASE-SERIAL.cmake</code> (before <code>-HSW</code> was added to the names).</p>
<p>NOTE: Adding a comment with the Trilinos GitHub Issue ID (<code>#2925</code> in this example) is critical for tractability to remind why the test was disabled and where to find the disable to remove it later.</p>
<p>To avoid duplicate <code>ATDM_SET_ENABLE()</code> statements, one can use the approach of creating a single <code>*.cmake</code> that is included in the different tweak files as described below.</p>
<h2>Disable a test for several or all builds on a specific platform</h2>
<p>It is often the case that a test needs to be disabled for several (or all) builds for a given platform. An efficient way to do this is to create a new <code>*.cmake</code> file that contains the <code>ATDM_SET_ENABLE()</code> statements and then include that new file in all of the tweaks files on that system where the tests should be disabled.</p>
<p>For example, the Trilinos commit <a href="https://github.com/trilinos/Trilinos/commit/3450efd421f1ce2b47700853aa4c5801f667202a">3450efd421</a> shows how a set of tests were disabled for all of the CUDA builds on the system <code>ride</code> through the creation of the file:</p>
<div class="fragment"><div class="line">Trilinos/cmake/std/atdm/ride/tweaks/CUDA_COMMON_TWEAKS.cmake</div>
</div><!-- fragment --><p>and then the inclusion of that file in the specific tweak files for each CUDA build:</p>
<div class="fragment"><div class="line">Trilinos/cmake/std/atdm/ride/tweaks/CUDA-DEBUG-CUDA.cmake</div>
<div class="line">Trilinos/cmake/std/atdm/ride/tweaks/CUDA-RELEASE-CUDA.cmake</div>
</div><!-- fragment --><p>(before <code>-POWER8-KEPLER37</code> was added to the names) using the inserted CMake statement:</p>
<div class="fragment"><div class="line">INCLUDE(&quot;${CMAKE_CURRENT_LIST_DIR}/CUDA_COMMON_TWEAKS.cmake&quot;)</div>
</div><!-- fragment --><p>An example of using a <code>*.cmake</code> file to disable the same set of tests in all of the builds for a given system is shown in Trilinos commit <a href="https://github.com/trilinos/Trilinos/commit/33a933b004f88710274906fad612380049e1e82e">33a933b004</a>. This example shows the creation of the file:</p>
<div class="fragment"><div class="line">Trilinos/cmake/std/atdm/ride/tweaks/ALL_COMMON_TWEAKS.cmake</div>
</div><!-- fragment --><p>and then the inclusion of that file in all of the specific tweaks files on 'ride' with the statement:</p>
<div class="fragment"><div class="line">INCLUDE(&quot;${CMAKE_CURRENT_LIST_DIR}/ALL_COMMON_TWEAKS.cmake&quot;)</div>
</div><!-- fragment --><p>in each of those files.</p>
<h2>Disable a test for builds on all platforms</h2>
<p>There are rare cases where a test (or a set of tests) will need to be disabled for all or a subset of builds across all systems. To do that using the above-described approaches would require touching files in every <code>cmake/std/atdm/&lt;system-name&gt;/tweaks/</code> directory. In rare cases like this, one can accomplish this by adding a (conditional) <code>ATDM_SET_ENABLE()</code> statement for each test disable directly to the file:</p>
<div class="fragment"><div class="line">Trilinos/cmake/std/atdm/ATDMDevEnvSettings.cmake</div>
</div><!-- fragment --><p>For example, Trilinos commit <a href="https://github.com/trilinos/Trilinos/commit/5e52db03ff33acb5b9a0be7ba7507a8bb0de6e30">5e52db03ff</a> added the CMake code:</p>
<div class="fragment"><div class="line"># Disable test that fails for all openmp builds (#3035)</div>
<div class="line">IF (ATDM_USE_OPENMP)</div>
<div class="line">  ATDM_SET_ENABLE(MueLu_UnitTestsTpetra_MPI_4_DISABLE ON)</div>
<div class="line">ENDIF()</div>
</div><!-- fragment --><p>to the file <code>ATDMDevEnvSettings.cmake</code> to disable the test <code>MueLu_UnitTestsTpetra_MPI_4</code> for all OpenMP builds across all platforms. (Note that that disable was later removed in Trilinos commit <a href="https://github.com/trilinos/Trilinos/commit/62fa6663a6d5a757d786ac87752c3e2074d28414">62fa6663a6</a> after the test was fixed.)</p>
<h1>Specific systems supported</h1>
<p>The specific <code>cmake/std/atdm/&lt;system-name&gt;/</code> sub-directories and the systems they support are:</p>
<ul>
<li><code>cee-rhel6/</code>: CEE LANL RHEL6 systems with a CEE environment</li>
<li><code>chama/</code>: Supports SNL HPC machine <code>chama</code>.</li>
<li><code>mutrino/</code>: Supports SNL HPC machine <code>mutrino</code>.</li>
<li><code>ride/</code>: Supports GNU and CUDA builds on both the SRN machine <code>ride</code> and the mirror SON machine <code>white</code>.</li>
<li><code>sems-rhel6/</code>: RHEL6 systems with the SEMS NFS environment</li>
<li><code>serrano/</code>: Supports SNL HPC machine <code>serrano</code>.</li>
<li><code>shiller/</code>: Supports GNU, Intel, and CUDA builds on both the SRN machine <code>shiller</code> and the mirror SON machine <code>hansen</code>.</li>
<li><code>waterman/</code>: Supports GNU and CUDA builds on the SRN machine <code>waterman</code>. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
