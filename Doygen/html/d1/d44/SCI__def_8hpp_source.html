<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FEDDLib: /home/user/Programme/opt/FEDDLib/FEEDLIB_LEA/source/FEDDLib/feddlib/problems/specific/SCI_def.hpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FEDDLib
   </div>
   <div id="projectbrief">Finite Element Domain Decomposition Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_a7abe54e76939ade77b37861375e4c18.html">feddlib</a></li><li class="navelem"><a class="el" href="../../dir_77dd9975209729874a7e19874eee99bb.html">problems</a></li><li class="navelem"><a class="el" href="../../dir_d3ea561aebf7274761e7193436e21d53.html">specific</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">SCI_def.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#ifndef SCI_def_hpp</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#define SCI_def_hpp</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &quot;SCI_decl.hpp&quot;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160; </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160; </div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">namespace </span><a class="code" href="../../d0/dac/namespaceFEDD.html">FEDD</a> {</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// Funktionen fuer die rechte Seite der Struktur/ Chem/ Geometrie sind im jeweiligen Problem</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160; </div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;SCI&lt;SC,LO,GO,NO&gt;::SCI(<span class="keyword">const</span> DomainConstPtr_Type &amp;domainStructure, std::string FETypeStructure,</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;                    <span class="keyword">const</span> DomainConstPtr_Type &amp;domainChem, std::string FETypeChem, vec2D_dbl_Type diffusionTensor, RhsFunc_Type reactionFunc,</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;                    ParameterListPtr_Type parameterListStructure, ParameterListPtr_Type parameterListChem,</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;                    ParameterListPtr_Type parameterListSCI, Teuchos::RCP&lt;SmallMatrix&lt;int&gt; &gt; &amp;defTS):</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;NonLinearProblem&lt;SC,LO,GO,NO&gt;( parameterListSCI, domainChem-&gt;getComm() ),</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// hasSourceTerm = drittes Arguement. assembleSourceTerm() fuer NS nicht programmiert.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// Deswegen hier erstmal false (default Parameter).</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// Fuer Struktur hingegen ist default Parameter true, da programmiert.</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;problemStructure_(),</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;problemChem_(),</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//problemStructureNonLin_(),</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;meshDisplacementOld_rep_(),</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;meshDisplacementNew_rep_(),</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;c_rep_(),</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;defTS_(defTS),</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;timeSteppingTool_(),</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;exporterEMod_(),</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;materialModel_( parameterListStructure-&gt;sublist(<span class="stringliteral">&quot;Parameter&quot;</span>).get(<span class="stringliteral">&quot;Material model&quot;</span>,<span class="stringliteral">&quot;linear&quot;</span>) )</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;{</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment">//this-&gt;nonLinearTolerance_ = this-&gt;parameterList_-&gt;sublist(&quot;Parameter&quot;).get(&quot;relNonLinTol&quot;,1.0e-6);</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="comment">//this-&gt;initNOXParameters();</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    counterP = 0;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="comment">//std::string linearization = parameterListSCI-&gt;sublist(&quot;General&quot;).get(&quot;Linearization&quot;,&quot;FixedPoint&quot;);</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="comment">//TEUCHOS_TEST_FOR_EXCEPTION( !(linearization == &quot;Newton&quot; || linearization == &quot;NOX&quot;)  &amp;&amp; materialModel_ != &quot;linear&quot;, std::runtime_error, &quot;Nonlinear material models can only be used with Newton&#39;s method or FixedPoint (nonlinear material Jacobian will still be used).&quot;);</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    this-&gt;addVariable( domainChem, FETypeChem, <span class="stringliteral">&quot;c&quot;</span>, 1); <span class="comment">// Chemistry scalar valued problem</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    this-&gt;addVariable( domainStructure, FETypeStructure, <span class="stringliteral">&quot;d_s&quot;</span>, domainStructure-&gt;getDimension() ); <span class="comment">// Structure</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    this-&gt;dim_ = this-&gt;getDomain(0)-&gt;getDimension();</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">if</span> (materialModel_==<span class="stringliteral">&quot;linear&quot;</span>){</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        problemStructure_ = Teuchos::rcp( <span class="keyword">new</span> StructureProblem_Type( domainStructure, FETypeStructure, parameterListStructure ) );</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        problemStructure_-&gt;initializeProblem();</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        problemStructureNonLin_ = Teuchos::rcp( <span class="keyword">new</span> StructureNonLinProblem_Type( domainStructure, FETypeStructure, parameterListStructure) );</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        problemStructureNonLin_-&gt;initializeProblem();</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    }</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    problemChem_ = Teuchos::rcp( <span class="keyword">new</span> ChemProblem_Type( domainChem, FETypeChem, parameterListChem, diffusionTensor, reactionFunc ) );</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    problemChem_-&gt;initializeProblem();</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">//We initialize the subproblems. In the main routine, we need to call initializeFSI(). There, we first initialize the vectors of the FSI problem and then we set the pointers of the subproblems to the vectors of the full monolithic FSI system. This way all values are only saved once in the subproblems and can be used by the monolithic FSI system.</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    meshDisplacementNew_rep_ = Teuchos::rcp( <span class="keyword">new</span> MultiVector_Type( this-&gt;getDomain(0)-&gt;getMapVecFieldRepeated() ) );</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    meshDisplacementOld_rep_ = Teuchos::rcp( <span class="keyword">new</span> MultiVector_Type( this-&gt;getDomain(0)-&gt;getMapVecFieldRepeated() ) );</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    c_rep_ = Teuchos::rcp( <span class="keyword">new</span> MultiVector_Type( this-&gt;getDomain(0)-&gt;getMapVecFieldRepeated() ) );</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">//w_rep_ = Teuchos::rcp( new MultiVector_Type( this-&gt;getDomain(0)-&gt;getMapVecFieldRepeated() ) );</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">//u_minus_w_rep_ = Teuchos::rcp( new MultiVector_Type( this-&gt;getDomain(0)-&gt;getMapVecFieldRepeated() ) );</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    exportedEMod_ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    setUpTimeStep_=<span class="keyword">false</span>;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    eModVec_ = Teuchos::rcp( <span class="keyword">new</span> MultiVector_Type( this-&gt;getDomain(1)-&gt;getElementMap() ) );</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;}</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;SCI&lt;SC,LO,GO,NO&gt;::~SCI()</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;{</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">if</span> (!exporterEMod_.is_null()) {</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;       exporterEMod_-&gt;closeExporter();</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;}</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="keywordtype">void</span> SCI&lt;SC,LO,GO,NO&gt;::info()</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;{</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    this-&gt;infoProblem();</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">//this-&gt;infoNonlinProblem();</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;}</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="../../da/dff/classFEDD_1_1SCI.html#ae3e92993cba2b657556a76c09856d4d8">  102</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/dff/classFEDD_1_1SCI.html#ae3e92993cba2b657556a76c09856d4d8">SCI&lt;SC,LO,GO,NO&gt;::assemble</a>( std::string type )<span class="keyword"> const</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">if</span> (type == <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="keywordflow">if</span> (this-&gt;verbose_)</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;-- Assembly SCI ... &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="comment">// First Assumption: Almost incompressible Material</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        this-&gt;problemChem_-&gt;assemble();</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="comment">// Elementwise determined E Module</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        MultiVectorPtr_Type solChemRep = Teuchos::rcp( <span class="keyword">new</span> <a class="code" href="../../df/d17/classFEDD_1_1MultiVector.html">MultiVector_Type</a>( this-&gt;getDomain(0)-&gt;getMapRepeated() ) );</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        solChemRep-&gt;importFromVector(this-&gt;problemChem_-&gt;getSolution()-&gt;getBlock(0));</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keywordtype">int</span> dim = this-&gt;getDomain(0)-&gt;getDimension();</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160; </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        this-&gt;feFactory_-&gt;determineEMod(this-&gt;getDomain(1)-&gt;getFEType(),solChemRep,eModVec_,this-&gt;getDomain(1),this-&gt;parameterList_);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordtype">double</span> nu = this-&gt;parameterList_-&gt;sublist(<span class="stringliteral">&quot;Parameter&quot;</span>).get(<span class="stringliteral">&quot;PoissonRatio&quot;</span>,0.4);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160; </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        MatrixPtr_Type A(<span class="keyword">new</span> <a class="code" href="../../d2/d6e/classFEDD_1_1Matrix.html">Matrix_Type</a>( this-&gt;getDomain(1)-&gt;getMapVecFieldUnique(), this-&gt;getDomain(1)-&gt;getDimension() * this-&gt;getDomain(1)-&gt;getApproxEntriesPerRow() ) ); <span class="comment">// Structure-Matrix</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="comment">// steady rhs wird hier assembliert.</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="comment">// rhsFunc auf 0 (=x) und 0 (=y) abaendern bei LinElas!</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="keywordflow">if</span> (materialModel_==<span class="stringliteral">&quot;linear&quot;</span>){</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            this-&gt;feFactory_-&gt;assemblyLinElasXDimE(this-&gt;dim_, this-&gt;getDomain(0)-&gt;getFEType(), A, eModVec_, nu, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            this-&gt;problemStructure_-&gt;system_-&gt;addBlock(A,0,0);<span class="comment">// assemble(); //</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <span class="comment">//this-&gt;problemStructure_-&gt;assemble();</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">else</span>{  </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            MultiVectorConstPtr_Type eModVecConst = eModVec_;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            this-&gt;problemStructureNonLin_-&gt;updateEMod(eModVecConst);        </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            this-&gt;problemStructureNonLin_-&gt;assemble(); <span class="comment">//system_-&gt;addBlock(A,0,0);// assemble(); //                               </span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        }</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;       </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="comment">//MatrixPtr_Type C1_T(new Matrix_Type( this-&gt;getDomain(1)-&gt;getMapVecFieldUnique(), 1 ) ); // Chem-Kopplung</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="comment">//MatrixPtr_Type C1(new Matrix_Type( this-&gt;getDomain(0)-&gt;getMapVecFieldUnique(), 1 ) ); // Struktur-Kopplung</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;       </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="comment">// ###########################</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="comment">// Korrekte Skalierung der entsprechenden Bloecke</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="comment">// ###########################</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="keywordtype">double</span> dt = this-&gt;parameterList_-&gt;sublist(<span class="stringliteral">&quot;Timestepping Parameter&quot;</span>).get(<span class="stringliteral">&quot;dt&quot;</span>,0.02);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="comment">// ###########################</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="comment">// Bloecke hinzufuegen</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="comment">// ###########################</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        this-&gt;system_.reset(<span class="keyword">new</span> <a class="code" href="../../df/d85/classFEDD_1_1BlockMatrix.html">BlockMatrix_Type</a>(2));</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;         </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="comment">// Struktur</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordflow">if</span> (materialModel_==<span class="stringliteral">&quot;linear&quot;</span>){</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            this-&gt;system_-&gt;addBlock( this-&gt;problemStructure_-&gt;system_-&gt;getBlock(0,0), 1, 1);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordflow">else</span>{       </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            this-&gt;system_-&gt;addBlock( this-&gt;problemStructureNonLin_-&gt;system_-&gt;getBlock(0,0), 1, 1);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        }    </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="comment">// Chemistry</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        this-&gt;system_-&gt;addBlock( this-&gt;problemChem_-&gt;system_-&gt;getBlock(0,0), 0, 0 );</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;       </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="comment">// Fuer die Zeitprobleme</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        timeSteppingTool_ = Teuchos::rcp(<span class="keyword">new</span> <a class="code" href="../../d2/d7a/classFEDD_1_1TimeSteppingTools.html">TimeSteppingTools</a>(sublist(this-&gt;parameterList_,<span class="stringliteral">&quot;Timestepping Parameter&quot;</span>) , this-&gt;comm_)); </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        ParameterListPtr_Type plStructure;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="keywordflow">if</span> (materialModel_==<span class="stringliteral">&quot;linear&quot;</span>)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            plStructure = this-&gt;problemStructure_-&gt;getParameterList();</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            plStructure = this-&gt;problemStructureNonLin_-&gt;getParameterList();</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        setupSubTimeProblems(this-&gt;problemChem_-&gt;getParameterList(), plStructure);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="comment">// We set the vector from the partial problems</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        this-&gt;setFromPartialVectorsInit();</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordflow">if</span> ( this-&gt;parameterList_-&gt;sublist(<span class="stringliteral">&quot;Exporter&quot;</span>).get(<span class="stringliteral">&quot;Export EMod&quot;</span>, <span class="keyword">true</span>)){</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <span class="keywordflow">if</span>(exportedEMod_ == <span class="keyword">false</span>){</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                exporterEMod_ = Teuchos::rcp(<span class="keyword">new</span> <a class="code" href="../../dc/d00/classFEDD_1_1ExporterParaView.html">Exporter_Type</a>());</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                DomainConstPtr_Type dom = this-&gt;getDomain(1);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                MultiVectorConstPtr_Type exportVector = eModVec_;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                MeshPtr_Type meshNonConst = Teuchos::rcp_const_cast&lt;Mesh_Type&gt;( dom-&gt;getMesh() );</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                exporterEMod_-&gt;setup(<span class="stringliteral">&quot;EModuleValues&quot;</span>, meshNonConst, <span class="stringliteral">&quot;P0&quot;</span>,  this-&gt;parameterList_);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                exporterEMod_-&gt;addVariable( exportVector, <span class="stringliteral">&quot;EModule&quot;</span>, <span class="stringliteral">&quot;Scalar&quot;</span>, 1, dom-&gt;getElementMap() );</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                exporterEMod_-&gt;save( 0.0);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                exportedEMod_ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                exporterEMod_-&gt;save( timeSteppingTool_-&gt;t_);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        }</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="keywordflow">if</span> (this-&gt;verbose_)</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;done -- &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        reAssemble(type);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;}</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/dff/classFEDD_1_1SCI.html">SCI&lt;SC,LO,GO,NO&gt;::reAssemble</a>(std::string type)<span class="keyword"> const</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordtype">double</span> dt = this-&gt;parameterList_-&gt;sublist(<span class="stringliteral">&quot;Timestepping Parameter&quot;</span>).get(<span class="stringliteral">&quot;dt&quot;</span>,0.02);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">if</span> (type == <span class="stringliteral">&quot;MoveMesh&quot;</span>)</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;         moveMesh();</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <span class="stringliteral">&quot;UpdateMeshDisplacement&quot;</span>)</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;         updateMeshDisplacement();</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <span class="stringliteral">&quot;ComputeSolidRHSInTime&quot;</span>){</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="keywordflow">if</span>(this-&gt;verbose_)</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;-- Assembly (ComputeSolidRHSInTime)&quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;          </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;         computeSolidRHSInTime();</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <span class="stringliteral">&quot;ComputeChemRHSInTime&quot;</span>){</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="keywordflow">if</span>(this-&gt;verbose_)</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;-- Assembly (ComputeChemRHSInTime)&quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;          </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;         computeChemRHSInTime();</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <span class="stringliteral">&quot;UpdateChemInTime&quot;</span>){</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keywordflow">if</span>(this-&gt;verbose_)</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;-- Assembly (UpdateChemInTime)&quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;          updateChemInTime();}</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(type == <span class="stringliteral">&quot;UpdateTime&quot;</span>)</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keywordflow">if</span>(this-&gt;verbose_)</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;-- Reassembly (UpdateTime)&quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        updateTime();</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    }</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(type == <span class="stringliteral">&quot;SetBoundaries&quot;</span>)</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="keywordflow">if</span>(this-&gt;verbose_)</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;-- set Boundaries&quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        setBoundariesSubProblems();</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    }</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(type == <span class="stringliteral">&quot;UpdateEMod&quot;</span>)</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordflow">if</span>(this-&gt;verbose_)</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;-- set Boundaries&quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        MultiVectorPtr_Type solChemRep = Teuchos::rcp( <span class="keyword">new</span> MultiVector_Type( this-&gt;getDomain(0)-&gt;getMapRepeated() ) );</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        solChemRep-&gt;importFromVector(this-&gt;problemTimeChem_-&gt;getSolution()-&gt;getBlock(0));</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordtype">int</span> dim = this-&gt;getDomain(0)-&gt;getDimension();</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        this-&gt;feFactory_-&gt;determineEMod(this-&gt;getDomain(1)-&gt;getFEType(),solChemRep,eModVec_,this-&gt;getDomain(1),this-&gt;parameterList_);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordtype">double</span> nu = this-&gt;parameterList_-&gt;sublist(<span class="stringliteral">&quot;Parameter&quot;</span>).get(<span class="stringliteral">&quot;PoissonRatio&quot;</span>,0.4);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        MatrixPtr_Type A(<span class="keyword">new</span> Matrix_Type( this-&gt;getDomain(1)-&gt;getMapVecFieldUnique(), this-&gt;getDomain(1)-&gt;getDimension() * this-&gt;getDomain(1)-&gt;getApproxEntriesPerRow() ) ); <span class="comment">// Structure-Matrix</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="comment">// steady rhs wird hier assembliert.</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="comment">// rhsFunc auf 0 (=x) und 0 (=y) abaendern bei LinElas!</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="comment">//if (materialModel_==&quot;linear&quot;){</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="keywordflow">if</span> (materialModel_==<span class="stringliteral">&quot;linear&quot;</span>){</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            this-&gt;feFactory_-&gt;assemblyLinElasXDimE(this-&gt;dim_, this-&gt;getDomain(0)-&gt;getFEType(), A, eModVec_, nu, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            this-&gt;problemStructure_-&gt;system_-&gt;addBlock(A,0,0);<span class="comment">// assemble(); //</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            this-&gt;system_-&gt;addBlock( this-&gt;problemStructure_-&gt;system_-&gt;getBlock(0,0), 1, 1);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="comment">//this-&gt;problemStructure_-&gt;assemble();</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            MultiVectorConstPtr_Type eModVecConst = eModVec_;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            this-&gt;problemStructureNonLin_-&gt;updateEMod(eModVecConst);                </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            this-&gt;system_-&gt;addBlock( this-&gt;problemStructureNonLin_-&gt;getSystem()-&gt;getBlock(0,0), 1, 1 );                                </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        exporterEMod_-&gt;save( timeSteppingTool_-&gt;t_);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    }</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;       </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">if</span>(type == <span class="stringliteral">&quot;FixedPoint&quot;</span>)</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        TEUCHOS_TEST_FOR_EXCEPTION(<span class="keyword">true</span>, std::runtime_error, <span class="stringliteral">&quot;should always be called by the residual and never here.&quot;</span>);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(type == <span class="stringliteral">&quot;Newton&quot;</span>)</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    {</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordflow">if</span> (materialModel_ != <span class="stringliteral">&quot;linear&quot;</span>){</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            this-&gt;problemStructureNonLin_-&gt;reAssemble(<span class="stringliteral">&quot;Newton&quot;</span>);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        }</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordflow">if</span> (materialModel_ != <span class="stringliteral">&quot;linear&quot;</span>)</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        this-&gt;system_-&gt;addBlock( this-&gt;problemStructureNonLin_-&gt;getSystem()-&gt;getBlock(0,0), 1, 1 );</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;}</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160; </div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="keywordtype">void</span> SCI&lt;SC,LO,GO,NO&gt;::calculateNonLinResidualVec(std::string type, <span class="keywordtype">double</span> time)<span class="keyword"> const</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="comment">//this-&gt;problemChem_-&gt;calculateNonLinResidualVec( &quot;reverse&quot;, time );</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="comment">//this-&gt;residualVec_-&gt;addBlock( this-&gt;problemChem_-&gt;getResidualVector()-&gt;getBlockNonConst(0) , 0);</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="comment">// we need to account for the coupling in the residuals</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">if</span> (materialModel_!=<span class="stringliteral">&quot;linear&quot;</span>){</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        this-&gt;problemStructureNonLin_-&gt;calculateNonLinResidualVec( <span class="stringliteral">&quot;reverse&quot;</span>, time );</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        this-&gt;residualVec_-&gt;addBlock( this-&gt;problemStructureNonLin_-&gt;getResidualVector()-&gt;getBlockNonConst(0) , 1);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="comment">// we need to add a possible source term</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    }</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        MultiVectorPtr_Type residualSolidSCI =  Teuchos::rcp_const_cast&lt;MultiVector_Type&gt;( this-&gt;residualVec_-&gt;getBlock(1) );</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        this-&gt;problemStructure_-&gt;getSystem()-&gt;getBlock(0,0)-&gt;apply( *this-&gt;problemStructure_-&gt;getSolution()-&gt;getBlock(0), *residualSolidSCI, Teuchos::NO_TRANS, -1. ); <span class="comment">// y= -Ax + 0*y</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        MultiVectorPtr_Type resSolidNonConst = Teuchos::rcp_const_cast&lt;MultiVector_Type&gt; ( this-&gt;residualVec_-&gt;getBlock(1) );</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        resSolidNonConst-&gt;update(1., *this-&gt;problemStructure_-&gt;getRhs()-&gt;getBlock(0), 1.);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="comment">// we need to add a possible source term</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    }</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    </div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    MultiVectorPtr_Type residualChemSCI =  Teuchos::rcp_const_cast&lt;MultiVector_Type&gt;( this-&gt;residualVec_-&gt;getBlock(0) );</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    this-&gt;problemChem_-&gt;getSystem()-&gt;getBlock(0,0)-&gt;apply( *this-&gt;problemChem_-&gt;getSolution()-&gt;getBlock(0), *residualChemSCI, Teuchos::NO_TRANS, -1. ); <span class="comment">// y= -Ax + 0*y</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    MultiVectorPtr_Type resChemNonConst = Teuchos::rcp_const_cast&lt;MultiVector_Type&gt; ( this-&gt;residualVec_-&gt;getBlock(0) );</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    resChemNonConst-&gt;update(1., *this-&gt;problemChem_-&gt;getRhs()-&gt;getBlock(0), 1.);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="comment">// might also be called in the sub calculateNonLinResidualVec() methods which were used above</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">if</span> (type == <span class="stringliteral">&quot;reverse&quot;</span>)</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        this-&gt;bcFactory_-&gt;setBCMinusVector( this-&gt;residualVec_, this-&gt;solution_, time );</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <span class="stringliteral">&quot;standard&quot;</span>){</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        this-&gt;residualVec_-&gt;scale(-1.);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        this-&gt;bcFactory_-&gt;setVectorMinusBC( this-&gt;residualVec_, this-&gt;solution_, time );</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    }</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;}</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160; </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="keywordtype">void</span> SCI&lt;SC,LO,GO,NO&gt;::updateMeshDisplacement()<span class="keyword"> const</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;     *meshDisplacementOld_rep_ = *meshDisplacementNew_rep_;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;}</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">// Muss derzeit nur am Anfang jeder Zeititeration aufgerufen werden, damit</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">// problemTimeFluid_ und problemTimeStructure_ die aktuelle Loesung haben.</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">// ACHTUNG: Wenn wir irgendwann einmal anfangen reAssemble() auf problemFluid_ und</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">// problemStructure_ aufzurufen, dann muessen wir in jeder nichtlinearen Iteration</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">// diese setPartialSolutions() aufrufen, damit problemFluid_ und problemStructure_</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">// den korrekten nichtlinearen Term ausrechnen koennen.</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">// CH: Ist das noch relevant?</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">// We need to build FSI so this method is not needed anymore</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="keywordtype">void</span> SCI&lt;SC,LO,GO,NO&gt;::setFromPartialVectorsInit()<span class="keyword"> const</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="comment">//Chem </span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    this-&gt;solution_-&gt;addBlock( this-&gt;problemChem_-&gt;getSolution()-&gt;getBlockNonConst(0), 0);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="comment">//this-&gt;residualVec_-&gt;addBlock( this-&gt;problemChem_-&gt;getResidualVector()-&gt;getBlockNonConst(0), 0 );</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    this-&gt;rhs_-&gt;addBlock( this-&gt;problemChem_-&gt;getRhs()-&gt;getBlockNonConst(0), 0 );</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    this-&gt;sourceTerm_-&gt;addBlock( this-&gt;problemChem_-&gt;getSourceTerm()-&gt;getBlockNonConst(0), 0 );</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;   </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">if</span> (materialModel_==<span class="stringliteral">&quot;linear&quot;</span>){</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        this-&gt;solution_-&gt;addBlock( this-&gt;problemStructure_-&gt;getSolution()-&gt;getBlockNonConst(0), 1 );</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="comment">// we dont have a residual vector for linear problems</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        this-&gt;rhs_-&gt;addBlock( this-&gt;problemStructure_-&gt;getRhs()-&gt;getBlockNonConst(0), 1 );</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        this-&gt;sourceTerm_-&gt;addBlock( this-&gt;problemStructure_-&gt;getSourceTerm()-&gt;getBlockNonConst(0), 1 );</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    }</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        this-&gt;solution_-&gt;addBlock( this-&gt;problemStructureNonLin_-&gt;getSolution()-&gt;getBlockNonConst(0), 1 );</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        this-&gt;residualVec_-&gt;addBlock( this-&gt;problemStructureNonLin_-&gt;getResidualVector()-&gt;getBlockNonConst(0), 1 );</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        this-&gt;rhs_-&gt;addBlock( this-&gt;problemStructureNonLin_-&gt;getRhs()-&gt;getBlockNonConst(0), 1 );</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        this-&gt;previousSolution_-&gt;addBlock( this-&gt;problemStructureNonLin_-&gt;getPreviousSolution()-&gt;getBlockNonConst(0), 1 );</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        this-&gt;sourceTerm_-&gt;addBlock( this-&gt;problemStructureNonLin_-&gt;getSourceTerm()-&gt;getBlockNonConst(0), 1 );</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      </div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;}</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160; </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160; </div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="keywordtype">void</span> SCI&lt;SC,LO,GO,NO&gt;::setupSubTimeProblems(ParameterListPtr_Type parameterListChem, ParameterListPtr_Type parameterListStructure)<span class="keyword"> const</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordflow">if</span>(this-&gt;verbose_)</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;-- Setup SCI Sub-TimeProblems \n&quot;</span> &lt;&lt; std::flush;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordtype">double</span> dt = timeSteppingTool_-&gt;get_dt();</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordtype">double</span> beta = timeSteppingTool_-&gt;get_beta();</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordtype">int</span> sizeChem = this-&gt;problemChem_-&gt;getSystem()-&gt;size();</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordtype">int</span> sizeStructure;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">if</span> (materialModel_==<span class="stringliteral">&quot;linear&quot;</span>)</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        sizeStructure = this-&gt;problemStructure_-&gt;getSystem()-&gt;size();</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        sizeStructure = this-&gt;problemStructureNonLin_-&gt;getSystem()-&gt;size();</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordflow">if</span>(this-&gt;verbose_)</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;-- Setup SCI Sub-TimeProblem for Chem \n&quot;</span> &lt;&lt; std::flush;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    problemTimeChem_.reset(<span class="keyword">new</span> TimeProblem&lt;SC,LO,GO,NO&gt;(*this-&gt;problemChem_, this-&gt;comm_));</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">if</span>(this-&gt;verbose_)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;-- done \n&quot;</span> &lt;&lt; std::flush;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordflow">if</span>(this-&gt;verbose_)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;-- Setup SCI Sub-TimeProblem for Elasticity \n&quot;</span> &lt;&lt; std::flush;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">if</span> (materialModel_==<span class="stringliteral">&quot;linear&quot;</span>)</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        problemTimeStructure_.reset(<span class="keyword">new</span> TimeProblem&lt;SC,LO,GO,NO&gt;(*this-&gt;problemStructure_, this-&gt;comm_));</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        problemTimeStructure_.reset(<span class="keyword">new</span> TimeProblem&lt;SC,LO,GO,NO&gt;(*this-&gt;problemStructureNonLin_, this-&gt;comm_));</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160; </div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keywordflow">if</span>(this-&gt;verbose_)</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;-- done \n&quot;</span> &lt;&lt; std::flush;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="comment">// ######################</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="comment">// Chem: Mass-, Problem, SourceTerm Koeffizienten</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">// ######################</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    SmallMatrix&lt;double&gt; massCoeffChem(sizeChem);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    SmallMatrix&lt;double&gt; problemCoeffChem(sizeChem);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    SmallMatrix&lt;int&gt; defChem(sizeChem);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordtype">double</span> coeffSourceTermChem = 0.0;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">if</span> ( this-&gt;getParameterList()-&gt;sublist(<span class="stringliteral">&quot;Timestepping Parameter&quot;</span>).get(<span class="stringliteral">&quot;Class&quot;</span>,<span class="stringliteral">&quot;Multistep&quot;</span>) == <span class="stringliteral">&quot;Multistep&quot;</span> ) {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;sizeChem; i++) {</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;sizeChem; j++) {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                <span class="keywordflow">if</span> ((*defTS_)[i][j]==1 &amp;&amp; i==j) {</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                    defChem[i][j] = 1;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                    massCoeffChem[i][j] = timeSteppingTool_-&gt;getInformationBDF(0) / dt;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                    massCoeffChem[i][j] = 0.0;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                }</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        }</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;sizeChem; i++) {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;sizeChem; j++){</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                <span class="keywordflow">if</span> ((*defTS_)[i][j]==1){</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                    problemCoeffChem[i][j] = timeSteppingTool_-&gt;getInformationBDF(1);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                    coeffSourceTermChem = timeSteppingTool_-&gt;getInformationBDF(1);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                }</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                    problemCoeffChem[i][j] = 1.;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            }</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        }</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        this-&gt;problemTimeChem_-&gt;setTimeDef(defChem);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        this-&gt;problemTimeChem_-&gt;setTimeParameters(massCoeffChem,problemCoeffChem);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    }</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        TEUCHOS_TEST_FOR_EXCEPTION(<span class="keyword">true</span>, std::logic_error, <span class="stringliteral">&quot;Implement other FSI Chem time stepping than BDF.&quot;</span>);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="comment">// ######################</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="comment">// Struktur: Mass-, Problem, SourceTerm Koeffizienten</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="comment">// ######################</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">// Koeffizienten vor der Massematrix und vor der Systemmatrix des steady-Problems</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    SmallMatrix&lt;double&gt; massCoeffStructure(sizeStructure);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    SmallMatrix&lt;double&gt; problemCoeffStructure(sizeStructure);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    SmallMatrix&lt;int&gt; defStructure(sizeStructure);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordtype">double</span> coeffSourceTermStructure = 0.0; <span class="comment">// Koeffizient fuer den Source-Term (= rechte Seite der DGL); mit Null initialisieren</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="comment">// Koeffizient vor der Massematrix</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; sizeStructure; i++)</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    {</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; sizeStructure; j++)</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        {</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            <span class="comment">// Falls in dem Block von timeStepDef_ zeitintegriert werden soll.</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            <span class="comment">// i == j, da vektorwertige Massematrix blockdiagonal ist</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            <span class="keywordflow">if</span>((*defTS_)[i + sizeChem][j + sizeChem] == 1 &amp;&amp; i == j) <span class="comment">// Weil: (u_f, p, d_s,...) und timeStepDef_ von FSI</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                defStructure[i][j] = 1;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            <span class="comment">// Vorfaktor der Massematrix in der LHS</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                massCoeffStructure[i][j] = 1.0/(dt*dt*beta);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            }</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            {</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                massCoeffStructure[i][j] = 0.;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            }</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        }</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    }</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="comment">// Die anderen beiden Koeffizienten</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; sizeStructure; i++)</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; sizeStructure; j++)</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            <span class="keywordflow">if</span>((*defTS_)[i + sizeChem][j + sizeChem] == 1)</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            {</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                problemCoeffStructure[i][j] =  1.0;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                <span class="comment">// Der Source Term ist schon nach der Assemblierung mit der Dichte \rho skaliert worden</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                coeffSourceTermStructure = 1.0; <span class="comment">// ACHTUNG FUER SOURCE TERM, DER NICHT IN DER ZEIT DISKRETISIERT WIRD!</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            }</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            <span class="keywordflow">else</span> <span class="comment">// Die steady-Systemmatrix ist nicht zwingend blockdiagonal</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                problemCoeffStructure[i][j] = 1.0;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        }</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    }</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    this-&gt;problemTimeStructure_-&gt;setTimeDef(defStructure);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    this-&gt;problemTimeStructure_-&gt;setTimeParameters(massCoeffStructure,problemCoeffStructure);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    this-&gt;problemTimeChem_-&gt;assemble( <span class="stringliteral">&quot;MassSystem&quot;</span> );</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    this-&gt;problemTimeStructure_-&gt;assemble( <span class="stringliteral">&quot;MassSystem&quot;</span> );</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;}</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160; </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="keywordtype">void</span> SCI&lt;SC,LO,GO,NO&gt;::setChemMassmatrix( MatrixPtr_Type&amp; massmatrix )<span class="keyword"> const</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="comment">//######################</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="comment">// Massematrix fuer SCI combineSystems(), ggf nichtlinear. Mass Matrix same as for Chem.</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="comment">//######################</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordtype">double</span> density = this-&gt;problemTimeChem_-&gt;getParameterList()-&gt;sublist(<span class="stringliteral">&quot;Parameter&quot;</span>).get(<span class="stringliteral">&quot;Density&quot;</span>,1000.e-0);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordtype">int</span> size = this-&gt;problemTimeChem_-&gt;getSystem()-&gt;size();</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    this-&gt;problemTimeChem_-&gt;systemMass_.reset(<span class="keyword">new</span> BlockMatrix_Type(size));</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    {</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        massmatrix = Teuchos::rcp(<span class="keyword">new</span> Matrix_Type( this-&gt;problemTimeChem_-&gt;getDomain(0)-&gt;getMapUnique(), this-&gt;getDomain(0)-&gt;getApproxEntriesPerRow() ) );</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="comment">// 0 = Chem</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        this-&gt;feFactory_-&gt;assemblyMass( this-&gt;dim_, this-&gt;problemTimeChem_-&gt;getFEType(0), <span class="stringliteral">&quot;Scalar&quot;</span>,  massmatrix, 0, <span class="keyword">true</span> );</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        massmatrix-&gt;resumeFill();</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        massmatrix-&gt;scale(density);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        massmatrix-&gt;fillComplete( this-&gt;problemTimeChem_-&gt;getDomain(0)-&gt;getMapUnique(), this-&gt;problemTimeChem_-&gt;getDomain(0)-&gt;getMapUnique() );</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160; </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        this-&gt;problemTimeChem_-&gt;systemMass_-&gt;addBlock(massmatrix, 0, 0);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    }</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;}</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">// For now: Leave it like that. ProblemChem. We use BDF2 for the chemistry as well</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">// TODO: updateMultistepRhsFSI() einbauen!</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="keywordtype">void</span> SCI&lt;SC,LO,GO,NO&gt;::computeChemRHSInTime( )<span class="keyword"> const</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="comment">//######################</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="comment">// RHS nach BDF2</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="comment">//######################</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordtype">int</span> sizeChem = this-&gt;problemChem_-&gt;getSystem()-&gt;size();</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordtype">double</span> dt = timeSteppingTool_-&gt;get_dt();</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="keywordtype">int</span> nmbBDF = timeSteppingTool_-&gt;getBDFNumber();</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160; </div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    vec_dbl_Type coeffPrevSteps(nmbBDF);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; coeffPrevSteps.size(); i++)</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        coeffPrevSteps.at(i) = timeSteppingTool_-&gt;getInformationBDF(i+2) / dt;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    }</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160; </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordflow">if</span> (timeSteppingTool_-&gt;currentTime()==0.) {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        SmallMatrix&lt;double&gt; tmpmassCoeff(sizeChem);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        SmallMatrix&lt;double&gt; tmpproblemCoeff(sizeChem);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;sizeChem; i++) {</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;sizeChem; j++) {</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                <span class="keywordflow">if</span> ((*defTS_)[i][j]==1 &amp;&amp; i==j) {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                    tmpmassCoeff[i][j] = 1. / dt;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                }</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                    tmpmassCoeff[i][j] = 0.;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                }</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        }</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;sizeChem; i++) {</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;sizeChem; j++){</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                <span class="keywordflow">if</span> ((*defTS_)[i][j]==1){</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                    tmpproblemCoeff[i][j] =  1.; <span class="comment">// ist das richtig? Vermutlich schon, da BDF so geschrieben ist, dass zu berechnende Lsg den Koeffizienten 1 hat</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                    tmpproblemCoeff[i][j] = 1.;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                }</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            }</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        }</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        this-&gt;problemTimeChem_-&gt;setTimeParameters(tmpmassCoeff, tmpproblemCoeff);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    }</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordflow">if</span> (timeSteppingTool_-&gt;currentTime()==0.) {</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        vec_dbl_Type tmpcoeffPrevSteps(1, 1. / dt);</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        this-&gt;problemTimeChem_-&gt;updateMultistepRhs(tmpcoeffPrevSteps,1);<span class="comment">/*apply (mass matrix_t / dt) to u_t*/</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    }</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        this-&gt;problemTimeChem_-&gt;updateMultistepRhs(coeffPrevSteps,nmbBDF);<span class="comment">/*apply (mass matrix_t / dt) to u_t and more*/</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="comment">// TODO</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">if</span> (this-&gt;problemTimeChem_-&gt;hasSourceTerm()) {</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        TEUCHOS_TEST_FOR_EXCEPTION(<span class="keyword">true</span>, std::logic_error, <span class="stringliteral">&quot;Check sourceterm.&quot;</span>);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160; </div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="comment">// Wieder zu den eigentlichen Parametern zuruecksetzen, nachdem die temporaeren</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="comment">// genommen wurden.</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordflow">if</span> (timeSteppingTool_-&gt;currentTime()==0.) {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        SmallMatrix&lt;double&gt; massCoeffChem(sizeChem);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        SmallMatrix&lt;double&gt; problemCoeffChem(sizeChem);</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;sizeChem; i++) {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;sizeChem; j++) {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                <span class="keywordflow">if</span> ((*defTS_)[i][j]==1 &amp;&amp; i==j) {</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                    massCoeffChem[i][j] = timeSteppingTool_-&gt;getInformationBDF(0) / dt;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                }</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                    massCoeffChem[i][j] = 0.0;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                }</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            }</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;sizeChem; i++) {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;sizeChem; j++){</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                <span class="keywordflow">if</span> ((*defTS_)[i][j]==1){</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                    problemCoeffChem[i][j] = timeSteppingTool_-&gt;getInformationBDF(1);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                }</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                    problemCoeffChem[i][j] = 1.;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                }</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            }</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        this-&gt;problemTimeChem_-&gt;setTimeParameters(massCoeffChem, problemCoeffChem);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    }</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;}</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160; </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment">// This is equivalent to the FSI Structure part.</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="keywordtype">void</span> SCI&lt;SC,LO,GO,NO&gt;::computeSolidRHSInTime()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="comment">//######################</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="comment">// RHS nach Newmark</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="comment">//######################</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordtype">double</span> dt = timeSteppingTool_-&gt;get_dt();</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordtype">double</span> beta = timeSteppingTool_-&gt;get_beta();</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="keywordtype">double</span> gamma = timeSteppingTool_-&gt;get_gamma();</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    </div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="comment">// Temporaerer Koeffizienten fuer die Skalierung der Massematrix in der rechten Seite des Systems in UpdateNewmarkRhs()</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    vec_dbl_Type coeffTemp(1);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    coeffTemp.at(0) = 1.0;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="comment">// Update u und berechne u&#39; und u&#39;&#39; mit Hilfe der Newmark-Vorschrift</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="comment">//this-&gt;problemTimeStructure_-&gt;updateSolutionNewmarkPreviousStep(dt, beta, gamma);</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="comment">// Stelle die rechte Seite des zeitdiskretisierten Systems auf (ohne f_{n+1}).</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="comment">// Bei Newmark lautet dies:</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="comment">// M*[\frac{1}{dt^2*beta}*u_n + \frac{1}{dt*beta}*u&#39;_n + \frac{0.5 - beta}{beta}*u&#39;&#39;_n],</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="comment">// wobei u&#39; = v (velocity) und u&#39;&#39; = w (acceleration).</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="comment">//this-&gt;problemTimeStructure_-&gt;updateNewmarkRhs(dt, beta, gamma, coeffTemp);</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="comment">//can we get rid of this?</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordtype">double</span> time = timeSteppingTool_-&gt;currentTime() + dt;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="comment">// TODO: SourceTerm wird in jedem Zeitschritt neu berechnet; auch wenn konstant!!!</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="comment">// if(time == 0){nur dann konstanten SourceTerm berechnen}</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordflow">if</span> (this-&gt;problemTimeStructure_-&gt;hasSourceTerm())</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    {</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="comment">//this-&gt;problemTimeStructure_-&gt;getUnderlyingProblem()-&gt;addRhsFunction( rhsX3D );</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        this-&gt;problemTimeStructure_-&gt;assembleSourceTerm( time );</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <span class="comment">// Fuege die rechte Seite der DGL (f bzw. f_{n+1}) der rechten Seite hinzu (skaliert mit coeffSourceTerm)</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <span class="comment">// Die Skalierung mit der Dichte erfolgt schon in der Assemblierungsfunktion!</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="comment">// addSourceTermToRHS() aus DAESolverInTime</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <span class="keywordtype">double</span> coeffSourceTermStructure = 1.0;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        BlockMultiVectorPtr_Type tmpPtr = this-&gt;problemTimeStructure_-&gt;getSourceTerm();</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        this-&gt;problemTimeStructure_-&gt;getRhs()-&gt;update(coeffSourceTermStructure, *tmpPtr, 1.);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    }</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;}</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">// Can stay the same</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="keywordtype">void</span> SCI&lt;SC,LO,GO,NO&gt;::setSolidMassmatrix( MatrixPtr_Type&amp; massmatrix )<span class="keyword"> const</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="comment">//######################</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="comment">// Massematrix</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="comment">//######################</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordtype">double</span> density = this-&gt;problemTimeStructure_-&gt;getParameterList()-&gt;sublist(<span class="stringliteral">&quot;Parameter&quot;</span>).get(<span class="stringliteral">&quot;Density&quot;</span>,1000.e-0);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordtype">int</span> size = this-&gt;problemTimeStructure_-&gt;getSystem()-&gt;size();</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordflow">if</span>(timeSteppingTool_-&gt;currentTime() == 0.0)</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    {</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        this-&gt;problemTimeStructure_-&gt;systemMass_.reset(<span class="keyword">new</span> BlockMatrix_Type(size));</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        {</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160; </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            massmatrix = Teuchos::rcp(<span class="keyword">new</span> Matrix_Type( this-&gt;problemTimeStructure_-&gt;getDomain(0)-&gt;getMapVecFieldUnique(), this-&gt;getDomain(0)-&gt;getApproxEntriesPerRow() ) );</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            <span class="comment">// 1 = Struktur</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;            <span class="comment">//this-&gt;feFactory_-&gt;assemblyMass(this-&gt;dim_, this-&gt;problemTimeStructure_-&gt;getFEType(0), &quot;Vector&quot;, massmatrix, 1, true);</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            massmatrix-&gt;resumeFill();</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            massmatrix-&gt;scale(density);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            massmatrix-&gt;fillComplete( this-&gt;problemTimeStructure_-&gt;getDomain(0)-&gt;getMapVecFieldUnique(), this-&gt;problemTimeStructure_-&gt;getDomain(0)-&gt;getMapVecFieldUnique());</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160; </div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            this-&gt;problemTimeStructure_-&gt;systemMass_-&gt;addBlock( massmatrix, 0, 0 );</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;}</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160; </div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">// Can stay the same</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="keywordtype">void</span> SCI&lt;SC,LO,GO,NO&gt;::setBoundariesSubProblems( )<span class="keyword"> const</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="comment">//######################</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="comment">// Boundaries </span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="comment">//######################</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  </div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    this-&gt;problemTimeStructure_-&gt;setBoundaries();</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    this-&gt;problemTimeChem_-&gt;setBoundaries();</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; </div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        </div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;}</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160; </div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">// Damit die richtige timeSteppingTool_-&gt;currentTime() genommen wird.</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="keywordtype">void</span> SCI&lt;SC,LO,GO,NO&gt;::updateTime()<span class="keyword"> const</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    timeSteppingTool_-&gt;t_ = timeSteppingTool_-&gt;t_ + timeSteppingTool_-&gt;dt_prev_;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;}</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160; </div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160; </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="keywordtype">void</span> SCI&lt;SC,LO,GO,NO&gt;::evalModelImpl(<span class="keyword">const</span> Thyra::ModelEvaluatorBase::InArgs&lt;SC&gt; &amp;inArgs,</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                                     <span class="keyword">const</span> Thyra::ModelEvaluatorBase::OutArgs&lt;SC&gt; &amp;outArgs</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                                    )<span class="keyword"> const</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    TEUCHOS_TEST_FOR_EXCEPTION( <span class="keyword">true</span>, std::logic_error, <span class="stringliteral">&quot;implement NOX for steady FSI.&quot;</span>);</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    std::string type = this-&gt;parameterList_-&gt;sublist(<span class="stringliteral">&quot;General&quot;</span>).get(<span class="stringliteral">&quot;Preconditioner Method&quot;</span>,<span class="stringliteral">&quot;Monolithic&quot;</span>);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">//    if ( !type.compare(&quot;Monolithic&quot;))</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment">//        evalModelImplMonolithic( inArgs, outArgs );</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="comment">//    else if ( !type.compare(&quot;FaCSI&quot;)){</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment">//        evalModelImplBlock( inArgs, outArgs );</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="comment">//    else</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">//        TEUCHOS_TEST_FOR_EXCEPTION( true, std::logic_error, &quot;Unkown preconditioner/solver type.&quot;);</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;}   </div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    </div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="keywordtype">void</span> SCI&lt;SC,LO,GO,NO&gt;::moveMesh()<span class="keyword"> const</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160; </div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    MultiVectorConstPtr_Type displacementUniqueConst;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160; </div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    displacementUniqueConst = this-&gt;solution_-&gt;getBlock(1);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    MultiVectorPtr_Type displacementRepeated = Teuchos::rcp( <span class="keyword">new</span> MultiVector_Type( this-&gt;getDomain(1)-&gt;getMapVecFieldRepeated() ) );</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160; </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    displacementRepeated-&gt;importFromVector( displacementUniqueConst );</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    MultiVectorPtr_Type displacementUnique = Teuchos::rcp_const_cast&lt;MultiVector_Type&gt;(displacementUniqueConst);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="comment">// Verschiebe die Gitter fuer Chemistry</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="comment">// ACHTUNG: Klappt nur, weil die P2-Knoten hinter den P1-Knoten kommen.</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="comment">// Sonst muessen fuer den Druck die P1-Knoten extrahiert werden.</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="comment">// TODO: Wahrscheinlich reicht nur FSI-Domain, da selbes Objekt bei problemChem_ und problemTimeChem_.</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    ( Teuchos::rcp_const_cast&lt;Domain_Type&gt;(this-&gt;getDomain(0)) )-&gt;moveMesh(displacementUnique, displacementRepeated);</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    ( Teuchos::rcp_const_cast&lt;Domain_Type&gt;(this-&gt;problemChem_-&gt;getDomain(0)) )-&gt;moveMesh(displacementUnique, displacementRepeated);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    ( Teuchos::rcp_const_cast&lt;Domain_Type&gt;(this-&gt;problemTimeChem_-&gt;getDomain(0)) )-&gt;moveMesh(displacementUnique, displacementRepeated);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;}</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160; </div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160; </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">// Am Anfang der Zeititeration erst updateSolutionMultiPreviousStep() aufrufen und dann erst updateMultistepRhs(),</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">// damit die previousSolution_ initialisiert sind. Genauso fuer SystemMass</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment">// TODO: updateSystemMassMultiPreviousStep() fertig programmieren</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> SC,<span class="keyword">class</span> LO,<span class="keyword">class</span> GO,<span class="keyword">class</span> NO&gt;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="keywordtype">void</span> SCI&lt;SC,LO,GO,NO&gt;::updateChemInTime()<span class="keyword"> const</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordtype">int</span> nmbBDF = timeSteppingTool_-&gt;getBDFNumber();</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160; </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordflow">if</span>(nmbBDF&lt;2 &amp;&amp; !this-&gt;parameterList_-&gt;sublist(<span class="stringliteral">&quot;General&quot;</span>).get(<span class="stringliteral">&quot;Linearization&quot;</span>,<span class="stringliteral">&quot;FixedPoint&quot;</span>).compare(<span class="stringliteral">&quot;Extrapolation&quot;</span>)) {</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        <span class="keywordflow">if</span> (timeSteppingTool_-&gt;currentTime()!=0.){</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            this-&gt;problemTimeChem_-&gt;updateSolutionMultiPreviousStep(2);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            this-&gt;problemTimeChem_-&gt;updateSystemMassMultiPreviousStep(2);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        }</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            this-&gt;problemTimeChem_-&gt;updateSolutionMultiPreviousStep(1);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            this-&gt;problemTimeChem_-&gt;updateSystemMassMultiPreviousStep(1);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        }</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        this-&gt;problemTimeChem_-&gt;updateSolutionMultiPreviousStep(nmbBDF);</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        this-&gt;problemTimeChem_-&gt;updateSystemMassMultiPreviousStep(nmbBDF);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    }</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;}</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;}</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="preprocessor">#endif</span></div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aclassFEDD_1_1BlockMatrix_html"><div class="ttname"><a href="../../df/d85/classFEDD_1_1BlockMatrix.html">FEDD::BlockMatrix</a></div><div class="ttdef"><b>Definition:</b> BlockMatrix_decl.hpp:23</div></div>
<div class="ttc" id="anamespaceFEDD_html"><div class="ttname"><a href="../../d0/dac/namespaceFEDD.html">FEDD</a></div><div class="ttdoc">Domain.</div><div class="ttdef"><b>Definition:</b> AssembleFE_decl.hpp:9</div></div>
<div class="ttc" id="aclassFEDD_1_1Matrix_html"><div class="ttname"><a href="../../d2/d6e/classFEDD_1_1Matrix.html">FEDD::Matrix</a></div><div class="ttdef"><b>Definition:</b> Matrix_decl.hpp:29</div></div>
<div class="ttc" id="aclassFEDD_1_1MultiVector_html"><div class="ttname"><a href="../../df/d17/classFEDD_1_1MultiVector.html">FEDD::MultiVector</a></div><div class="ttdef"><b>Definition:</b> BlockMultiVector_decl.hpp:21</div></div>
<div class="ttc" id="aclassFEDD_1_1TimeSteppingTools_html"><div class="ttname"><a href="../../d2/d7a/classFEDD_1_1TimeSteppingTools.html">FEDD::TimeSteppingTools</a></div><div class="ttdef"><b>Definition:</b> TimeSteppingTools.hpp:22</div></div>
<div class="ttc" id="aclassFEDD_1_1ExporterParaView_html"><div class="ttname"><a href="../../dc/d00/classFEDD_1_1ExporterParaView.html">FEDD::ExporterParaView</a></div><div class="ttdef"><b>Definition:</b> ExporterParaView_decl.hpp:44</div></div>
<div class="ttc" id="aclassFEDD_1_1SCI_html"><div class="ttname"><a href="../../da/dff/classFEDD_1_1SCI.html">FEDD::SCI</a></div><div class="ttdef"><b>Definition:</b> SCI_decl.hpp:24</div></div>
<div class="ttc" id="aclassFEDD_1_1SCI_html_ae3e92993cba2b657556a76c09856d4d8"><div class="ttname"><a href="../../da/dff/classFEDD_1_1SCI.html#ae3e92993cba2b657556a76c09856d4d8">FEDD::SCI::assemble</a></div><div class="ttdeci">virtual void assemble(std::string type=&quot;&quot;) const</div><div class="ttdef"><b>Definition:</b> SCI_def.hpp:102</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
